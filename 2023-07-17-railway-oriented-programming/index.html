<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.4"/><meta name="theme-color" content="#ffffff"/><style data-href="/styles.2c8dcdcc73805e7a8bfa.css" data-identity="gatsby-global-css">.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;text-align:right;-webkit-user-select:none;user-select:none}.command-line-prompt>span:before{opacity:.7}.command-line-prompt>span[data-continuation-prompt]:before{content:attr(data-continuation-prompt)}.command-line span.token.output{opacity:.7}code[class*=language-],pre[class*=language-]{color:#5c6e74;direction:ltr;font-family:Source Code Pro,monospace;font-size:13px;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:none;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::mozselection,code[class*=language-]::selection,pre[class*=language-]::mozselection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{background:#fff;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-]{background:#f9f2f4;border-radius:3px;color:#db4c69;padding:.25em .5em;position:relative;top:-1px;white-space:normal}.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#999}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[data-line]{position:relative}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight{background:#f7efda;box-shadow:inset 5px 0 0 #87d8ff;left:0;line-height:inherit;margin-top:1em;padding-bottom:inherit;padding-left:0;padding-right:0;padding-top:inherit;pointer-events:none;position:absolute;right:0;white-space:pre;z-index:0}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}.gatsby-highlight pre{float:left;min-width:100%}.gatsby-highlight{background-color:#fff;border-radius:.3em;box-shadow:0 5px 20px rgba(0,0,0,.12);margin:32px auto;overflow:auto;padding:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.gatsby-highlight-code-line{background:#fffbdd;border-left:.25em solid #87d8ff;display:block;margin-left:-1em;margin-right:-1em;padding-left:.75em;padding-right:1em}h1{border-bottom:1px solid #eee;font-size:2rem;padding-bottom:12px}h1 a{text-decoration:none}h2{border-bottom:1px solid #eee;font-size:1.6em;padding-bottom:8px}h3{font-size:1.3em}h3,h4{margin:8px 0}h4{font-size:1.2em}h1,h2,h3,h4,h5,h6{color:#454f5b;margin-top:48px}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{color:#454f5b!important;text-decoration:none}a{color:#454f5b;text-decoration:underline}img,video{border-radius:5px;height:auto;max-width:100%}blockquote{background-color:#eee;border-left:.25em solid #ccc;color:#454f5b;line-height:1.5;margin:10px 0;padding:8px 16px}hr{border-top:1px solid #ccc}.thumbnail-container{border-radius:8px;box-shadow:0 0 10px 2px rgba(0,0,0,.05);margin-bottom:25px;max-width:100%}.thumbnail-container a,.thumbnail-container img{display:block;object-fit:cover;width:100%}.post-container{line-height:1.75rem;position:relative}.post-content a{color:#5c6ac4;text-decoration:none}.post-content a:hover{text-decoration:underline}.post-content a.footnote-ref,.post-content a[data-footnote-ref]{color:#ff6f00}.post-content>p:first-letter{margin-left:.3em}.post-content ul{word-break:break-all}@media (max-width:30em){.post-content ul{list-style-position:outside;padding-left:24px}.post-content li>ul{list-style-position:outside;padding-left:12px}}sup{font-weight:400;position:relative;top:-.5em;vertical-align:top}.post-title{border:none;line-height:1.2;margin:0;padding:0}.post-date{color:#9a9a9a;display:block;font-family:Quattrocento Sans,sans-serif;font-size:.8rem;margin-bottom:1rem;margin-top:3px}@media (max-width:30rem){.posts>h1{font-size:1.5rem}}figure{margin:24px 40px;text-align:center}@media (max-width:30em){figure{margin:24px 0}}figcaption{color:#637381;font-size:12px;text-align:center}.footnotes{border-top:1px solid #eee;font-size:12px;margin-top:48px}.footnotes ol{line-height:16px;padding-left:16px}.footnotes ol li{margin-top:8px;padding-left:4px}.footnotes ol p{margin:0}.footnotes ol li::marker{color:#ff6f00}.footnotes ol li .footnote-backref{margin-left:5px}table{border-collapse:collapse;margin-bottom:30px;width:100%}table,td,th{border:1px solid #888}td,th{padding:8px;text-align:left}.sharing-icons a{padding-right:10px}.fa-envelope{padding:5px;transition:.5s}.fa-envelope:hover{color:#f39c12}.fa-twitter{padding:5px;transition:color .5s}.fa-twitter:hover{color:#00aced}.fa-instagram{padding:5px;transition:color .5s}.fa-instagram:hover{color:#375989}.fa-github{padding:5px;transition:color .5s}.fa-github:hover{color:#343434}.fa-linkedin{padding:5px;transition:color .5s}.fa-linkedin:hover{color:#0073a4}.fa-facebook{padding:5px;transition:color .5s}.fa-facebook:hover{color:#3d5b99}.fa-google-plus{padding:5px;transition:color .5s}.fa-google-plus:hover{color:#e64a41}.fa-pinterest{padding:5px;transition:color .5s}.fa-pinterest:hover{color:#bd081c}.fa-medium{padding:5px;transition:color .5s}.fa-medium:hover{color:#00ab6c}.fa-codepen{padding:5px;transition:color .5s}.fa-codepen:hover{color:#000}.fa-rss-square{padding:5px;transition:color .5s}.fa-rss-square:hover{color:#f60}.fa-user{padding:5px;transition:color .5s}.fa-user:hover{color:#00a962}[data-tooltip]{position:relative}[data-tooltip]:after{background-color:#212b36;border-left:6px solid #ff6f00;border-radius:2px;box-shadow:1px 2px 6px rgba(0,0,0,.3);color:#fff;content:attr(data-tooltip);display:none;font-size:12px;height:auto;left:10px;line-height:16px;max-width:400px;padding:8px 10px;pointer-events:none;position:absolute;top:0;width:-webkit-max-content;width:max-content;z-index:1000}[data-tooltip]:focus:after,[data-tooltip]:hover:after{display:block}@media (max-width:30em){[data-tooltip]:focus:after,[data-tooltip]:hover:after{display:none}}.member-container{display:flex;padding:24px 0}.member-container .avatar{flex:0 1 160px}.avatar img{border-radius:50%;width:100%}.member-container .summary{flex:1 1;margin-left:32px}.member-container{display:block}.member-container .avatar{display:block;margin:0 auto;max-width:300px;width:50%}.member-container .summary{font-size:12px;margin-left:0;text-align:center}.member-container .summary .name{font-size:28px;font-weight:100;margin-top:18px}.member-container .summary .description{font-weight:100;margin-top:8px}.tiny-header{color:#212b36;font-size:16px;font-weight:700}.gatsby-highlight{padding:0;width:95%}.gatsby-highlight pre[class*=language-]{box-sizing:border-box;padding:16px}@media (max-width:30em){.gatsby-highlight{width:100%}}</style><link rel="icon" href="/favicon-32x32.png?v=8d8fa298b67e447760210d9e8b28e447" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link rel="alternate" type="application/rss+xml" title="kciter.so" href="/feed.xml"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><p>프로그램을 개발함에 있어 <strong>에러와 사이드 이펙트(부수 효과)를 처리하는 것은 필연적</strong>이다. 아무리 꼼꼼하게 코드를 작성해도 생각하지 못한 문제는 존재하며 특히나 지속해서 발전하는 프로그램은 기술 부채와 함께 <strong>끊임없이 새로운 문제가 발생</strong>한다.</p>
<p>문제가 발생하는 것은 개발자 개인에게도 프로그램을 판매하는 회사에게도 끔찍한 일이다. 아무리 단순하게 해결할 수 있는 문제여도 사용자에게 피해가 간다면 금전적 손실이 발생할 수 밖에 없다. 그렇기 때문에 <strong>프로그래밍은 안전하게 프로그램을 작성할 수 있는 형태로 끊임없이 발전</strong>해왔고 개발자들은 다양한 방법을 생각해냈다. 그 중 하나가 방법론인 <span><code class="language-text">Railway-Oriented Programming</code></span>(이하 ROP)이다.</p>
<figure><img src="/images/2023-07-17-railway-oriented-programming/trip.jpg" width="100%" style="cursor:default"/><figcaption>여행을 떠나보자</figcaption></figure>
<h1 id="사이드-이펙트"><a href="#사이드-이펙트">사이드 이펙트</a></h1>
<p>먼저 사이드 이펙트에 대해서 자세히 알아보자. 사이드 이펙트란 <strong>함수 내부(혹은 프로시저)에서 발생한 일이 함수 외부에 영향을 미치는 것</strong>을 말한다. 구체적으로 다음과 같은 경우를 말한다.</p>
<ul>
<li>함수 내부에서 외부에 있는 변수를 조작하는 경우</li>
<li>네트워크 통신 중 잘못된 데이터를 받아 프로그램에 영향을 미치는 경우</li>
<li>함수 내부에서 에러가 발생하여 프로그램에 문제가 발생하는 경우</li>
</ul>
<p>위와 같은 사례 외에도 다양하게 존재할 수 있다. 요즘엔 함수 내부에서 외부 값을 참조하거나 변경하면 좋지 않다는 것이 널리 알려져  있기 때문에 보통 사이드 이펙트는 <strong>I/O로 인한 문제</strong>로 접하는 경우가 많다. 그래서 이런 문제를 해결하기 위해 많은 개발자들이 예외 처리를 하는 것에 많은 공을 들인다. 하지만 또 많은 개발자들이 간과하는 문제는 <span><code class="language-text">함수 내부에서 에러가 발생하여 프로그램에 문제가 발생하는 경우</code></span>라고 할 수 있다. 아주 간단한 코드를 작성하더라도 이런 문제는 발생할 수 있다. 오히려 간단하기 때문에 실수하는 경우가 많다. 예를 들어, 다음과 같은 코드를 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">// Kotlin</span>
<span class="token keyword">fun</span> <span class="token function">getFirstElement</span><span class="token punctuation">(</span>list<span class="token operator">:</span> List<span class="token operator">&lt;</span>Int<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
  <span class="token keyword">return</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드는 리스트의 첫번째 값을 찾아 불러오는 아주 간단한 함수다. 얼핏보면 큰 문제가 없어보이나 <strong>리스트가 비어있을 때 문제가 발생</strong>한다. 물론 이런 간단한 문제는 쉽게 해결할 수 있지만 막상 작성할 때 실수하는 경우가 많다.</p>
<p>사이드 이펙트는 프로그램의 흐름을 예측하기 어렵게 만들며, 특히나 다른 개발자가 작성한 코드를 수정할 때 사이드 이펙트를 고려하지 않으면 예상치 못한 문제가 발생할 수 있다. 이러한 문제를 해결하기 위해서 다양한 방법이 존재한다.</p>
<h1 id="다양한-해결-방법"><a href="#다양한-해결-방법">다양한 해결 방법</a></h1>
<p>단순히 분기를 이용하는 것 외에도 사이드 이펙트를 해결 할 수 있는 방법은 다양하다. ROP에 대해 알아보기 전에 다른 방법들을 먼저 살펴보자. 사이드 이펙트를 해결하는 방법은 크게 두 가지로 나뉜다.</p>
<ul>
<li>LBYL (Look Before You Leap)</li>
<li>EAFP (Easier to Ask for Forgiveness than Permission)</li>
</ul>
<p>LBYL은 <strong>뛰기 전에 보라</strong>라는 뜻이고 EAFP는 <strong>허락보다는 용서를 구하는 것이 쉽다</strong>라는 뜻이다. 아마 Python을 공부해봤다면 이 두 방법에 대해 들어본 적이 있을 것이다. LBYL은 로직 내에 명시적으로 조건을 검사하는 것을 말한다. 예를 들어, 다음과 같은 코드를 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">// Kotlin</span>
<span class="token keyword">fun</span> <span class="token function">getFirstElement</span><span class="token punctuation">(</span>list<span class="token operator">:</span> List<span class="token operator">&lt;</span>Int<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드는 비어있는 리스트가 매개 변수로 들어올 것을 예상하여 <strong>분기를 통해 미리 예외 처리</strong>를 한다. 반면 EAFP는 예외 처리를 통해 사이드 이펙트를 해결하는 방법이다. 예를 들어, 다음과 같은 코드를 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">// Kotlin</span>
<span class="token keyword">fun</span> <span class="token function">getFirstElement</span><span class="token punctuation">(</span>list<span class="token operator">:</span> List<span class="token operator">&lt;</span>Int<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>
    list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드는 LBYL과 달리 <strong>올바른 로직을 작성한 후 예외가 발생하면 잡는 방식</strong>으로 사이드 이펙트를 해결한다. 말 그대로 먼저 처리한 후 예외에 대한 용서를 구하는 방식이다.</p>
<p>Python에서는 LBYL보다는 EAFP를 선호하지만 필자는 이 두 스타일에 우열은 없다고 생각한다. 상황에 따라 적절한 것이 있을 뿐이다. 이 방법들에 대한 사용 사례를 조금 더 자세히 살펴보자.</p>
<h2 id="lbyl"><a href="#lbyl">LBYL</a></h2>
<h3 id="순수-함수"><a href="#순수-함수">순수 함수</a></h3>
<p>외부와 상호작용 해야하는 I/O를 다루는 것이 아니라면 순수 함수로 작성하여 사이드 이펙트 문제를 해결 할 수 있다. 순수 함수는 <strong>동일한 인자</strong>를 받았을 때 항상 <strong>같은 값</strong>을 반환하는 함수를 말한다. 이말은 즉, <strong>결과를 예측할 수 있다</strong>는 말과 동일하다. 다음과 같은 함수는 순수 함수라 할 수 있다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span></code></pre></div></span>
<p>참고로 에러가 발생할 수 있는 예외는 처리해줘야 한다.</p>
<p>프로그램은 컴퓨터 시스템 위에 올라가기 때문에 수학처럼 <strong>완전하게 순수할 수는 없다</strong>. 그래서 순수 함수의 범위가 애매하게 느껴질 수 있다. 예를 들면, 부동 소수점 문제  가 있다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">var</span> num1<span class="token operator">:</span> Double <span class="token operator">=</span> <span class="token number">0.0</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span> until <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  num1 <span class="token operator">+=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">3</span>
<span class="token punctuation">}</span>
<span class="token keyword">val</span> num2<span class="token operator">:</span> Double <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">10</span>
<span class="token function">println</span><span class="token punctuation">(</span>num1 <span class="token operator">==</span> num2<span class="token punctuation">)</span> <span class="token comment">// false</span></code></pre></div></span>
<p>위 코드를 수학적으로 생각하면 num1과 num2는 같은 값이기 때문에 <span><code class="language-text">true</code></span>가 나와야 정상이다. 하지만 부동 소수점이라는 한계가 있기 때문에 <span><code class="language-text">false</code></span>가 나온다. 만약 위와 같이 부동 소수점을 다루는 함수가 있다면 과연 그 함수를 순수하다고 할 수 있을까?</p>
<p>이를 해결하기 위해서는 프로그램 목적에 따라 <strong>구현 스펙</strong>을 정할 필요가 있다. 다시 부동 소수점을 예로 든다면 자세한 소수점이 필요 없다면 적절한 단위에서 반올림을 통해 문제를 해결하거나 정확한 계산이 필요하다면 Double 자료형을 쓰는 것이 아닌 문자열을 통해 정확한 소수점을 계산해주는 객체를 만들어 사용할 수 있다.</p>
<h3 id="guard-clause-패턴"><a href="#guard-clause-패턴">Guard Clause 패턴</a></h3>
<p>Guard Clause 패턴은 로직의 시작 지점에 방어 조건을 먼저 작성하는 패턴이다. 패턴이라하니 복잡하다 느낄 수 있지만 실제로는 <span><code class="language-text">if</code></span>를 이용하여 간단하게 구현할 수 있다.</p>
<span><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// JavaScript</span>
<span class="token keyword">function</span> <span class="token function">authorize</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>role <span class="token operator">!==</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>isBlocked<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>

  <span class="token comment">// 권한이 있는 사용자에게만 보여줄 로직</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드를 보다시피 매우 간단하다. Guard Clause 패턴의 핵심은 <strong>로직 상단에 방어 조건이 있는 것이며 중첩된 if를 피하는 것</strong>이다. 이를 통해 함수의 <strong>가독성</strong>을 높일 수 있다. 참고로 Swift는 언어 자체에서 Guard 문법을 지원한다.</p>
<span><div class="gatsby-highlight" data-language="swift"><pre class="language-swift"><code class="language-swift"><span class="token comment">// Swift</span>
<span class="token keyword">func</span> <span class="token function-definition function">authorize</span><span class="token punctuation">(</span>user<span class="token punctuation">:</span> <span class="token class-name">User</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
  <span class="token comment">// if와 달리 조건이 맞지 않으면 실행된다.</span>
  <span class="token keyword">guard</span> user<span class="token punctuation">.</span>role <span class="token operator">==</span> <span class="token punctuation">.</span>admin <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
  <span class="token keyword">guard</span> <span class="token operator">!</span>user<span class="token punctuation">.</span>isBlocked <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>

  <span class="token comment">// 권한이 있는 사용자에게만 보여줄 로직</span>
<span class="token punctuation">}</span></code></pre></div></span>
<h2 id="eafp"><a href="#eafp">EAFP</a></h2>
<h3 id="try-catch-문법"><a href="#try-catch-문법">try-catch 문법</a></h3>
<p>순수 함수는 결과를 예측하게 해주지만 <strong>외부 I/O와 개발자가 미처 알아차리지 못한 문제</strong>는 해결해주지 않는다. 특히 요즘 제작되는 대부분의 소프트웨어는 거의 반드시 외부 I/O를 다루기 때문에 새로운 해결 방법을 찾아야 한다. 그 중 하나가 <strong>try-catch 문법</strong>이다.</p>
<p>try-catch 문법은 이미 오래전부터 많은 언어가 지원하고 있다. 그래서 많은 개발자들이 잘 알고있는 예외 처리 방법이기도 하다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">// Kotlin</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// 예외가 발생할 수 있는 코드</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 예외가 발생했을 때 실행할 코드</span>
<span class="token punctuation">}</span></code></pre></div></span>
<span><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// JavaScript</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// 예외가 발생할 수 있는 코드</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 예외가 발생했을 때 실행할 코드</span>
<span class="token punctuation">}</span></code></pre></div></span>
<span><div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Python</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
  <span class="token comment"># 예외가 발생할 수 있는 코드</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
  <span class="token comment"># 예외가 발생했을 때 실행할 코드</span></code></pre></div></span>
<p>언어마다 조금씩 문법은 조금씩 다르지만 형태는 거의 같다. try-catch 문법은 <strong>예외가 발생할 수 있는 코드를 try 블록에 작성</strong>하고 <strong>예외가 발생했을 때 실행할 코드를 catch 블록에 작성</strong>한다. 이렇게 작성하면 예외가 발생했을 때 catch 블록의 코드가 실행된다. try-catch는 어디에서 사용되어야 할까? 대체로 함수를 사용하는 상위 로직에서 사용한다. 그리고 사용 당하는 함수는 에러만을 던진다. 이는 개발자가 미리 알고 의도한 에러든 예상치 못한 에러든 상관없다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">// Kotlin</span>
<span class="token keyword">fun</span> <span class="token function">authorize</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>role <span class="token operator">!=</span> Role<span class="token punctuation">.</span>ADMIN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">RuntimeException</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"권한이 없습니다."</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">authorize</span><span class="token punctuation">(</span><span class="token function">User</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"kciter"</span></span><span class="token punctuation">,</span> role <span class="token operator">=</span> Role<span class="token punctuation">.</span>USER<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>try-catch 문법은 크게 문제가 없어보이지만 <strong>가독성</strong>에 조금 문제가 있다. try-catch는 순차적으로 흐르지 않는다. 에러가 발생하면 <span><code class="language-text">catch</code></span> 절로 이동하고 <span><code class="language-text">finally</code></span>와 같은 문법을 사용할 경우 <span><code class="language-text">try</code></span>에서 처리된 후 온 것인지 <span><code class="language-text">catch</code></span>에서 처리된 후 온 것인지 확인이 필요하다. 그렇기 때문에 프로그램을 그대로 종료할 것이 아니라면 어떤 절로 로직이 마무리 되더라도 문제없이 진행될 수 있도록 개발자가 신경써야 한다.</p>
<p>또한, 해당 함수가 <strong>어떤 에러를 반환하는지 개발자가 미리 알아야 한다는 문제</strong>가 있다. 특히 사용자 지정 에러가 많은 경우 생산성에 문제가 될 수 있다.</p>
<p>하지만 try-catch가 나쁘다는 의미는 아니다. 서버 프로그램과 같이 <strong>절대로 패닉이 발생해선 안되는 프로그램</strong>에서는 try-catch 문법은 매우 유용하다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> server <span class="token operator">=</span> <span class="token function">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
  <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Server is running on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">server<span class="token punctuation">.</span>localPort</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> reader <span class="token operator">=</span> <span class="token function">Scanner</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> writer <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Client connected: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">socket<span class="token punctuation">.</span>inetAddress<span class="token punctuation">.</span>hostAddress</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    thread <span class="token punctuation">{</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">val</span> text <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span>Charset<span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
          socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<figcaption style="margin-top:-16px">서버는 신뢰성을 위해 최대한 살아있어야 한다</figcaption>
<h3 id="functor와-monad"><a href="#functor와-monad">Functor와 Monad</a></h3>
<p>펑터와 모나드는 <strong>함수형 프로그래밍</strong>을 접하면 자주 들을 수 있는 개념이다. 일반적으로 처음 프로그래밍을 접하며 배운 내용들과는 이질적이기도 하고 설명에 수학적인 내용이 들어가는 경우도 있어서 어렵게 느껴질 수 있다. 하지만 하나씩 살펴보면 그리 어려운 개념은 아니다. 함수형 프로그래밍에 대한 설명은 이 글의 범위를 벗어나므로 어려운 개념은 생략하고 간단하게 펑터와 모나드를 살펴볼 것이다.</p>
<p>먼저 펑터와 모나드를 이해하기 전에 <strong>타입</strong>에 대해 살펴볼 필요가 있다. 함수형 프로그래밍에서 타입은 <strong>함수 합성</strong>을 하기 위한 중요한 개념이다. 수학적 정의와 마찬가지로 프로그래밍 세계의 함수도 <strong>정의역과 치역</strong>으로 이루어져 있다.</p>
<figure><img src="/images/2023-07-17-railway-oriented-programming/domain-range.png" width="80%" style="cursor:default"/><figcaption>정의역과 치역 그리고 공역</figcaption></figure>
<p>함수의 정의역과 치역은 집합이다. 그리고 프로그래밍 언어에선 이를 타입으로 표현한다.</p>
<span><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">Boolean <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
Short <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">32768</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> <span class="token number">32767</span><span class="token punctuation">}</span>
Int <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">2147383647</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> <span class="token number">2147483647</span><span class="token punctuation">}</span>
<span class="token operator">...</span></code></pre></div></span>
<p>그렇다면 다음 함수는 Int 집합에서 Double 집합으로 변형하는 함수라고 볼 수 있다. 즉, <strong>정의역은 매개 변수의 타입이고 치역은 반환 타입</strong>이다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Double <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> b<span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></span>
<p>하지만 위 함수는 b가 0일 경우 DivideByZero 에러가 발생하기 때문에 순수 함수가 아니다. 이 경우 <strong>치역을 온전한 Double</strong>이라고 말할 수는 없다. 분기를 이용한 예외 처리로 이를 해결할 수 있지만 만약 에러마저도 치역에 포함시키고 싶다면 다른 방법을 사용해야 한다. 이 문제를 해결하는 것이 어렵게 느껴질 수 있지만 사실 상당히 간단한 일이다. Double이라는 집합으로는 에러를 담아낼 수 없기 때문에 새로운 집합이 필요하다. 즉, <strong>새로운 타입</strong>을 만들어내면 되는 것이다.</p>
<figure><img src="/images/2023-07-17-railway-oriented-programming/new-range.png" width="100%" style="cursor:default"/><figcaption>묶어서 하나의 타입</figcaption></figure>
<p>위와 같은 개념이 <strong>펑터</strong>라고 할 수 있다. 지금부터 프로그래밍 세계에서 펑터를 어떻게 구현할 수 있을지 알아보자.</p>
<h4 id="functor"><a href="#functor">Functor</a></h4>
<p>펑터라는 개념을 이용하면 타입을 확장하여 새로운 타입을 만들어낼 수 있다. 이를 통해 에러를 담아낼 수 있다. 코드를 살펴보기 전에 먼저 <strong>개념적인 이미지</strong>부터 살펴보자.</p>
<figure><img src="/images/2023-07-17-railway-oriented-programming/functor.png" width="100%" style="cursor:default"/></figure>
<p>위 이미지를 보면 펑터는 박스와 같다는 것을 알 수 있다. 박스 안에는 값이 들어있고 이를 <strong>꺼내서(unwrap value)</strong> 함수를 <strong>적용(apply function)</strong>한다. 그리고 다시 박스에 <strong>집어넣는다(rewrap value)</strong>. 왜 이런 번거로운 짓을 하는 걸까? 그 이유는 <strong>값에 함수를 적용할 때 발생하는 문제를 해결</strong>하기 위함이다. 다시 다음 이미지를 살펴보자.</p>
<figure><img src="/images/2023-07-17-railway-oriented-programming/functor-error.png" width="100%" style="cursor:default"/></figure>
<p>이번엔 펑터에 0을 나누는 함수를 적용했다. 이 경우 당연히 에러가 발생한다. 여기서 개발자는 적절한 로직을 통해 예외 처리를 할 수 있다. 이때 <strong>예외 처리를 통해 얻은 에러 객체를 펑터</strong>에 넣어주면 된다.</p>
<p>이를 코드로 구현하면 다음과 같다. 여기선 예제로 Kotlin을 사용하겠다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Functor<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> value<span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token operator">&lt;</span>R<span class="token operator">></span> <span class="token function">map</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">-></span> R<span class="token punctuation">)</span><span class="token operator">:</span> Functor<span class="token operator">&lt;</span>R<span class="token operator">></span> <span class="token operator">=</span>
    <span class="token function">Functor</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>펑터에서 <strong>함수를 받아 값을 변형하는 함수</strong>를 보통 <span><code class="language-text">map</code></span>이라고 한다. 어디서 많이본 함수 아닌가? 그렇다. 우리는 이미 펑터라는 개념을 자주 써왔다! 그럼 이번엔 위 Functor 클래스를 이용하는 코드를 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Functor<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> value<span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">fun</span> <span class="token operator">&lt;</span>R<span class="token operator">></span> <span class="token function">map</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">-></span> R<span class="token punctuation">)</span><span class="token operator">:</span> Functor<span class="token operator">&lt;</span>R<span class="token operator">></span> <span class="token operator">=</span>
    <span class="token function">Functor</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token operator">=</span>
    <span class="token string-literal singleline"><span class="token string">"Functor(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">value</span></span><span class="token string">)"</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> functor <span class="token operator">=</span> <span class="token function">Functor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> functor<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
  <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// Functor(2)</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>아주 간단한 코드다. 펑터는 1이라는 값을 가지고 있고 이를 <span><code class="language-text">map</code></span> 함수를 통해 1을 더한 값을 반환한다. 이를 통해 펑터는 <strong>값을 변형하는 함수를 적용할 수 있다</strong>는 것을 알 수 있다. 이제 펑터를 이용하여 조금 더 복잡한 것을 만들어보자. 이번에는 값이 <span><code class="language-text">null</code></span>인지 알 수 있는 펑터를 구현해볼 것이다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">sealed</span> <span class="token keyword">class</span> Option<span class="token operator">&lt;</span><span class="token keyword">out</span> T<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> Some<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> value<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> Option<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">object</span> None<span class="token operator">:</span> Option<span class="token operator">&lt;</span>Nothing<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>
    <span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">of</span><span class="token punctuation">(</span>value<span class="token operator">:</span> T<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Option<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">null</span> <span class="token operator">-></span> None
      <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token function">Some</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token operator">=</span>
    <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">is</span> Some <span class="token operator">-></span> <span class="token string-literal singleline"><span class="token string">"Some(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">value</span></span><span class="token string">)"</span></span>
      <span class="token keyword">is</span> None <span class="token operator">-></span> <span class="token string-literal singleline"><span class="token string">"None"</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token operator">&lt;</span>T<span class="token punctuation">,</span> R<span class="token operator">></span> Option<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">-></span> R<span class="token punctuation">)</span><span class="token operator">:</span> Option<span class="token operator">&lt;</span>R<span class="token operator">></span> <span class="token operator">=</span>
  <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Option<span class="token punctuation">.</span>Some <span class="token operator">-></span> Option<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">is</span> Option<span class="token punctuation">.</span>None <span class="token operator">-></span> Option<span class="token punctuation">.</span>None
  <span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> option <span class="token operator">=</span> Option<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Hello, World!"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> result1 <span class="token operator">=</span> option<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toIntOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token keyword">val</span> result2 <span class="token operator">=</span> option<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>length <span class="token punctuation">}</span>

  <span class="token function">println</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span> <span class="token comment">// None</span>
  <span class="token function">println</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span> <span class="token comment">// Some</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p><span><code class="language-text">Option</code></span>이라는 값이 적용될 때 <span><code class="language-text">null</code></span>인지 아닌지 판단하여 <span><code class="language-text">null</code></span>이라면 <span><code class="language-text">None</code></span>을 값이 있다면 <span><code class="language-text">Some</code></span>으로 타입을 분류하는 펑터를 구현했다. 이를 이용하여 NullPointerException과 같은 문제를 예방할 수 있다. 그리고 패턴 매칭이 지원되는 언어라면 다음과 같이 더 안전하게 사용이 가능하다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> option <span class="token operator">=</span> Option<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Hello, World!"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Some <span class="token operator">-></span> option<span class="token punctuation">.</span>value
    <span class="token keyword">is</span> None <span class="token operator">-></span> <span class="token string-literal singleline"><span class="token string">"None"</span></span>
  <span class="token punctuation">}</span>

  <span class="token comment">// result는 null이 아님을 보장한다.</span>
  <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// Hello, World!</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>만약 펑터를 이용하여 <span><code class="language-text">null</code></span>을 판단하는 것이 아니라 에러를 판단한다면 어떨까? 이번에는 에러를 판단하는 펑터를 구현해보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">sealed</span> <span class="token keyword">class</span> Result<span class="token operator">&lt;</span><span class="token keyword">out</span> V<span class="token punctuation">,</span> <span class="token keyword">out</span> E<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> Success<span class="token operator">&lt;</span><span class="token keyword">out</span> V<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> value<span class="token operator">:</span> V<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> Nothing<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> Failure<span class="token operator">&lt;</span><span class="token keyword">out</span> E<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> error<span class="token operator">:</span> E<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Nothing<span class="token punctuation">,</span> E<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>
    <span class="token keyword">fun</span> <span class="token operator">&lt;</span>V<span class="token operator">></span> <span class="token function">of</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> V<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">Success</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">Failure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token operator">=</span>
    <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">is</span> Success <span class="token operator">-></span> <span class="token string-literal singleline"><span class="token string">"Success(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">value</span></span><span class="token string">)"</span></span>
      <span class="token keyword">is</span> Failure <span class="token operator">-></span> <span class="token string-literal singleline"><span class="token string">"Failure(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">error</span></span><span class="token string">)"</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token operator">&lt;</span>V<span class="token punctuation">,</span> R<span class="token punctuation">,</span> E<span class="token operator">></span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> E<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> <span class="token operator">-></span> R<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>R<span class="token punctuation">,</span> E<span class="token operator">></span> <span class="token operator">=</span>
  <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> <span class="token function">f</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span></code></pre></div></span>
<p><span><code class="language-text">Option</code></span>과 거의 비슷하다. 다만 <span><code class="language-text">null</code></span>을 판단하는 것이 아니라 try-catch를 이용하여 <span><code class="language-text">Throwable</code></span>을 판단한다는 것이 다르다. 이를 이용하여 다음과 같이 사용할 수 있다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it <span class="token operator">/</span> <span class="token number">0</span> <span class="token punctuation">}</span>
  <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// Failure(error=java.lang.ArithmeticException: / by zero)</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p><span><code class="language-text">of</code></span> 메서드를 통해 에러가 발생한다면 <span><code class="language-text">Failure</code></span> 타입이 반환되고 발생하지 않는다면 <span><code class="language-text">Success</code></span> 타입이 반환된다. 마찬가지로 <span><code class="language-text">map</code></span>을 이용해 값을 변형할 때 에러가 발생한다면 <span><code class="language-text">Failure</code></span>를 반환하고 발생하지 않는다면 <span><code class="language-text">Success</code></span>를 반환한다. 이를 통해 에러를 안전하게 처리할 수 있다. 여기서 <span><code class="language-text">Option</code></span>때와 마찬가지로 패턴 매칭을 사용한다면 다음과 같이 사용할 수 있다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it <span class="token operator">/</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">}</span>

  <span class="token keyword">when</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>여기까지는 아무런 문제가 없지만 다음과 같은 상황이 있을 수 있다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> a <span class="token operator">+</span> b <span class="token punctuation">}</span>
<span class="token keyword">fun</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> a <span class="token operator">/</span> b <span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> <span class="token number">5</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">sum</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">// Result&lt;Result&lt;Int, Throwable>, Throwable></span>
    <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">divide</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">// 타입이 맞지 않아 컴파일 에러가 발생한다.</span>

  <span class="token keyword">when</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token comment">// java.lang.ArithmeticException: / by zero</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드와 같이 함수마다 에러를 판단하기 위해 Result라는 펑터 타입을 사용한다면 <span><code class="language-text">map</code></span>을 이용할 때 <strong>박스를 다시 박스로 감싸는 문제</strong>가 발생하게 된다. 이를 해결하기 위해서는 박스로 다시 감싸지 않고 값을 변형하는 해야한다. 프로그래밍 세계에서 이를 구현하기 위해 <strong>모나드</strong>라는 개념을 이용할 수 있다.</p>
<h4 id="monad"><a href="#monad">Monad</a></h4>
<p>모나드는 굉장히 어렵다라는 소문이 자자한 개념이다. 그러다보니 <a href="https://xtendo.org/ko/monad#1" rel="nofollow noopener noreferrer">모나드 괴담</a>이라는 자료까지 생겨나곤했다. 하지만 이론적인 내용을 배제하고 하나씩 살펴보면 그다지 어렵지 않다는 것을 알 수 있다.</p>
<figure><img src="/images/2023-07-17-railway-oriented-programming/monad-problem.jpeg" width="100%" style="cursor:default"/><figcaption>일단 수학 용어는 치워보자</figcaption></figure>
<p>앞서 모나드는 펑터의 중첩을 해결 할 수 있다고 말했다. 실제로 프로그래밍 세계의 모나드는 이를 위해 탄생했다. 게다가 심지어 많은 개발자가 이미 모나드를 사용하고 있다. 다음 코드를 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> list <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> result <span class="token operator">=</span> list
  <span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span>
    <span class="token function">listOf</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> it <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// listOf 함수는 List&lt;T> 타입을 반환한다.</span>
  <span class="token punctuation">}</span></code></pre></div></span>
<p><span><code class="language-text">flatMap</code></span>이라는 함수에 대해 다뤄본적이 있다면 위 코드는 익숙할 것이다. 만약 리스트를 변형하던 중 다시 리스트 타입을 반환해야 한다면 <span><code class="language-text">flatMap</code></span>을 사용한다. 만약 <span><code class="language-text">map</code></span> 함수였다면 <span><code class="language-text">List&lt;Int></code></span> 타입을 <span><code class="language-text">List&lt;List&lt;Int>></code></span> 타입으로 변형했겠지만 <span><code class="language-text">flatMap</code></span>은 <span><code class="language-text">List&lt;Int></code></span> 타입으로 변형할 수 있다. 간단하게 표현하자면 <strong>flatMap 함수가 반환한 것을 값으로 그대로 사용하는 것</strong>이라 볼 수 있다. 이것이 모나드다.</p>
<p>다시 정리하면 모나드는 중첩을 해결한다. 이제 Result 펑터를 이용하여 모나드를 구현해보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">sealed</span> <span class="token keyword">class</span> Result<span class="token operator">&lt;</span><span class="token keyword">out</span> V<span class="token punctuation">,</span> <span class="token keyword">out</span> E<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> Success<span class="token operator">&lt;</span><span class="token keyword">out</span> V<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> value<span class="token operator">:</span> V<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> Nothing<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> Failure<span class="token operator">&lt;</span><span class="token keyword">out</span> E<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> error<span class="token operator">:</span> E<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Nothing<span class="token punctuation">,</span> E<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>
    <span class="token keyword">fun</span> <span class="token operator">&lt;</span>V<span class="token operator">></span> <span class="token function">of</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> V<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">Success</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">Failure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token operator">=</span>
    <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">is</span> Success <span class="token operator">-></span> <span class="token string-literal singleline"><span class="token string">"Success(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">value</span></span><span class="token string">)"</span></span>
      <span class="token keyword">is</span> Failure <span class="token operator">-></span> <span class="token string-literal singleline"><span class="token string">"Failure(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">error</span></span><span class="token string">)"</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token operator">&lt;</span>V<span class="token punctuation">,</span> R<span class="token punctuation">,</span> E<span class="token operator">></span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> E<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> <span class="token operator">-></span> R<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>R<span class="token punctuation">,</span> E<span class="token operator">></span> <span class="token operator">=</span>
  <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> <span class="token function">f</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>

<span class="token comment">// flatMap은 결과값을 그대로 사용한다.</span>
<span class="token keyword">fun</span> <span class="token operator">&lt;</span>V<span class="token punctuation">,</span> R<span class="token punctuation">,</span> E<span class="token operator">></span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> E<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">)</span> <span class="token operator">-></span> Result<span class="token operator">&lt;</span>R<span class="token punctuation">,</span> E<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>R<span class="token punctuation">,</span> E<span class="token operator">></span> <span class="token operator">=</span>
  <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드는 Result 펑터를 구현한 코드이다. <span><code class="language-text">map</code></span> 함수는 펑터의 특징을 그대로 따르고 있고 <span><code class="language-text">flatMap</code></span> 함수는 모나드의 특징을 그대로 따르고 있다. <span><code class="language-text">flatMap</code></span> 함수는 결과값을 그대로 사용한다는 특징을 가지고 있다. 이제 모나드를 이용하여 펑터 쪽 예제에서 불가능했던 문제를 해결해보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> a <span class="token operator">+</span> b <span class="token punctuation">}</span>
<span class="token keyword">fun</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> a <span class="token operator">/</span> b <span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">of</span> <span class="token punctuation">{</span> <span class="token number">5</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span> <span class="token function">sum</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span> <span class="token function">divide</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">// 타입이 일치한다!</span>

  <span class="token keyword">when</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token comment">// java.lang.ArithmeticException: / by zero</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>이제 문제가 해결된 것을 볼 수 있다. 모나드에 대해서는 이론적인 내용이 많이 있지만 실용적인 것만 따진다면 이렇게 간단하게 구현할 수 있다. 이제 펑터와 모나드를 이용하면 기존과는 다른 방식으로도 예외 처리를 할 수 있다는 것을 알았을 것이다. 이제 본격적으로 ROP에 대해서 알아보자.</p>
<h1 id="railway-oriented-programming"><a href="#railway-oriented-programming">Railway-Oriented Programming</a></h1>
<p>ROP는 사이드 이펙트를 제어하기 위한 함수형 패러다임 기반 방법론이다. ROP라는 방법론은 널리 알려지진 않았지만 Rust는 try-catch 문법을 지원하지 않는대신 ROP 철학을 일부 따르고 있다. 즉, 배워둬서 나쁠건 없다고 생각한다.</p>
<span><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token comment">// Rust 예제</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Result 객체를 반환한다.</span>

  <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">match</span> f <span class="token punctuation">{</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=></span> file<span class="token punctuation">,</span> <span class="token comment">// 파일이 정상적으로 열렸다면 파일 객체를 반환한다.</span>
    <span class="token class-name">Err</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"There was a problem opening the file: {:?}"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token comment">// 에러를 처리한다.</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>이어서 설명하면 ROP는 굉장히 단순하다. 간단하게 요약하면 <strong>로직은 성공 혹은 실패로 나뉘고 그에 따라 새로운 선로를 설치</strong>해서 신뢰할 수 있는 소프트웨어를 구축한다는 방법론이다.</p>
<figure><img src="/images/2023-07-17-railway-oriented-programming/rail.png" width="100%" style="cursor:default"/><figcaption>성공 혹은 실패</figcaption></figure>
<p>이를 위해 기본적으로 위에서 구현한 <strong>Result라는 모나드 객체를 사용</strong>한다. 그리고 에러를 체크하는 것은 어떤 방법을 사용하더라도 상관없다. 중요한 것은 <strong>ROP라는 방법론의 철학을 이해</strong>하는 것이다. ROP는 다음과 같은 철학을 따른다.</p>
<ul>
<li>모든 기능은 순차적으로 실행된다.</li>
<li>모든 기능은 성공 혹은 실패로 나뉜다.</li>
<li>프로그램은 패닉이 발생하면 안된다.</li>
</ul>
<p>이렇게 간단한 철학을 따르면서도 ROP는 사고적으로 굉장히 강력한 방법론이다. 우리는 프로그래밍을 할 때 항상 기능에 대한 추상화를 한다. ROP에선 <strong>기능을 선로에 빗대어 추상화</strong>하며 선로를 구성하는 기능들은 모두 성공 혹은 실패로 나눈다. 이렇게 추상화를 하면 <strong>기능의 단위를 성공과 실패로 나눌 수 있는 적절한 크기로 나누게 되므로</strong> 구현과 리팩토링 하는 것이 편해진다.</p>
<p>또한, 모든 기능을 <strong>순차적으로 실행하기 때문에 프로그램의 흐름을 이해하기 쉬워지고 가독성이 좋아진다</strong>. 이러한 장점들을 통해 ROP는 신뢰할 수 있는 소프트웨어를 구축하는데 도움을 준다. 이제 Result에 대한 추가적인 내용에 대해 알아보자.</p>
<h2 id="복구-선로"><a href="#복구-선로">복구 선로</a></h2>
<p>이미 Result를 구현한 시점에서 ROP의 설명은 거의 끝났다고 볼 수 있다. 하지만 앞  서 설명하지 않은 내용 중 <strong>복구</strong>라는 개념이 있다. ROP는 세 가지 선로로 분류된다.</p>
<ul>
<li>성공 선로</li>
<li>실패 선로</li>
<li>복구 선로</li>
</ul>
<p>성공 선로는 간단하다. 우리가 생각했던 베스트 케이스대로 로직이 구성되는 것이다. 반면 실패 선로는 각각의 선로를 지나가던 중(함수를 실행하는 도중) 문제가 발생하여 실패하는 경우다. 복구 선로는 실패 선로를 지나가던 중 문제가 발생했지만 복구할 수 있는 경우이다. 그러면 다시 성공 선로로 이동한다. 이미 펑터와 모나드를 설명하며 성공 선로와 실패 선로를 구축하는 것은 Result를 구현하며 보았기 때문에 복구하는 방법을 살펴보자.</p>
<p>복구 선로를 만드는 함수는 <span><code class="language-text">rescue</code></span> 혹은 <span><code class="language-text">recover</code></span>라는 이름으로 구현된다. 어떤 이름을 사용하던 상관은 없다. 다음 코드를 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">sealed</span> <span class="token keyword">class</span> Result<span class="token operator">&lt;</span><span class="token keyword">out</span> V<span class="token punctuation">,</span> <span class="token keyword">out</span> E<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> Success<span class="token operator">&lt;</span><span class="token keyword">out</span> V<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> value<span class="token operator">:</span> V<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> Nothing<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> Failure<span class="token operator">&lt;</span><span class="token keyword">out</span> E<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">val</span> error<span class="token operator">:</span> E<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Nothing<span class="token punctuation">,</span> E<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Other functions...</span>

<span class="token keyword">fun</span> <span class="token operator">&lt;</span>V<span class="token punctuation">,</span> E<span class="token operator">></span> Result<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> E<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">recover</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>E<span class="token punctuation">)</span> <span class="token operator">-></span> V<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token punctuation">.</span>Success<span class="token operator">&lt;</span>V<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> <span class="token keyword">this</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> Result<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span> <span class="token function">divide</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">recover</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token comment">// 복구 선로 후에는 무조건 Success다.</span>

  <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 0</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>필자는 <span><code class="language-text">recover</code></span>라는 함수를 구현하여 실패에 대한 처리를 할 수 있도록 구현했다. 위 코드를 보다시피 매우 간단하다.</p>
<h2 id="에러-타입-제한"><a href="#에러-타입-제한">에러 타입 제한</a></h2>
<p>try-catch의 경우 어떤 에러가 발생할지 알기 어렵다는 점이 있다. 그래서 사용할 함수 내부를 파악하고 사용하는 쪽 <span><code class="language-text">throw</code></span>에서 분기 혹은 타입 패턴 매칭을 사용하는 경우가 많다. 하지만 Result를 사용하면 에러를 구분하여 처리할 수 있다. 다음 코드를 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">sealed</span> <span class="token keyword">class</span> NumberException<span class="token operator">:</span> <span class="token function">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">DivideByZero</span><span class="token punctuation">(</span><span class="token keyword">override</span> <span class="token keyword">val</span> message<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">NumberException</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">TooBig</span><span class="token punctuation">(</span><span class="token keyword">override</span> <span class="token keyword">val</span> message<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">NumberException</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">TooSmall</span><span class="token punctuation">(</span><span class="token keyword">override</span> <span class="token keyword">val</span> message<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">NumberException</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> NumberException<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> a <span class="token operator">+</span> b
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">Failure</span><span class="token punctuation">(</span>NumberException<span class="token punctuation">.</span><span class="token function">TooBig</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Too Big"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">Failure</span><span class="token punctuation">(</span>NumberException<span class="token punctuation">.</span><span class="token function">TooSmall</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Too Small"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Int<span class="token punctuation">,</span> b<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> NumberException<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">Failure</span><span class="token punctuation">(</span>NumberException<span class="token punctuation">.</span><span class="token function">DivideByZero</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Divide By Zero"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span> <span class="token function">divide</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">recover</span> <span class="token punctuation">{</span>
      <span class="token keyword">when</span> <span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">is</span> NumberException<span class="token punctuation">.</span>DivideByZero <span class="token operator">-></span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">is</span> NumberException<span class="token punctuation">.</span>TooBig <span class="token operator">-></span> <span class="token number">100</span>
        <span class="token keyword">is</span> NumberException<span class="token punctuation">.</span>TooSmall <span class="token operator">-></span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// -1</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드에서 <span><code class="language-text">recover</code></span>와 <span><code class="language-text">when</code></span> 부분을 보자. <span><code class="language-text">sealed clas</code></span>를 통해 제한된 타입을 패턴 매칭을 통해 안전하게 처리하는 것을 볼 수 있다. 이를 통해 더욱 더 안전하게 예외를 관리할 수 있다.</p>
<h2 id="monad-comprehension"><a href="#monad-comprehension">Monad Comprehension</a></h2>
<p><span><code class="language-text">flatMap</code></span>을 사용하여 박스를 중첩하지 않아도 된다는 것을 앞서 배웠다. 웬만하면 <span><code class="language-text">flatMap</code></span>만으로 깔끔하게 코드를 작성하는 것이 가능하지만 다음과 같은 경우가 있을 수 있다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span> user <span class="token operator">-></span>
      <span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> posts <span class="token operator">-></span>
          posts<span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>userId <span class="token operator">==</span> user<span class="token punctuation">.</span>id <span class="token punctuation">}</span> <span class="token comment">// user가 필요하다.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token keyword">when</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드를 보면 <span><code class="language-text">flatMap</code></span>을 사용하여도 점점 Nested 되기 때문에 코드가 복잡하다. 위 코드처럼 선행된 값을 알아야하기 때문에 Nested한 코드를 어쩔 수 없이 작성하는 경우가 많다. 이를 해결하기 위해 <span><code class="language-text">Monad Comprehension</code></span>이라는 것을 사용할 수 있다. 다만, 이 글에서 예제 코드를 위해 전반적으로 사용하는 Kotlin에선 Monad Comprehension을 지원하지 않는다. 이 기능을 제공하는 언어는 대표적으로 Scala와 Haskell이 있다. 여기서는 Scala 예제를 통해 Monad Comprehension을 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> getUserById<span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span>Exception<span class="token punctuation">,</span> User<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> getAllPosts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span>Exception<span class="token punctuation">,</span> List<span class="token punctuation">[</span>Post<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token keyword">for</span> <span class="token punctuation">{</span>
    user <span class="token keyword">&lt;-</span> getUserById<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    posts <span class="token keyword">&lt;-</span> getAllPosts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>userId <span class="token operator">==</span> user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">yield</span> posts<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>title<span class="token punctuation">)</span>

  result <span class="token keyword">match</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> Right<span class="token punctuation">(</span>posts<span class="token punctuation">)</span> <span class="token keyword">=></span> println<span class="token punctuation">(</span>posts<span class="token punctuation">)</span>
    <span class="token keyword">case</span> Left<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">=></span> println<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드에서 <span><code class="language-text">for ~ yield</code></span> 부분이 For Comprehension이라 부르는 문법으로 Monad Comprehension을 쉽게 사용할 수 있게 해주는 Syntactic Sugar 문법이다. 이런식으로 Nested를 제거할 수 있다. 참고로 Kotlin에서 이 문법 흉내내기 위해서 Context Receiver라는 것을 사용할 수 있다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result<span class="token operator">:</span> Result<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token operator">=</span> binding <span class="token punctuation">{</span>
    <span class="token keyword">val</span> user <span class="token operator">=</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> posts <span class="token operator">=</span> <span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    posts<span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>userId <span class="token operator">==</span> user<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>title <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">when</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>여기서 Context Receiver를 이용한 구현은 이 글의 범위를 벗어나기 때문에 생략한다. 만약 이에 대해 궁금하다면 <a href="https://arrow-kt.io/learn/design/receivers-flatmap/" rel="nofollow noopener noreferrer">ArrowKt 공식 홈페이지</a>를 참고하길 바란다.</p>
<h2 id="중첩-컨테이너-문제"><a href="#중첩-컨테이너-문제">중첩 컨테이너 문제</a></h2>
<p>만약 Result를 다른 모나드와 함께 사용하고 싶다면 어떻게 해야할까? 예를 들면, 위에서 만든 Option 모나드를 함께 사용하고 싶을 수도 있다. 다음 코드를 살펴보자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">getUserById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Option<span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">getPostByUserId</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Post<span class="token punctuation">,</span> Throwable<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span> user <span class="token operator">-></span>
      <span class="token keyword">when</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// user는 Option&lt;User> 타입이다.</span>
        <span class="token keyword">is</span> Option<span class="token punctuation">.</span>Some <span class="token operator">-></span> <span class="token punctuation">{</span>
          <span class="token function">getPostsByUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>value<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> posts <span class="token operator">-></span> 
              posts<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>title <span class="token punctuation">}</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">is</span> Option<span class="token punctuation">.</span>None <span class="token operator">-></span> Result<span class="token punctuation">.</span><span class="token function">Failure</span><span class="token punctuation">(</span><span class="token function">Throwable</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"User not found"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token keyword">when</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Success <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">is</span> Result<span class="token punctuation">.</span>Failure <span class="token operator">-></span> <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드를 보면 <span><code class="language-text">getUserById</code></span> 함수가 <span><code class="language-text">Result&lt;Option&lt;User>, Throwable></code></span> 타입이기 때문에 중간에 패턴 매칭을 통해 박스를 벗겨내는 것을 볼 수 있다. 여기서는 <span><code class="language-text">Option</code></span>을 Nullable로 대체하면 해결할 수 있지만 실제로 여러 모나드를 사용할 경우 점점 코드가 복잡해질 수 있다. 이처럼 이미 다른 모나드를 주력으로 사용하고 있는 상황이라면 문제가 될 수 있다. 예를 들어, Spring 환경에서 Reactive Programming을 위해 Mono, Flux 등을 사용하는 경우 혹은 Rx 계열 라이브러리를 사용하는 경우를 예시로 들 수 있다.</p>
<p>이를 해결하기 위해서는 <strong>Higher-Kinded Type</strong>(이하 HKT)이라는 개념이 필요하다. 다만, 안타깝게도 몇 언어를 제외하면 HKT를 제공하는 언어는 드물기 때문에 이 문제를 해결하기는 쉽지 않다. 이 글 전반적으로 사용되는 Kotlin에선 해당 기능을 제공하지 않는다.</p>
<p>Scala에선 HKT를 지원한다. 이를 통해 <strong>Monad Transfomer</strong>이라는 것을 구현할 수 있는데, 이를 통해 문제를 해결할 수 있다.</p>
<span><div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> getUserById<span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span>Exception<span class="token punctuation">,</span> Option<span class="token punctuation">[</span>User<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  Right<span class="token punctuation">(</span>Option<span class="token punctuation">(</span>User<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> getPostsByUserId<span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span>Exception<span class="token punctuation">,</span> List<span class="token punctuation">[</span>Post<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  Right<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Post<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Post<span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> result <span class="token operator">=</span> <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token comment">// OptionT 타입은 cats 라이브러리를 통해 사용했다.</span>
    user <span class="token keyword">&lt;-</span> OptionT<span class="token punctuation">(</span>getUserById<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    posts <span class="token keyword">&lt;-</span> OptionT<span class="token punctuation">.</span>liftF<span class="token punctuation">(</span>getPostsByUserId<span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">yield</span> posts<span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>title<span class="token punctuation">)</span>

  result<span class="token punctuation">.</span>value <span class="token keyword">match</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> Right<span class="token punctuation">(</span>posts<span class="token punctuation">)</span> <span class="token keyword">=></span> println<span class="token punctuation">(</span>posts<span class="token punctuation">)</span>
    <span class="token keyword">case</span> Left<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">=></span> println<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>위 코드를 보다시피 Nested한 코드가 제거되어 조금 더 깔끔한 모습을 볼 수 있다. 아쉽게도 이를 지원하지 않는 언어는 사용이 불가능하다. 따라서 ROP를 도입하고 싶은 개발자는 자신의 환경을 고려할 필요가 있다.</p>
<h1 id="마치며"><a href="#마치며">마치며</a></h1>
<p>ROP를 사용한다면 조금 더 안전하고 직관적인 코딩을 할 수 있다. 다만, 환경에 따라 사용하기 힘들 수 있으니 이를 고려하여 사용하도록 하자. 또한, ROP를 사용하더라도 모든 함수에 대해 Result를 사용하는 것은 권장하지 않는다. 이는 코드의 가독성을 떨어뜨릴 수 있기 때문이다. 따라서, 필요한 함수에 대해서만 사용하는 것이 좋다.</p></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7M8K7EBEDX"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-7M8K7EBEDX', {"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2023-07-17-railway-oriented-programming/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-166e69d850967d98eec6.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-6759857f5bd0a16abdff.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-0f280757e439b5ae50d7.js\"],\"component---src-pages-bookshelf-tsx\":[\"/component---src-pages-bookshelf-tsx-00c0a42b1a986440000d.js\"],\"component---src-pages-business-card-tsx\":[\"/component---src-pages-business-card-tsx-d15363e85a44b2f2ec82.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-3177a74e6d917ef1d92c.js\"],\"component---src-pages-timeline-tsx\":[\"/component---src-pages-timeline-tsx-fdaa746b747c17ab9975.js\"],\"component---src-posts-2021-02-23-first-post-md\":[\"/component---src-posts-2021-02-23-first-post-md-68235a9324b44a239285.js\"],\"component---src-posts-2021-02-25-about-mongodb-mdx\":[\"/component---src-posts-2021-02-25-about-mongodb-mdx-491b97155ed5053a749b.js\"],\"component---src-posts-2021-02-28-basic-web-hacking-mdx\":[\"/component---src-posts-2021-02-28-basic-web-hacking-mdx-e88cf62ee63386b89585.js\"],\"component---src-posts-2021-03-14-effective-atomic-design-mdx\":[\"/component---src-posts-2021-03-14-effective-atomic-design-mdx-29f61b3ed844d58dd717.js\"],\"component---src-posts-2021-03-20-deep-dive-into-datetime-mdx\":[\"/component---src-posts-2021-03-20-deep-dive-into-datetime-mdx-5161635181ff3c1b4d2d.js\"],\"component---src-posts-2022-08-05-programmers-brain-book-report-mdx\":[\"/component---src-posts-2022-08-05-programmers-brain-book-report-mdx-aabd3bc987deeda83430.js\"],\"component---src-posts-2022-08-16-polymorphic-react-component-mdx\":[\"/component---src-posts-2022-08-16-polymorphic-react-component-mdx-2326296b87c37bdca931.js\"],\"component---src-posts-2022-08-31-the-nature-of-software-development-book-report-mdx\":[\"/component---src-posts-2022-08-31-the-nature-of-software-development-book-report-mdx-19bcca0525027489c62a.js\"],\"component---src-posts-2022-09-08-software-master-book-report-mdx\":[\"/component---src-posts-2022-09-08-software-master-book-report-mdx-61acc151ee5ec539d4c5.js\"],\"component---src-posts-2022-09-18-crafting-esolang-mdx\":[\"/component---src-posts-2022-09-18-crafting-esolang-mdx-d1a6eac74821d3f5e295.js\"],\"component---src-posts-2023-05-03-spring-multi-module-architecture-mdx\":[\"/component---src-posts-2023-05-03-spring-multi-module-architecture-mdx-259d62e4991399e5d554.js\"],\"component---src-posts-2023-07-10-effective-work-mdx\":[\"/component---src-posts-2023-07-10-effective-work-mdx-ff36760795e4a3f51541.js\"],\"component---src-posts-2023-07-17-railway-oriented-programming-mdx\":[\"/component---src-posts-2023-07-17-railway-oriented-programming-mdx-00186813e9d6881bc7cf.js\"],\"component---src-posts-2023-07-24-functional-data-structure-mdx\":[\"/component---src-posts-2023-07-24-functional-data-structure-mdx-6a8bc98e10671b25451d.js\"],\"component---src-posts-2023-11-08-retrace-my-life-mdx\":[\"/component---src-posts-2023-11-08-retrace-my-life-mdx-c4b5da1570a294bed7fe.js\"],\"component---src-posts-2023-12-05-what-is-beautiful-code-mdx\":[\"/component---src-posts-2023-12-05-what-is-beautiful-code-mdx-17d5d0cd7f4da0323ea6.js\"],\"component---src-posts-2023-12-24-developers-learning-and-growth-mdx\":[\"/component---src-posts-2023-12-24-developers-learning-and-growth-mdx-ebcf93388c9f5d60a918.js\"],\"component---src-posts-2024-01-21-type-driven-development-mdx\":[\"/component---src-posts-2024-01-21-type-driven-development-mdx-d67e393cc4f7715069e5.js\"],\"component---src-posts-2024-01-23-linear-method-mdx\":[\"/component---src-posts-2024-01-23-linear-method-mdx-fda82ceb595bf6129e72.js\"],\"component---src-posts-2024-02-18-render-delegation-react-component-mdx\":[\"/component---src-posts-2024-02-18-render-delegation-react-component-mdx-4dc555d1ccaacc08585d.js\"],\"component---src-posts-2024-03-03-ascii-3-d-renderer-mdx\":[\"/component---src-posts-2024-03-03-ascii-3-d-renderer-mdx-1dfe47fbe3492badbbad.js\"],\"component---src-posts-2024-03-16-principles-of-debugging-mdx\":[\"/component---src-posts-2024-03-16-principles-of-debugging-mdx-f097da7fb22ce9b712bb.js\"],\"component---src-posts-2024-04-14-encrypted-vault-system-mdx\":[\"/component---src-posts-2024-04-14-encrypted-vault-system-mdx-8b0a59b5b1120f7df247.js\"],\"component---src-posts-2024-04-26-living-with-ai-mdx\":[\"/component---src-posts-2024-04-26-living-with-ai-mdx-8c5a17c0e6bdb048e9bb.js\"],\"component---src-posts-2024-05-10-the-shortcut-mdx\":[\"/component---src-posts-2024-05-10-the-shortcut-mdx-5dae11972cb00ade48e7.js\"],\"component---src-posts-2024-05-17-warp-and-weft-mdx\":[\"/component---src-posts-2024-05-17-warp-and-weft-mdx-72274ae8618d06d84b8e.js\"],\"component---src-posts-2024-06-08-log-1-mdx\":[\"/component---src-posts-2024-06-08-log-1-mdx-3e794cb1422429da9974.js\"],\"component---src-posts-2024-06-09-log-2-mdx\":[\"/component---src-posts-2024-06-09-log-2-mdx-f04eaa8383b993c33836.js\"],\"component---src-posts-2024-06-10-log-3-mdx\":[\"/component---src-posts-2024-06-10-log-3-mdx-4a39ada72345f2bf5389.js\"],\"component---src-posts-2024-06-11-log-4-mdx\":[\"/component---src-posts-2024-06-11-log-4-mdx-cec000d572fc46f39f5d.js\"],\"component---src-posts-2024-06-12-log-5-mdx\":[\"/component---src-posts-2024-06-12-log-5-mdx-6ef9e67ff5fe5ac70d81.js\"],\"component---src-posts-2024-06-13-log-6-mdx\":[\"/component---src-posts-2024-06-13-log-6-mdx-78d51d7bfac03c6fe75d.js\"],\"component---src-posts-2024-06-15-log-7-mdx\":[\"/component---src-posts-2024-06-15-log-7-mdx-0f9b2d38d876d4994a1d.js\"],\"component---src-posts-2024-06-18-log-8-mdx\":[\"/component---src-posts-2024-06-18-log-8-mdx-f6cac8968574126688bf.js\"],\"component---src-posts-2024-07-09-best-prompt-engineering-lesson-mdx\":[\"/component---src-posts-2024-07-09-best-prompt-engineering-lesson-mdx-cc56dfb44da8523c0ef3.js\"],\"component---src-posts-2024-07-11-log-9-mdx\":[\"/component---src-posts-2024-07-11-log-9-mdx-b2ba72b7b68a3784b4ba.js\"],\"component---src-posts-2024-07-27-tidy-first-mdx\":[\"/component---src-posts-2024-07-27-tidy-first-mdx-c5d41b3f443ac3c79ea3.js\"],\"component---src-posts-2024-07-29-copybook-mdx\":[\"/component---src-posts-2024-07-29-copybook-mdx-de2a4c5c788fd62c8f09.js\"],\"component---src-posts-2024-10-12-the-aesthetics-of-destroying-software-mdx\":[\"/component---src-posts-2024-10-12-the-aesthetics-of-destroying-software-mdx-2c6638e7044cd82439f0.js\"],\"component---src-posts-2024-10-27-music-recognition-system-mdx\":[\"/component---src-posts-2024-10-27-music-recognition-system-mdx-e2c1adc0d35b14351f19.js\"],\"component---src-posts-2024-11-10-developers-abstraction-structural-thinking-mdx\":[\"/component---src-posts-2024-11-10-developers-abstraction-structural-thinking-mdx-adc0d76cc0c769102d7a.js\"],\"component---src-posts-2025-01-19-using-kotlin-script-mdx\":[\"/component---src-posts-2025-01-19-using-kotlin-script-mdx-e5a8f78f66a6427e7651.js\"],\"component---src-posts-2025-02-06-data-oriented-programming-mdx\":[\"/component---src-posts-2025-02-06-data-oriented-programming-mdx-b6fec9226d2c992378ec.js\"],\"component---src-posts-2025-02-19-coding-test-story-mdx\":[\"/component---src-posts-2025-02-19-coding-test-story-mdx-cb3527463dfdf37ec635.js\"],\"component---src-posts-2025-03-02-react-component-based-thinking-mdx\":[\"/component---src-posts-2025-03-02-react-component-based-thinking-mdx-ab1e057c8468a6d24e97.js\"],\"component---src-posts-2025-03-12-build-large-scale-react-web-apps-mdx\":[\"/component---src-posts-2025-03-12-build-large-scale-react-web-apps-mdx-8eeeea82a7469dfa07b6.js\"],\"component---src-posts-2025-03-30-destruction-oriented-development-with-ai-mdx\":[\"/component---src-posts-2025-03-30-destruction-oriented-development-with-ai-mdx-a60fa8aa8678a6af8953.js\"],\"component---src-posts-2025-04-09-new-kind-of-hallucination-mdx\":[\"/component---src-posts-2025-04-09-new-kind-of-hallucination-mdx-a3e0dfb5aceed78835b1.js\"],\"component---src-posts-2025-04-10-mcp-from-ux-perspective-mdx\":[\"/component---src-posts-2025-04-10-mcp-from-ux-perspective-mdx-ec8ff37d17de31d3045c.js\"],\"component---src-posts-2025-04-16-modeling-series-foreword-mdx\":[\"/component---src-posts-2025-04-16-modeling-series-foreword-mdx-985b56bedf4cc812c2f5.js\"],\"component---src-posts-2025-04-18-modeling-series-view-model-mdx\":[\"/component---src-posts-2025-04-18-modeling-series-view-model-mdx-0e5a1f7d4c654b3973e7.js\"],\"component---src-posts-2025-04-23-modeling-series-conditional-tree-mdx\":[\"/component---src-posts-2025-04-23-modeling-series-conditional-tree-mdx-9880c24a3bcf20ed46fd.js\"],\"component---src-posts-2025-04-25-multi-paradigm-programming-book-mdx\":[\"/component---src-posts-2025-04-25-multi-paradigm-programming-book-mdx-5dbe858c7e334aff3f2a.js\"],\"component---src-posts-2025-04-26-how-to-build-an-agent-mdx\":[\"/component---src-posts-2025-04-26-how-to-build-an-agent-mdx-f86a020610262125b5f2.js\"],\"component---src-posts-2025-05-01-log-10-mdx\":[\"/component---src-posts-2025-05-01-log-10-mdx-19881a6a65875285cce1.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-02-23-first-post-md\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-02-23-first-post-md-e6855d85fc5976c2ec64.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-02-25-about-mongodb-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-02-25-about-mongodb-mdx-e1977a33b68e4d78ba5c.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-02-28-basic-web-hacking-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-02-28-basic-web-hacking-mdx-f67e49f7b20878d66fb0.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-03-14-effective-atomic-design-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-03-14-effective-atomic-design-mdx-62160b980c4794d8b34c.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2021-03-20-deep-dive-into-datetime-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2021-03-20-deep-dive-into-datetime-mdx-8e5c211ff8ce070f2523.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2022-08-05-programmers-brain-book-report-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2022-08-05-programmers-brain-book-report-mdx-0d6949b3883caec5333b.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2022-08-16-polymorphic-react-component-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2022-08-16-polymorphic-react-component-mdx-fe7fb5fd37c0ebf3ba1d.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2022-08-31-the-nature-of-software-development-book-report-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2022-08-31-the-nature-of-software-development-book-report-mdx-e65ca6ea40282c2b2393.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2022-09-08-software-master-book-report-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2022-09-08-software-master-book-report-mdx-6e8137b1b7acd23d4146.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2022-09-18-crafting-esolang-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2022-09-18-crafting-esolang-mdx-33f43ebf87b0d50ad89c.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-05-03-spring-multi-module-architecture-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-05-03-spring-multi-module-architecture-mdx-b1e83b51d0f403af3066.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-07-10-effective-work-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-07-10-effective-work-mdx-4f3a55ce9d33899dfb34.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-07-17-railway-oriented-programming-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-07-17-railway-oriented-programming-mdx-34d0c1e825e26bc6cd45.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-07-24-functional-data-structure-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-07-24-functional-data-structure-mdx-985428c14d526e4e5504.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-11-08-retrace-my-life-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-11-08-retrace-my-life-mdx-48398ffa1d53700f8b3d.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-12-05-what-is-beautiful-code-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-12-05-what-is-beautiful-code-mdx-4e929e1c6843f2d10924.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-12-24-developers-learning-and-growth-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-12-24-developers-learning-and-growth-mdx-33bac49429b446eb5995.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-21-type-driven-development-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-21-type-driven-development-mdx-b83a4eab393a860caa0a.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-23-linear-method-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-23-linear-method-mdx-474625dfd2ab97065c6f.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-02-18-render-delegation-react-component-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-02-18-render-delegation-react-component-mdx-1dcee4d55cae7dde864f.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-03-03-ascii-3-d-renderer-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-03-03-ascii-3-d-renderer-mdx-f9e68ad0aaae763e2702.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-03-16-principles-of-debugging-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-03-16-principles-of-debugging-mdx-20647efe42d192a10348.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-04-14-encrypted-vault-system-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-04-14-encrypted-vault-system-mdx-76912286c926cbb05941.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-04-26-living-with-ai-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-04-26-living-with-ai-mdx-3ae935c63b6992902a3d.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-05-10-the-shortcut-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-05-10-the-shortcut-mdx-c669aefb6c6e6b85233e.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-05-17-warp-and-weft-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-05-17-warp-and-weft-mdx-d5f0f3b8b1dae75f01d5.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-06-08-log-1-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-06-08-log-1-mdx-80a3d8d7bdb5e04a91f8.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-06-09-log-2-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-06-09-log-2-mdx-76f20e07696b73bf5208.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-06-10-log-3-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-06-10-log-3-mdx-c4dc73c0b088878531ed.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-06-11-log-4-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-06-11-log-4-mdx-143b63c50c599c96f195.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-06-12-log-5-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-06-12-log-5-mdx-c5b2afe4fcbbe236d09f.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-06-13-log-6-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-06-13-log-6-mdx-860c0f313477e4ffbe06.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-06-15-log-7-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-06-15-log-7-mdx-c137c32bcf5b335a3aad.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-06-18-log-8-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-06-18-log-8-mdx-c8d41bc199879ba3e0ac.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-07-09-best-prompt-engineering-lesson-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-07-09-best-prompt-engineering-lesson-mdx-a8d1d1f2fe5a80309603.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-07-11-log-9-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-07-11-log-9-mdx-6f20b822a8da8edc34c0.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-07-27-tidy-first-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-07-27-tidy-first-mdx-09244c621625cd01d79e.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-07-29-copybook-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-07-29-copybook-mdx-8d4d5c8182aee2a2c445.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-10-12-the-aesthetics-of-destroying-software-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-10-12-the-aesthetics-of-destroying-software-mdx-29dde860bfb5b6ca3641.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-10-27-music-recognition-system-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-10-27-music-recognition-system-mdx-54b56ea421ecf067c630.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-11-10-developers-abstraction-structural-thinking-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-11-10-developers-abstraction-structural-thinking-mdx-ca140d78edc4872422b9.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-01-19-using-kotlin-script-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-01-19-using-kotlin-script-mdx-6085ffae96d13f66deda.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-02-06-data-oriented-programming-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-02-06-data-oriented-programming-mdx-81da6b22c44bab245dd4.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-02-19-coding-test-story-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-02-19-coding-test-story-mdx-69130978a7f6c89a9380.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-03-02-react-component-based-thinking-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-03-02-react-component-based-thinking-mdx-a764239850933dd07dff.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-03-12-build-large-scale-react-web-apps-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-03-12-build-large-scale-react-web-apps-mdx-9dd9b7e6b7421c1eca0b.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-03-30-destruction-oriented-development-with-ai-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-03-30-destruction-oriented-development-with-ai-mdx-0187e2c4fbe0483fd819.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-04-09-new-kind-of-hallucination-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-04-09-new-kind-of-hallucination-mdx-c3360733ccbc775e3e7d.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-04-10-mcp-from-ux-perspective-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-04-10-mcp-from-ux-perspective-mdx-f3cd93f17f344d3535eb.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-04-16-modeling-series-foreword-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-04-16-modeling-series-foreword-mdx-e7b02973582f480dd221.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-04-18-modeling-series-view-model-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-04-18-modeling-series-view-model-mdx-6093cf973caa01df2ac3.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-04-23-modeling-series-conditional-tree-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-04-23-modeling-series-conditional-tree-mdx-8b40af5fc98f9a75c5f4.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-04-25-multi-paradigm-programming-book-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-04-25-multi-paradigm-programming-book-mdx-212683cf7bbc2b8680aa.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-04-26-how-to-build-an-agent-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-04-26-how-to-build-an-agent-mdx-58b16eb66b89788c47ef.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-05-01-log-10-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-05-01-log-10-mdx-7a742fd8d175651f76ce.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="acd8bb4ca1f2a2effa16";</script><script src="/webpack-runtime-e642a4e922e1441cdbcd.js" async></script><script src="/app-166e69d850967d98eec6.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>