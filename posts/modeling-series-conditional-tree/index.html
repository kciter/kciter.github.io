<!DOCTYPE html><html lang="ko"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="color-scheme" content="light"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="alternate" type="application/rss+xml" title="kciter.so" href="/feed.xml"><title>모델링 시리즈: 조건 트리 | kciter.so</title><meta name="description" content="들어가며 고객이 장바구니에 상품 X를 담고 있을 때 첫 구매자거나 최근 한 달 내 구매 금액이 10만 원 이상이면서 등급이 VIP라면 쿠폰을 노출해주세요 위와 같이 복잡한 조건을 평가해야 한다면 어떻게 구현 해야할까? 요구사항이 많지 않을 때는…"><meta name="author" content="Lee Sun-Hyoup"><!-- Open Graph --><meta property="og:title" content="모델링 시리즈: 조건 트리 | kciter.so"><meta property="og:description" content="들어가며 고객이 장바구니에 상품 X를 담고 있을 때 첫 구매자거나 최근 한 달 내 구매 금액이 10만 원 이상이면서 등급이 VIP라면 쿠폰을 노출해주세요 위와 같이 복잡한 조건을 평가해야 한다면 어떻게 구현 해야할까? 요구사항이 많지 않을 때는…"><meta property="og:type" content="website"><meta property="og:site_name" content="kciter.so"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://kciter.so/images/2025-04-23-modeling-series-conditional-tree/thumbnail.png"><meta property="og:url" content="https://kciter.so/posts/modeling-series-conditional-tree/"><link rel="canonical" href="https://kciter.so/posts/modeling-series-conditional-tree/"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="Sunhyoup Lee"><meta name="twitter:title" content="모델링 시리즈: 조건 트리 | kciter.so"><meta name="twitter:description" content="들어가며 고객이 장바구니에 상품 X를 담고 있을 때 첫 구매자거나 최근 한 달 내 구매 금액이 10만 원 이상이면서 등급이 VIP라면 쿠폰을 노출해주세요 위와 같이 복잡한 조건을 평가해야 한다면 어떻게 구현 해야할까? 요구사항이 많지 않을 때는…"><meta name="twitter:image" content="https://kciter.so/images/2025-04-23-modeling-series-conditional-tree/thumbnail.png"><!-- Additional meta from props --><meta name="article:published_time" content="2025-04-23T00:00:00+09:00"><meta name="image" content="https://kciter.so/images/2025-04-23-modeling-series-conditional-tree/thumbnail.png"><meta property="og:image" content="https://kciter.so/images/2025-04-23-modeling-series-conditional-tree/thumbnail.png"><meta property="og:image:secure_url" content="https://kciter.so/images/2025-04-23-modeling-series-conditional-tree/thumbnail.png"><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400&family=PT+Sans:wght@400&family=Source+Code+Pro&family=Quattrocento+Sans&display=swap"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-7M8K7EBEDX"></script><script>
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-7M8K7EBEDX');
        </script> <script type="application/ld+json">{"headline":"모델링 시리즈: 조건 트리","dateModified":"2025-04-23T00:00:00+09:00","datePublished":"2025-04-23T00:00:00+09:00","image":"https://kciter.so/images/2025-04-23-modeling-series-conditional-tree/thumbnail.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://kciter.so/posts/modeling-series-conditional-tree/"},"author":{"@type":"Person","name":"Lee Sun-Hyoup"},"description":"들어가며 고객이 장바구니에 상품 X를 담고 있을 때 첫 구매자거나 최근 한 달 내 구매 금액이 10만 원 이상이면서 등급이 VIP라면 쿠폰을 노출해주세요 위와 같이 복잡한 조건을 평가해야 한다면 어떻게 구현 해야할까? 요구사항이 많지 않을 때는…","url":"https://kciter.so/posts/modeling-series-conditional-tree/","@type":"BlogPosting","@context":"https://schema.org"}</script> <link rel="stylesheet" href="/_astro/_slug_.D5IQWdfx.css">
<style>.name-gradient[data-astro-cid-k7qsseos]{background:linear-gradient(to right,#191335,#191335 33.33333%,#00ab6c 66.66666%,#00cb8c);background-clip:text;-webkit-text-fill-color:transparent;transition:all .3s ease;background-size:300% 100%;background-position:top left}.name-gradient[data-astro-cid-k7qsseos]:hover{background-position:top left 100%}@media(max-width:30rem){.sponsors[data-astro-cid-4kgnabjz] a:not(:first-of-type){margin-left:-16px}}.related-post[data-astro-cid-llggujpl]{position:relative;transform:scaleZ(1)}.related-post[data-astro-cid-llggujpl]:after{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:8px;transform:scale(1.06);transition:opacity 2s cubic-bezier(.165,.84,.44,1);box-shadow:0 8px 17px #0003,0 6px 20px #00000026;content:"";opacity:0;z-index:-1}.related-post[data-astro-cid-llggujpl]:hover{transform:scale3d(1.006,1.006,1)}.related-post[data-astro-cid-llggujpl]:hover:after{opacity:1}
</style></head> <body> <div class="mx-auto w-[715px] pt-4 max-md:w-[90vw]"> <div class="relative z-10 mb-10 -mx-4 rounded-xl bg-white/40 px-4 py-2.5 font-['Quattrocento_Sans',sans-serif] backdrop-blur-[44px] max-md:-mx-4 max-md:-mt-4 max-md:mb-8 max-md:rounded-none max-md:bg-transparent max-md:backdrop-blur-none" data-astro-cid-3ef6ksr2> <div class="mt-2 w-full" data-astro-cid-3ef6ksr2> <a href="/" class="site-title text-[32px] font-black" style="line-height: 1.15; text-decoration: none; margin-right: 5px;" data-astro-cid-3ef6ksr2>kciter.so</a> <small class="text-[#999]" data-astro-cid-3ef6ksr2>devlog</small> </div> <nav class="flex w-full justify-between pt-2" data-astro-cid-3ef6ksr2> <div class="flex items-center" data-astro-cid-3ef6ksr2> <a href="/timeline/" class="menu-item updated" data-astro-cid-3ef6ksr2>
Timeline
</a> <div class="dropdown" data-astro-cid-3ef6ksr2> <span class="menu-item dropdown-trigger" id="posts-trigger" data-astro-cid-3ef6ksr2>
Posts <span class="chevron" data-astro-cid-3ef6ksr2>&#9662;</span> </span> <div class="dropdown-menu" data-astro-cid-3ef6ksr2> <a href="/articles/" class="dropdown-item" data-astro-cid-3ef6ksr2>Articles</a> <a href="/bookshelf/" class="dropdown-item" data-astro-cid-3ef6ksr2>Bookshelf</a> <a href="/thought/" class="dropdown-item" data-astro-cid-3ef6ksr2>Thoughts</a> </div> </div> <a href="https://kciter.so/talks/" class="menu-item" data-astro-cid-3ef6ksr2>Talks</a> <a href="/about/" class="menu-item" data-astro-cid-3ef6ksr2>About</a> </div> <div class="flex items-center gap-3" data-astro-cid-3ef6ksr2> <button id="search-btn" class="search-btn" aria-label="Search" data-astro-cid-3ef6ksr2> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-3ef6ksr2> <circle cx="11" cy="11" r="8" data-astro-cid-3ef6ksr2></circle> <line x1="21" y1="21" x2="16.65" y2="16.65" data-astro-cid-3ef6ksr2></line> </svg> </button> <div class="max-md:hidden" data-astro-cid-3ef6ksr2> <a href="https://github.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="GitHub" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.2 11.38.6.12.83-.26.83-.57v-2.2c-3.34.73-4.04-1.44-4.04-1.44-.55-1.38-1.33-1.75-1.33-1.75-1.09-.74.08-.73.08-.73 1.2.09 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.49 1 .1-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6.02 0c2.28-1.55 3.28-1.23 3.28-1.23.66 1.66.25 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .31.22.7.83.57C20.57 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z"/></svg></a><a href="https://www.facebook.com/sunhyoup.lee" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="Facebook" style="--hover-color: #3d5b99; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M24 12.07C24 5.41 18.63 0 12 0S0 5.41 0 12.07c0 6.02 4.39 11.02 10.13 11.93v-8.44H7.08v-3.49h3.04V9.41c0-3.02 1.79-4.68 4.53-4.68 1.31 0 2.68.24 2.68.24v2.97h-1.51c-1.49 0-1.95.93-1.95 1.88v2.26h3.33l-.53 3.49h-2.8v8.44C19.61 23.09 24 18.09 24 12.07z"/></svg></a><a href="https://www.linkedin.com/in/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="LinkedIn" style="--hover-color: #0073a4; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M20.45 20.45h-3.55v-5.57c0-1.33-.02-3.04-1.85-3.04-1.85 0-2.14 1.45-2.14 2.94v5.67H9.36V9h3.41v1.56h.05c.48-.9 1.64-1.85 3.37-1.85 3.6 0 4.27 2.37 4.27 5.46v6.28zM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12zM7.12 20.45H3.56V9h3.56v11.45zM22.22 0H1.77C.79 0 0 .77 0 1.72v20.56C0 23.23.79 24 1.77 24h20.45C23.2 24 24 23.23 24 22.28V1.72C24 .77 23.2 0 22.22 0z"/></svg></a><a href="https://twitter.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="X (Twitter)" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href="/feed.xml" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="RSS Feed" style="--hover-color: #ff6600; transition: color .5s;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M6.18 15.64a2.18 2.18 0 1 1 0 4.36 2.18 2.18 0 0 1 0-4.36zM4 4.44v3.57A12.01 12.01 0 0 1 15.99 20h3.57A15.57 15.57 0 0 0 4 4.44zM4 10.1v3.57c3.5 0 6.33 2.84 6.33 6.33h3.57c0-5.47-4.43-9.9-9.9-9.9z"/></svg></a> </div> </div> </nav> <!-- Mobile sub-tab (hidden by default) --> <div class="mobile-tabs" id="mobile-tabs" data-astro-cid-3ef6ksr2> <a href="/articles/" class="mobile-tab" data-astro-cid-3ef6ksr2>Articles</a> <a href="/bookshelf/" class="mobile-tab" data-astro-cid-3ef6ksr2>Bookshelf</a> <a href="/thought/" class="mobile-tab" data-astro-cid-3ef6ksr2>Thoughts</a> </div> </div> <!-- Search Modal --> <div id="search-modal" class="search-modal" data-astro-cid-3ef6ksr2> <div class="search-backdrop" data-astro-cid-3ef6ksr2></div> <div class="search-container" data-astro-cid-3ef6ksr2> <div class="search-input-wrap" data-astro-cid-3ef6ksr2> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-3ef6ksr2> <circle cx="11" cy="11" r="8" data-astro-cid-3ef6ksr2></circle> <line x1="21" y1="21" x2="16.65" y2="16.65" data-astro-cid-3ef6ksr2></line> </svg> <input id="search-input" type="text" placeholder="Search posts..." autocomplete="off" data-astro-cid-3ef6ksr2> <kbd class="search-kbd" data-astro-cid-3ef6ksr2>ESC</kbd> </div> <div id="search-results" class="search-results" data-astro-cid-3ef6ksr2></div> </div> </div>  <script type="module">const o=document.getElementById("posts-trigger"),l=document.getElementById("mobile-tabs");if(o&&l){const e=o.querySelector(".chevron");o.addEventListener("click",t=>{window.innerWidth<=768&&(t.preventDefault(),l.classList.toggle("open"),e?.classList.toggle("open"))});const i=window.location.pathname;l.querySelectorAll(".mobile-tab").forEach(t=>{i.startsWith(t.getAttribute("href")||"")&&t.classList.add("active")})}let s=null;async function m(){if(s)return s;try{s=await import(new URL("/pagefind/pagefind.js",window.location.origin).href),await s.init()}catch{console.warn("Pagefind not available (run build first)")}return s}const c=document.getElementById("search-modal"),r=document.getElementById("search-input"),a=document.getElementById("search-results"),p=document.getElementById("search-btn"),v=c.querySelector(".search-backdrop");function f(){c.classList.add("open"),r.value="",a.innerHTML="",setTimeout(()=>r.focus(),50),m()}function d(){c.classList.remove("open")}p.addEventListener("click",f);v.addEventListener("click",d);document.addEventListener("keydown",e=>{(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),c.classList.contains("open")?d():f()),e.key==="Escape"&&d()});let u;r.addEventListener("input",()=>{clearTimeout(u),u=setTimeout(()=>g(r.value),200)});async function g(e){if(!e.trim()){a.innerHTML="";return}const i=await m();if(!i){a.innerHTML='<div class="search-no-results">Search is not available in dev mode.</div>';return}const t=await i.search(e);if(t.results.length===0){a.innerHTML='<div class="search-no-results">No results found.</div>';return}const h=await Promise.all(t.results.slice(0,10).map(n=>n.data()));a.innerHTML=h.map(n=>`
        <a href="${n.url}" class="search-result-item">
          <div class="search-result-title">${n.meta?.title||n.url}</div>
          <div class="search-result-excerpt">${n.excerpt}</div>
        </a>
      `).join("")}</script> <div class="post-container">   <h1 class="post-title">모델링 시리즈: 조건 트리</h1> <span class="post-date">Written on April 23, 2025</span> <img src="/images/2025-04-23-modeling-series-conditional-tree/thumbnail.png" alt="모델링 시리즈: 조건 트리" style="width: 100%;"><div class="toc" data-margin-top="50"><ul class="toc-list"><li><a href="#들어가며">들어가며</a></li><li><a href="#조건을-추상화-하는-방법">조건을 추상화 하는 방법</a></li><li><a href="#모델-설계">모델 설계</a></li><li><a href="#구현">구현</a><ul class="toc-list"><li><a href="#모델-구현">모델 구현</a></li><li><a href="#evaluator-구현">Evaluator 구현</a></li><li><a href="#엔티티-모델-구현">엔티티 모델 구현</a></li><li><a href="#tree-loader-구현">Tree Loader 구현</a></li><li><a href="#사용-예시">사용 예시</a></li></ul></li><li><a href="#rule-engine과-차이점">Rule Engine과 차이점</a></li><li><a href="#마치며">마치며</a><ul class="toc-list"><li><a href="#footnote-label">Footnotes</a></li></ul></li></ul></div><div class="mt-2 box-border w-full rounded-lg bg-[#f8f9fa] p-4"> <div class="mb-2 text-xl font-bold">모델링 시리즈</div> <ul style="margin: 0; padding: 0; padding-left: 24px;"> <li style> <a href="/posts/modeling-series-foreword/" style="text-decoration: none; color: #333;"> 모델링 시리즈: 서문 </a> </li><li style> <a href="/posts/modeling-series-view-model/" style="text-decoration: none; color: #333;"> 모델링 시리즈: 뷰모델 </a> </li><li style="color: #00a962;"> <a href="/posts/modeling-series-conditional-tree/" style="text-decoration: none; color: #333; font-weight: bold;"> 모델링 시리즈: 조건 트리 </a> </li><li style> <a href="/posts/modeling-series-measure/" style="text-decoration: none; color: #333;"> 모델링 시리즈: 측도 </a> </li><li style> <a href="/posts/modeling-series-temporal/" style="text-decoration: none; color: #333;"> 모델링 시리즈: 시간 </a> </li> </ul> </div><div class="post-content" data-pagefind-body>  <h1 id="들어가며"><a href="#들어가며">들어가며</a></h1>
<blockquote>
<p>고객이 장바구니에 상품 X를 담고 있을 때 첫 구매자거나 최근 한 달 내 구매 금액이 10만 원 이상이면서 등급이 VIP라면 쿠폰을 노출해주세요</p>
</blockquote>
<p>위와 같이 복잡한 조건을 평가해야 한다면 어떻게 구현 해야할까? 요구사항이 많지 않을 때는 간단히 <code>if</code>를 사용하여 빠르게 구현할 수 있지만, 제품이 성숙해질수록 요구사항이 복잡해지기 마련이다.</p>
<ul>
<li>다양한 상황에 대한 조건을 평가해야 한다.</li>
<li>관리자가 개발자에 의존하지 않고 편집할 수 있길 원한다.</li>
<li>런타임 도중에 조건을 변경할 수 있어야 한다.</li>
<li>평가 데이터는 실시간으로 변할 수 있다.</li>
</ul>
<p>이런 요구사항을 충족하기 위해선 단순히 <code>if</code> 문을 사용해 조건을 평가하는 것만으로는 부족하다. 이를 해결하기 위한 강력한 패턴 중 하나가 바로 조건 트리(Condition Tree)라고 할 수 있다.</p>
<p>이번 글에서는 조건 트리가 무엇인지, 어떻게 설계하고 구현할 수 있는지에 대해 설명할 것이다. 조건 트리는 마케팅, 개인화, 권한 관리 등 다양한 곳에서 사용될 수 있다.</p>
<p>예를 들어, 마케팅에서는 특정 조건을 만족하는 사용자에게만 쿠폰을 발급하거나, 개인화된 추천 상품을 제공하는 데 사용될 수 있다. 또한, 권한 관리에서는 특정 조건을 만족하는 사용자에게만 특정 기능이나 리소스에 대한 접근 권한을 부여하는 데 사용될 수 있다.</p>
<h1 id="조건을-추상화-하는-방법"><a href="#조건을-추상화-하는-방법">조건을 추상화 하는 방법</a></h1>
<p>언뜻 복잡한 조건을 추상화한다는 것이 매우 복잡하고 어려운 일처럼 보일 수 있다. 하지만 침착하게 접근하면 생각보다 간단하다. 모든 추상화는 <strong>필요한 것을 찾아 필요한 것을 뽑아내는 것</strong>부터 시작한다. 다음 조건이 있다고 가정해보자.</p>
<blockquote>
<p>나이가 18세 이상이면서 첫 구매거나 VIP인 경우</p>
</blockquote>
<p>위 조건은 복잡해 보이지만, 사실 ‘조건식’과 ‘조건 연산자’ 두 가지 요소로 나눌 수 있다. 문장에서 조건식만 추상화 한다면 다음과 같다.</p>
<blockquote>
<p>[나이가 18세 이상]<span style="color:#999">이면서</span> [첫 구매]<span style="color:#999">거나</span> [VIP]<span style="color:#999">인 경우</span></p>
<ul>
<li>나이가 18세 이상 (age &gt;= 18)</li>
<li>첫 구매 (purchaseCount == 0)</li>
<li>VIP (level == VIP)</li>
</ul>
</blockquote>
<p>그럼 이번에는 조건 연산자만 추상화 해보자.</p>
<blockquote>
<p><span style="color:#999">나이가 18세 이상</span>이면서(AND) <span style="color:#999">첫 구매</span>거나(OR) <span style="color:#999">VIP인 경우</span></p>
<ul>
<li>AND</li>
<li>OR</li>
</ul>
</blockquote>
<p>두 관점을 결합하여 문장을 추상화하면 다음과 같다</p>
<blockquote>
<p>age &gt;= 18 AND (purchaseCount == 0 OR level == VIP)</p>
</blockquote>
<p>이제 조건을 평가하기만 하면 된다. 하지만 조건 연산자엔 우선 순위가 있을 수 있다. 이런 경우 어떻게 처리할까?</p>
<p>알고리즘을 열심히 공부했다면 수식을 트리 형태로 표현하고 재귀 호출로 계산하는 방법을 본적이 있을 것이다. 이와 비슷한 방법으로 조건을 트리 형태로 표현할 수 있다.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>        AND</span></span>
<span class="line"><span>    ┌────┴─────────┐</span></span>
<span class="line"><span>(age ≥ 18)        OR</span></span>
<span class="line"><span>          ┌────────┴─────────┐</span></span>
<span class="line"><span>  (purchaseCount == 0) (level == VIP)</span></span></code></pre>
<p>위와 같이 트리를 만들었다면 재귀적으로 평가할 수 있다. 트리의 각 노드는 조건식과 조건 연산자로 구성되어 있으며, 자식 노드를 가질 수 있다. 자식 노드가 없을 경우 Leaf 노드라고 부르며, 자식 노드가 있을 경우 Composite 노드라고 부른다.</p>
<ul>
<li><strong>Composite 노드</strong><br/>AND, OR, NOT과 같은 복합 조건을 나타내며 자식 노드를 가질 수 있다.</li>
<li><strong>Leaf 노드</strong><br/>단일 조건을 나타내며 자식 노드를 가지지 않는다. 특정 속성(attribute)과 연산자(operator), 값(value)이 결합된 식을 포함한다. 예를 들어 “사용자의 나이 &gt;= 18”과 같은 조건을 표현할 수 있다.</li>
</ul>
<p>이러한 구조는 <a href="https://refactoring.guru/design-patterns/composite" rel="noopener noreferrer" target="_blank">Composite 패턴</a>을 활용한 것으로, 단순한 조건부터 복잡한 조건까지 일관된 방식으로 표현하는 것이 가능하다.</p>
<p>앞서 문장을 추상화하고 트리라는 구조로 표현한 것처럼 추상적, 구조적인 사고는 다양한 곳에 활용할 수 있다. 이러한 감각을 익혀나가면 복잡한 문제를 해결하는 데 큰 도움이 되므로 기회가 된다면 연습해보길 권장한다.</p>
<h1 id="모델-설계"><a href="#모델-설계">모델 설계</a></h1>
<p>조건 트리에 대해 이해했다면 모델 설계와 구현은 어렵지 않다. 조건 트리는 Composite 패턴을 활용했기 때문에 거의 그대로 설계할 수 있다. 다만, Leaf 노드에서 속성과 식을 어떻게 표현할지만 고민하면 된다. 그리고 조건 트리를 평가하기 위한 로직도 필요하다.</p>
<p>먼저 조건 트리에 대한 도식을 그려보자.</p>
<style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z4vp29" prefix="r3" component-url="/_astro/Image.BKsTl0S2.js" component-export="default" renderer-url="/_astro/client.C9fCgUO1.js" props="{&quot;src&quot;:[0,&quot;/images/2025-04-23-modeling-series-conditional-tree/conditional-tree-uml.png&quot;],&quot;caption&quot;:[0,&quot;조건 트리 도식&quot;],&quot;expandable&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;Image&quot;,&quot;value&quot;:true}" await-children><figure><img src="/images/2025-04-23-modeling-series-conditional-tree/conditional-tree-uml.png" alt="조건 트리 도식" loading="lazy" width="100%" style="cursor:zoom-in;margin:0 auto;display:block"/><figcaption>조건 트리 도식</figcaption></figure><!--astro:end--></astro-island>
<p>위 도식은 조건 트리의 기본 구조를 나타낸다. 각 모델이 어떤 역할을 하는지 살펴보자.</p>
<ul>
<li><code>ConditionNode</code>: 조건 트리의 기본 노드로, Leaf 노드와 Composite 노드에 대한 인터페이스다.</li>
<li><code>LeafCondition</code>: Leaf 노드로, 단일 조건을 나타낸다. 속성(attribute), 연산자(operator), 값(value)을 포함한다.</li>
<li><code>CompositeCondition</code>: Composite 노드로, 복합 조건을 나타낸다. 자식 노드를 가질 수 있으며, AND, OR, NOT과 같은 논리 연산자를 포함한다.</li>
</ul>
<p>위와 같이 조건 트리 모델을 설계할 수 있다. 하지만 해당 모델은 데이터베이스 환경이 고려되지 않았다. 만약 RDB를 사용한다면 <a href="https://en.wikipedia.org/wiki/Object%E2%80%93relational_impedance_mismatch" rel="noopener noreferrer" target="_blank">객체-관계 불일치</a><sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref aria-describedby="footnote-label">1</a></sup>로 인해 별도로 엔티티 모델을 설계해야 한다.<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref aria-describedby="footnote-label">2</a></sup> 다음은 조건 트리 모델을 데이터베이스에 저장하기 위한 엔티티 모델이다.</p>
<astro-island uid="ZYzr4B" prefix="r4" component-url="/_astro/Image.BKsTl0S2.js" component-export="default" renderer-url="/_astro/client.C9fCgUO1.js" props="{&quot;src&quot;:[0,&quot;/images/2025-04-23-modeling-series-conditional-tree/conditional-tree-entity-uml.png&quot;],&quot;caption&quot;:[0,&quot;조건 트리 엔티티 도식&quot;],&quot;expandable&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;Image&quot;,&quot;value&quot;:true}" await-children><figure><img src="/images/2025-04-23-modeling-series-conditional-tree/conditional-tree-entity-uml.png" alt="조건 트리 엔티티 도식" loading="lazy" width="100%" style="cursor:zoom-in;margin:0 auto;display:block"/><figcaption>조건 트리 엔티티 도식</figcaption></figure><!--astro:end--></astro-island>
<p>조건 트리 자체가 크게 복잡하지 않으므로 <code>ConditionNodeEntity</code> 하나로 모든 노드를 표현할 수 있다. Leaf 노드와 Composite 노드를 구분하기 위해 <code>NodeType</code>을 추가했고 <code>parent_id</code>를 통해 부모 노드를 참조할 수 있도록 했다. 이를 통해 트리 구조를 표현할 수 있다.</p>
<h1 id="구현"><a href="#구현">구현</a></h1>
<p>설계는 일종의 계획이다. 계획을 세웠으니 이제 실제 구현을 해보자. 이 글에서는 Kotlin을 사용하여 조건 트리를 구현할 것이다. 그리고 특정 프레임워크를 고려하지 않으므로 일종의 의사 코드라고 생각하고 보는 것을 추천한다. 실제 구현은 사용하는 프레임워크에 맞게 조정해야 한다.</p>
<h2 id="모델-구현"><a href="#모델-구현">모델 구현</a></h2>
<p>앞서 소개한 예시처럼 사용자 정보에 대한 속성을 기반으로 조건 트리 모델을 만들어보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#D73A49">sealed</span><span style="color:#D73A49"> interface</span><span style="color:#6F42C1"> ConditionalNode</span><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> id: </span><span style="color:#6F42C1">Long</span><span style="color:#24292E">?</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">data</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> LeafCondition</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#D73A49">  override</span><span style="color:#D73A49"> val</span><span style="color:#24292E"> id: </span><span style="color:#6F42C1">Long</span><span style="color:#24292E">?,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> attribute: </span><span style="color:#6F42C1">String</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#D73A49"> operator</span><span style="color:#24292E">: </span><span style="color:#6F42C1">ConditionOperator</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#D73A49"> value</span><span style="color:#24292E">: </span><span style="color:#6F42C1">String</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> valueType: </span><span style="color:#6F42C1">String</span></span>
<span class="line"><span style="color:#24292E">) : </span><span style="color:#6F42C1">ConditionalNode</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">  enum</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ConditionOperator</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    EQ,</span></span>
<span class="line"><span style="color:#24292E">    NEQ,</span></span>
<span class="line"><span style="color:#24292E">    GT,</span></span>
<span class="line"><span style="color:#24292E">    GTE,</span></span>
<span class="line"><span style="color:#24292E">    LT,</span></span>
<span class="line"><span style="color:#24292E">    LTE</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">data</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> CompositeCondition</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#D73A49">  override</span><span style="color:#D73A49"> val</span><span style="color:#24292E"> id: </span><span style="color:#6F42C1">Long</span><span style="color:#24292E">?,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> logic: </span><span style="color:#6F42C1">LogicalOperator</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> children: </span><span style="color:#6F42C1">List</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ConditionalNode</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">) : </span><span style="color:#6F42C1">ConditionalNode</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">  enum</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> LogicalOperator</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    AND,</span></span>
<span class="line"><span style="color:#24292E">    OR,</span></span>
<span class="line"><span style="color:#24292E">    NOT</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>위 코드는 조건 트리의 기본 구조를 나타낸다. <code>ConditionalNode</code>를 인터페이스로 정의하여 <code>LeafCondition</code>과 <code>CompositeCondition</code>을 구현했다. 앞서 설계한 내용과 크게 다르지 않다.</p>
<h2 id="evaluator-구현"><a href="#evaluator-구현">Evaluator 구현</a></h2>
<p>이어서 조건 트리를 평가하기 위한 <code>ConditionEvaluator</code>를 구현해보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#D73A49">fun interface</span><span style="color:#6F42C1"> AttributeResolver</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">  fun</span><span style="color:#6F42C1"> resolve</span><span style="color:#24292E">(attribute: </span><span style="color:#6F42C1">String</span><span style="color:#24292E">): </span><span style="color:#6F42C1">Any</span><span style="color:#24292E">?</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> ConditionEvaluator</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">  fun</span><span style="color:#6F42C1"> evaluate</span><span style="color:#24292E">(condition: </span><span style="color:#6F42C1">ConditionalNode</span><span style="color:#24292E">, resolver: </span><span style="color:#6F42C1">AttributeResolver</span><span style="color:#24292E">): </span><span style="color:#6F42C1">Boolean</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#D73A49"> when</span><span style="color:#24292E"> (condition) {</span></span>
<span class="line"><span style="color:#D73A49">      is</span><span style="color:#24292E"> LeafCondition </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> evaluateLeaf</span><span style="color:#24292E">(condition, resolver)</span></span>
<span class="line"><span style="color:#D73A49">      is</span><span style="color:#24292E"> CompositeCondition </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        val</span><span style="color:#24292E"> results </span><span style="color:#D73A49">=</span><span style="color:#24292E"> condition.children.</span><span style="color:#6F42C1">map</span><span style="color:#24292E"> { </span><span style="color:#6F42C1">evaluate</span><span style="color:#24292E">(it, resolver) }</span></span>
<span class="line"><span style="color:#D73A49">        when</span><span style="color:#24292E"> (condition.logic) {</span></span>
<span class="line"><span style="color:#24292E">          CompositeCondition.LogicalOperator.AND </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> results.</span><span style="color:#6F42C1">all</span><span style="color:#24292E"> { it }</span></span>
<span class="line"><span style="color:#24292E">          CompositeCondition.LogicalOperator.OR </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> results.</span><span style="color:#6F42C1">any</span><span style="color:#24292E"> { it }</span></span>
<span class="line"><span style="color:#24292E">          CompositeCondition.LogicalOperator.NOT </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> results.</span><span style="color:#6F42C1">singleOrNull</span><span style="color:#24292E">()?.</span><span style="color:#6F42C1">not</span><span style="color:#24292E">() ?: </span><span style="color:#005CC5">false</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">      }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p><code>ConditionEvaluator</code>는 조건 트리를 평가하는 역할을 한다. <code>evaluate</code> 메서드는 조건 노드의 타입에 따라 적절한 평가 로직을 호출한다. Leaf 노드인 경우 <code>evaluateLeaf</code> 메서드를 호출하여 조건식을 평가하고, Composite 노드인 경우 자식 노드를 재귀적으로 평가한다.</p>
<p>여기서 <code>AttributeResolver</code>는 평가할 속성에 대한 값을 제공하는 인터페이스다. 이를 통해 조건 트리에서 사용되는 속성(attribute)을 동적으로 제공할 수 있다. <code>evaluateLeaf</code> 메서드는 다음과 같이 구현할 수 있다.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> ConditionEvaluator</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  @Suppress</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;UNCHECKED_CAST&quot;</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#D73A49">  private</span><span style="color:#D73A49"> fun</span><span style="color:#6F42C1"> evaluateLeaf</span><span style="color:#24292E">(leaf: </span><span style="color:#6F42C1">LeafCondition</span><span style="color:#24292E">, resolver: </span><span style="color:#6F42C1">AttributeResolver</span><span style="color:#24292E">): </span><span style="color:#6F42C1">Boolean</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">    // 1. 평가할 속성 값을 조회하고 속성이 없다면 조건을 만족하지 않음</span></span>
<span class="line"><span style="color:#D73A49">    val</span><span style="color:#24292E"> actual </span><span style="color:#D73A49">=</span><span style="color:#24292E"> resolver.</span><span style="color:#6F42C1">resolve</span><span style="color:#24292E">(leaf.attribute) ?: </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 2. String 타입인 조건 값을 변환</span></span>
<span class="line"><span style="color:#D73A49">    val</span><span style="color:#24292E"> expected: </span><span style="color:#6F42C1">Any</span><span style="color:#24292E">? </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> try</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">      convertValue</span><span style="color:#24292E">(leaf.</span><span style="color:#D73A49">value</span><span style="color:#24292E">, leaf.valueType)</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">catch</span><span style="color:#24292E"> (e: </span><span style="color:#6F42C1">Exception</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">      return</span><span style="color:#005CC5"> false</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 3. 변환된 조건 값과 실제 속성 값을 비교 평가</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#D73A49"> when</span><span style="color:#24292E"> (leaf.</span><span style="color:#D73A49">operator</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">      LeafCondition.ConditionOperator.EQ </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> actual </span><span style="color:#D73A49">==</span><span style="color:#24292E"> expected</span></span>
<span class="line"><span style="color:#24292E">      LeafCondition.ConditionOperator.NEQ </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> actual </span><span style="color:#D73A49">!=</span><span style="color:#24292E"> expected</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">      LeafCondition.ConditionOperator.GT,</span></span>
<span class="line"><span style="color:#24292E">      LeafCondition.ConditionOperator.GTE,</span></span>
<span class="line"><span style="color:#24292E">      LeafCondition.ConditionOperator.LT,</span></span>
<span class="line"><span style="color:#24292E">      LeafCondition.ConditionOperator.LTE </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (actual </span><span style="color:#D73A49">!is</span><span style="color:#24292E"> Comparable</span><span style="color:#D73A49">&lt;*&gt;</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> expected </span><span style="color:#D73A49">!is</span><span style="color:#24292E"> Comparable</span><span style="color:#D73A49">&lt;*&gt;</span><span style="color:#24292E">) </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> false</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (actual::</span><span style="color:#6F42C1">class</span><span style="color:#D73A49"> !=</span><span style="color:#24292E"> expected::</span><span style="color:#6F42C1">class</span><span style="color:#24292E">) </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">        val</span><span style="color:#24292E"> left </span><span style="color:#D73A49">=</span><span style="color:#24292E"> actual </span><span style="color:#D73A49">as</span><span style="color:#24292E"> Comparable</span><span style="color:#D73A49">&lt;</span><span style="color:#24292E">Any</span><span style="color:#D73A49">&gt;</span></span>
<span class="line"><span style="color:#D73A49">        val</span><span style="color:#24292E"> right </span><span style="color:#D73A49">=</span><span style="color:#24292E"> expected </span><span style="color:#D73A49">as</span><span style="color:#24292E"> Comparable</span><span style="color:#D73A49">&lt;</span><span style="color:#24292E">Any</span><span style="color:#D73A49">&gt;</span></span>
<span class="line"><span style="color:#D73A49">        when</span><span style="color:#24292E"> (leaf.</span><span style="color:#D73A49">operator</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">          LeafCondition.ConditionOperator.GT </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> left </span><span style="color:#D73A49">&gt;</span><span style="color:#24292E"> right</span></span>
<span class="line"><span style="color:#24292E">          LeafCondition.ConditionOperator.GTE </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> left </span><span style="color:#D73A49">&gt;=</span><span style="color:#24292E"> right</span></span>
<span class="line"><span style="color:#24292E">          LeafCondition.ConditionOperator.LT </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> left </span><span style="color:#D73A49">&lt;</span><span style="color:#24292E"> right</span></span>
<span class="line"><span style="color:#24292E">          LeafCondition.ConditionOperator.LTE </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> left </span><span style="color:#D73A49">&lt;=</span><span style="color:#24292E"> right</span></span>
<span class="line"><span style="color:#D73A49">          else</span><span style="color:#D73A49"> -&gt;</span><span style="color:#005CC5"> false</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">      }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // String 타입인 조건 값을 변환하는 메서드</span></span>
<span class="line"><span style="color:#D73A49">  private</span><span style="color:#D73A49"> fun</span><span style="color:#6F42C1"> convertValue</span><span style="color:#24292E">(</span><span style="color:#D73A49">value</span><span style="color:#24292E">: </span><span style="color:#6F42C1">String</span><span style="color:#24292E">, type: </span><span style="color:#6F42C1">String</span><span style="color:#24292E">): </span><span style="color:#6F42C1">Any</span><span style="color:#24292E">? {</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">value</span><span style="color:#D73A49"> ==</span><span style="color:#005CC5"> null</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> type </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#D73A49"> when</span><span style="color:#24292E"> (type) {</span></span>
<span class="line"><span style="color:#032F62">      &quot;Long&quot;</span><span style="color:#D73A49">   -&gt;</span><span style="color:#D73A49"> value</span><span style="color:#24292E">.</span><span style="color:#6F42C1">toLongOrNull</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#032F62">      &quot;Int&quot;</span><span style="color:#D73A49">    -&gt;</span><span style="color:#D73A49"> value</span><span style="color:#24292E">.</span><span style="color:#6F42C1">toIntOrNull</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#032F62">      &quot;Boolean&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#D73A49"> value</span><span style="color:#24292E">.</span><span style="color:#6F42C1">toBooleanStrictOrNull</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#032F62">      &quot;Double&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#D73A49"> value</span><span style="color:#24292E">.</span><span style="color:#6F42C1">toDoubleOrNull</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#032F62">      &quot;String&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#D73A49"> value</span></span>
<span class="line"><span style="color:#D73A49">      else</span><span style="color:#D73A49">     -&gt;</span><span style="color:#D73A49"> throw</span><span style="color:#6F42C1"> IllegalArgumentException</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Unsupported type: </span><span style="color:#005CC5">$type</span><span style="color:#032F62">&quot;</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>내용이 장황하지만 하나씩 살펴보면 어렵지 않다. <code>evaluateLeaf</code> 메서드는 다음과 같은 순서로 진행된다.</p>
<ol>
<li><code>AttributeResolver</code>를 통해 평가할 속성 값을 조회한다. 만약 속성이 없다면 조건을 만족하지 않는 것으로 간주한다.</li>
<li>조건 값을 <code>String</code> 타입으로 사용하므로 <code>convertValue</code> 메서드를 통해 변환한다. 변환할 수 없다면 조건을 만족하지 않는 것으로 간주한다.</li>
<li>변환된 조건 값과 실제 속성 값을 비교하여 평가한다.</li>
</ol>
<p>여기까지 구현했다면 조건 트리를 평가할 수 있는 기본적인 구조는 완성됐다. 하지만 아직 부족한 점이 있다. 바로 조건 트리를 데이터베이스에 저장하고 불러오는 기능이다.</p>
<h2 id="엔티티-모델-구현"><a href="#엔티티-모델-구현">엔티티 모델 구현</a></h2>
<p>조건 트리를 RDB 데이터베이스에 저장하기 위해서는 엔티티 모델을 구현해야 한다. 앞서 설계한 도식에 따라 <code>ConditionNodeEntity</code>를 구현해보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#6F42C1">@Table</span><span style="color:#24292E">(name </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;condition_nodes&quot;</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#D73A49">data</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ConditionNodeEntity</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#6F42C1">  @Id</span></span>
<span class="line"><span style="color:#6F42C1">  @GeneratedValue</span><span style="color:#24292E">(strategy </span><span style="color:#D73A49">=</span><span style="color:#24292E"> GenerationType.IDENTITY)</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> id: </span><span style="color:#6F42C1">Long</span><span style="color:#24292E">? </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> targetId: </span><span style="color:#6F42C1">Long</span><span style="color:#24292E">? </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">, </span><span style="color:#6A737D">// 조건이 적용되는 대상 ID</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> parentId: </span><span style="color:#6F42C1">Long</span><span style="color:#24292E">? </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> type: </span><span style="color:#6F42C1">NodeType</span><span style="color:#24292E">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // LEAF</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> attribute: </span><span style="color:#6F42C1">String</span><span style="color:#24292E">? </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#D73A49"> operator</span><span style="color:#24292E">: </span><span style="color:#6F42C1">LeafCondition</span><span style="color:#24292E">.ConditionOperator? </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#D73A49"> value</span><span style="color:#24292E">: </span><span style="color:#6F42C1">String</span><span style="color:#24292E">? </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> valueType: </span><span style="color:#6F42C1">String</span><span style="color:#24292E">? </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // COMPOSITE</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> logic: </span><span style="color:#6F42C1">CompositeCondition</span><span style="color:#24292E">.LogicalOperator? </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span></span>
<span class="line"><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  enum</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> NodeType</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    LEAF,</span></span>
<span class="line"><span style="color:#24292E">    COMPOSITE</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>모델 자체가 간단하므로 쉽게 구현할 수 있다. 이제 이어서 데이터베이스에 저장된 조건 트리를 불러와 실제 조건 트리로 변환하는 로직을 구현해보자.</p>
<h2 id="tree-loader-구현"><a href="#tree-loader-구현">Tree Loader 구현</a></h2>
<p>조건 트리를 데이터베이스에서 불러와 트리를 구성하기 위해 <code>ConditionTreeLoader</code>를 구현해보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> ConditionTreeLoader</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#D73A49">  private</span><span style="color:#D73A49"> val</span><span style="color:#24292E"> conditionNodeRepository: </span><span style="color:#6F42C1">ConditionNodeRepository</span></span>
<span class="line"><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  fun</span><span style="color:#6F42C1"> load</span><span style="color:#24292E">(targetId: </span><span style="color:#6F42C1">Long</span><span style="color:#24292E">): </span><span style="color:#6F42C1">ConditionalNode</span><span style="color:#24292E">? {</span></span>
<span class="line"><span style="color:#6A737D">    // 1. 대상에 걸린 모든 조건 노드를 조회</span></span>
<span class="line"><span style="color:#D73A49">    val</span><span style="color:#24292E"> allNodes </span><span style="color:#D73A49">=</span><span style="color:#24292E"> conditionNodeRepository.</span><span style="color:#6F42C1">findByTargetId</span><span style="color:#24292E">(targetId)</span></span>
<span class="line"><span style="color:#D73A49">    val</span><span style="color:#24292E"> nodeMap </span><span style="color:#D73A49">=</span><span style="color:#24292E"> allNodes.</span><span style="color:#6F42C1">associateBy</span><span style="color:#24292E"> { it.id }</span></span>
<span class="line"><span style="color:#6A737D">    // 2. 부모 노드가 없는 조건 노드를 찾는다.</span></span>
<span class="line"><span style="color:#D73A49">    val</span><span style="color:#24292E"> root </span><span style="color:#D73A49">=</span><span style="color:#24292E"> allNodes.</span><span style="color:#6F42C1">firstOrNull</span><span style="color:#24292E"> { it.parentId </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#24292E"> } ?: </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> null</span></span>
<span class="line"><span style="color:#6A737D">    // 3. 조건 트리를 구성하여 반환</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#6F42C1"> buildTree</span><span style="color:#24292E">(root, nodeMap)</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // 재귀적으로 트리를 구성하는 메서드</span></span>
<span class="line"><span style="color:#D73A49">  private</span><span style="color:#D73A49"> fun</span><span style="color:#6F42C1"> buildTree</span><span style="color:#24292E">(root: </span><span style="color:#6F42C1">ConditionNodeEntity</span><span style="color:#24292E">, nodeMap: </span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Long</span><span style="color:#24292E">, </span><span style="color:#6F42C1">ConditionNodeEntity</span><span style="color:#24292E">&gt;): </span><span style="color:#6F42C1">ConditionalNode</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#D73A49"> when</span><span style="color:#24292E"> (root.type) {</span></span>
<span class="line"><span style="color:#24292E">      ConditionNodeEntity.NodeType.LEAF </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">        LeafCondition</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">          id </span><span style="color:#D73A49">=</span><span style="color:#24292E"> root.id,</span></span>
<span class="line"><span style="color:#24292E">          attribute </span><span style="color:#D73A49">=</span><span style="color:#24292E"> root.attribute</span><span style="color:#D73A49">!!</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">          operator</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> root.</span><span style="color:#D73A49">operator!!</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">          value</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> root.</span><span style="color:#D73A49">value!!</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">          valueType </span><span style="color:#D73A49">=</span><span style="color:#24292E"> root.valueType</span><span style="color:#D73A49">!!</span><span style="color:#24292E">.</span><span style="color:#6F42C1">let</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">            when</span><span style="color:#24292E"> (it) {</span></span>
<span class="line"><span style="color:#032F62">              &quot;Long&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#24292E"> Long::</span><span style="color:#6F42C1">class</span></span>
<span class="line"><span style="color:#032F62">              &quot;Int&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#24292E"> Int::</span><span style="color:#6F42C1">class</span></span>
<span class="line"><span style="color:#032F62">              &quot;Boolean&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#24292E"> Boolean::</span><span style="color:#6F42C1">class</span></span>
<span class="line"><span style="color:#032F62">              &quot;Double&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#24292E"> Double::</span><span style="color:#6F42C1">class</span></span>
<span class="line"><span style="color:#032F62">              &quot;String&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#24292E"> String::</span><span style="color:#6F42C1">class</span></span>
<span class="line"><span style="color:#D73A49">              else</span><span style="color:#D73A49"> -&gt;</span><span style="color:#D73A49"> throw</span><span style="color:#6F42C1"> IllegalArgumentException</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Unsupported type: </span><span style="color:#005CC5">$it</span><span style="color:#032F62">&quot;</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">          }</span></span>
<span class="line"><span style="color:#24292E">        )</span></span>
<span class="line"><span style="color:#24292E">      }</span></span>
<span class="line"><span style="color:#24292E">      ConditionNodeEntity.NodeType.COMPOSITE </span><span style="color:#D73A49">-&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        val</span><span style="color:#24292E"> children </span><span style="color:#D73A49">=</span><span style="color:#24292E"> nodeMap.values.</span><span style="color:#6F42C1">filter</span><span style="color:#24292E"> { it.parentId </span><span style="color:#D73A49">==</span><span style="color:#24292E"> root.id }</span></span>
<span class="line"><span style="color:#6F42C1">        CompositeCondition</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">          id </span><span style="color:#D73A49">=</span><span style="color:#24292E"> root.id,</span></span>
<span class="line"><span style="color:#24292E">          logic </span><span style="color:#D73A49">=</span><span style="color:#24292E"> root.logic</span><span style="color:#D73A49">!!</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#6A737D">          // 재귀적으로 자식 노드를 구성</span></span>
<span class="line"><span style="color:#24292E">          children </span><span style="color:#D73A49">=</span><span style="color:#24292E"> children.</span><span style="color:#6F42C1">map</span><span style="color:#24292E"> { </span><span style="color:#6F42C1">buildTree</span><span style="color:#24292E">(it, nodeMap) }</span></span>
<span class="line"><span style="color:#24292E">        )</span></span>
<span class="line"><span style="color:#24292E">      }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>먼저 루트 노드를 찾고, 그 노드의 자식 노드를 재귀적으로 구성하여 트리를 만든다. 이때, 성능 최적화를 위해 <code>nodeMap</code>을 구성하면 부모 노드에 대한 자식 노드를 쉽게 찾을 수 있다.</p>
<h2 id="사용-예시"><a href="#사용-예시">사용 예시</a></h2>
<p>이제 실제로 데이터베이스에서 조건 트리를 불러와 평가하는 예시를 살펴보자. 다음은 데이터베이스 없이 조건 트리를 평가하는 예시다.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#D73A49">fun</span><span style="color:#6F42C1"> main</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#6A737D">  // 1. 먼저 조건 트리를 구성한다.</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> condition </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> CompositeCondition</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">    id </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">    logic </span><span style="color:#D73A49">=</span><span style="color:#24292E"> CompositeCondition.LogicalOperator.AND,</span></span>
<span class="line"><span style="color:#24292E">    children </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> listOf</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#6F42C1">      LeafCondition</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">        id </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">        attribute </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;age&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">        operator</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> LeafCondition.ConditionOperator.GTE,</span></span>
<span class="line"><span style="color:#D73A49">        value</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;18&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">        valueType </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Long::</span><span style="color:#6F42C1">class</span></span>
<span class="line"><span style="color:#24292E">      ),</span></span>
<span class="line"><span style="color:#6F42C1">      LeafCondition</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">        id </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">        attribute </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;purchaseCount&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">        operator</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> LeafCondition.ConditionOperator.GT,</span></span>
<span class="line"><span style="color:#D73A49">        value</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;5&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">        valueType </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Long::</span><span style="color:#6F42C1">class</span></span>
<span class="line"><span style="color:#24292E">      )</span></span>
<span class="line"><span style="color:#24292E">    )</span></span>
<span class="line"><span style="color:#24292E">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // 2. 평가할 속성 값을 제공하는 AttributeResolver를 생성한다.</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> resolver </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> AttributeResolver</span><span style="color:#24292E"> { attr </span><span style="color:#D73A49">-&gt;</span></span>
<span class="line"><span style="color:#D73A49">    when</span><span style="color:#24292E"> (attr) {</span></span>
<span class="line"><span style="color:#032F62">      &quot;age&quot;</span><span style="color:#D73A49">           -&gt;</span><span style="color:#005CC5"> 20</span></span>
<span class="line"><span style="color:#032F62">      &quot;purchaseCount&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#005CC5"> 10</span></span>
<span class="line"><span style="color:#032F62">      &quot;level&quot;</span><span style="color:#D73A49">         -&gt;</span><span style="color:#032F62"> &quot;VIP&quot;</span></span>
<span class="line"><span style="color:#D73A49">      else</span><span style="color:#D73A49">            -&gt;</span><span style="color:#005CC5"> null</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // 3. 조건 트리를 평가한다.</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> evaluator </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> ConditionEvaluator</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#D73A49">  val</span><span style="color:#24292E"> result </span><span style="color:#D73A49">=</span><span style="color:#24292E"> evaluator.</span><span style="color:#6F42C1">evaluate</span><span style="color:#24292E">(condition, resolver)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // 4. 평가 결과를 출력한다.</span></span>
<span class="line"><span style="color:#6F42C1">  println</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Evaluation Result: </span><span style="color:#005CC5">$result</span><span style="color:#032F62">&quot;</span><span style="color:#24292E">) </span><span style="color:#6A737D">// true</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>다음으로 데이터베이스를 사용하여 조건 트리를 평가하는 예시를 살펴보자. 만약 Spring을 사용한다면 <code>ConditionTreeLoader</code>와 <code>ConditionEvaluator</code>를 Bean으로 등록하여 DI를 통해 사용할 수 있다. 다음 코드는 Spring을 사용한 예시다.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#6F42C1">@Service</span></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> CouponConditionService</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#D73A49">  private</span><span style="color:#D73A49"> val</span><span style="color:#24292E"> conditionTreeLoader: </span><span style="color:#6F42C1">ConditionTreeLoader</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#D73A49">  private</span><span style="color:#D73A49"> val</span><span style="color:#24292E"> conditionEvaluator: </span><span style="color:#6F42C1">ConditionEvaluator</span></span>
<span class="line"><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  fun</span><span style="color:#6F42C1"> canExpose</span><span style="color:#24292E">(targetId: </span><span style="color:#6F42C1">Long</span><span style="color:#24292E">): </span><span style="color:#6F42C1">Boolean</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">    // 1. 조건 트리 로더를 통해 조건 트리를 불러온다.</span></span>
<span class="line"><span style="color:#D73A49">    val</span><span style="color:#24292E"> conditionTree </span><span style="color:#D73A49">=</span><span style="color:#24292E"> conditionTreeLoader.</span><span style="color:#6F42C1">load</span><span style="color:#24292E">(targetId)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 2. 평가할 속성 값을 제공하는 AttributeResolver 구현</span></span>
<span class="line"><span style="color:#D73A49">    val</span><span style="color:#24292E"> attributeResolver </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> AttributeResolver</span><span style="color:#24292E"> { attribute </span><span style="color:#D73A49">-&gt;</span></span>
<span class="line"><span style="color:#D73A49">      when</span><span style="color:#24292E"> (attribute) {</span></span>
<span class="line"><span style="color:#032F62">        &quot;age&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#005CC5"> 20</span></span>
<span class="line"><span style="color:#032F62">        &quot;purchaseCount&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#005CC5"> 3</span></span>
<span class="line"><span style="color:#032F62">        &quot;level&quot;</span><span style="color:#D73A49"> -&gt;</span><span style="color:#032F62"> &quot;SILVER&quot;</span></span>
<span class="line"><span style="color:#D73A49">        else</span><span style="color:#D73A49"> -&gt;</span><span style="color:#005CC5"> null</span></span>
<span class="line"><span style="color:#24292E">      }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 2. 조건 트리를 평가한다.</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> conditionEvaluator.</span><span style="color:#6F42C1">evaluate</span><span style="color:#24292E">(conditionTree, attributeResolver)</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h1 id="rule-engine과-차이점"><a href="#rule-engine과-차이점">Rule Engine과 차이점</a></h1>
<p>조건 트리는 얼핏 보면 Rule Engine과 유사해 보일 수 있다. 둘 다 어떤 조건을 평가하고, 그 결과를 바탕으로 후속 동작을 수행한다. 하지만 실제로는 구조도, 역할도, 활용 범위도 전혀 다르다.</p>
<p>조건 트리는 하나의 조건 트리만을 평가한다. 즉, 하나의 조건 트리는 하나의 Boolean 결과값(true 또는 false)을 반환한다. 반면, Rule Engine은 수십 개에서 수천 개의 규칙을 동시에 평가한다. Rule Engine은 여러 개의 규칙이 동시에 만족될 수 있기 때문에, 어떤 규칙을 우선 실행할지 결정하기 위한 우선순위, 충돌 해소 전략 등의 개념이 필요하다.</p>
<p>그리고 조건 트리는 단순히 조건을 평가하는 데 중점을 두지만, Rule Engine IF 조건이 만족되면 THEN에 해당하는 액션을 실행한다는 형식을 따르며, Rule Engine은 이 조건들을 모두 탐색하고 실행 순서를 조율한다.</p>
<p>정리하자면 조건 트리는 주로 다음과 같은 상황에서 사용된다.</p>
<ul>
<li>단일 조건식으로 판단해야 할 때</li>
<li>복잡한 조건을 관리자 화면에서 간단히 조정하고 싶을 때</li>
<li>특정 시점에만 평가되며, 즉시 결과를 얻고 싶을 때</li>
</ul>
<p>반면, Rule Engine은 다음과 같은 상황에서 유용하다.</p>
<ul>
<li>수백 개 이상의 규칙을 동시에 평가해야 할 때</li>
<li>규칙 간의 의존성이나 추론(Chaining)이 필요한 경우</li>
<li>IF-THEN 구조로 규칙에 기반한 복잡한 비즈니스 로직을 구현해야 할 때</li>
</ul>
<h1 id="마치며"><a href="#마치며">마치며</a></h1>
<p>이번 글에서는 조건이라는 요구사항을 추상화하는 방법과 조건 트리 모델을 설계하는 방법에 대해 설명했다. 조건 트리는 복잡한 조건을 평가하기 위한 강력한 도구로, 다양한 분야에서 활용될 수 있다.</p>
<p>또한 조건 트리는 관리자가 직접 조건을 편집할 수 있는 유연성을 제공한다. 또한, 런타임 도중에 조건을 변경할 수 있어 다양한 상황에 대응할 수 있다.</p>
<p>이처럼 잘 설계된 모델은 제품을 좀 더 유연하고 확장 가능하게 만들어준다.</p>
<section data-footnotes class="footnotes"><h2 class="sr-only" id="footnote-label"><a href="#footnote-label">Footnotes</a></h2>
<ol>
<li id="user-content-fn-1">
<p>임피던스 불일치라고도 하며, 객체 지향 프로그래밍 언어와 관계형 데이터베이스 간의 불일치를 의미한다. 객체 지향 프로그래밍 언어는 객체를 중심으로 설계되지만, 관계형 데이터베이스는 테이블을 중심으로 설계된다. 이로 인해 두 시스템 간의 데이터 표현 방식이 다르기 때문에 발생하는 문제를 의미한다. <a href="#user-content-fnref-1" data-footnote-backref aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>만약 MongoDB와 같은 Document 기반 DB를 사용한다면 별도로 엔티티 모델을 만들 필요 없이 그대로 사용할 수 있다. <a href="#user-content-fnref-2" data-footnote-backref aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>  </div> <div> <div class="mt-1 w-full"> <div class="mr-1 mb-1 inline-flex items-center rounded-[50px] border border-[#dfe3e8] px-2 text-[10px] text-[#888]" style="height: 20px;"> modeling </div> </div> <div class="flex items-center py-6" data-astro-cid-k7qsseos> <div class="shrink-0 basis-[80px]" data-astro-cid-k7qsseos> <img class="h-[80px] w-[80px] object-cover" style="border-radius: 50%;" src="/images/about/avatar.jpg" data-astro-cid-k7qsseos> </div> <div class="ml-8 flex-1 text-base" data-astro-cid-k7qsseos> <div data-astro-cid-k7qsseos>
Written by <a href="/about/" class="name-gradient font-bold no-underline" data-astro-cid-k7qsseos>
@kciter
</a> </div> <div class="text-sm font-light leading-snug" data-astro-cid-k7qsseos>가치있는 지식이 되기를 바랍니다</div> <div class="-ml-1 [&_a]:text-sm [&_a]:text-[#888]" data-astro-cid-k7qsseos> <a href="https://github.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="GitHub" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.2 11.38.6.12.83-.26.83-.57v-2.2c-3.34.73-4.04-1.44-4.04-1.44-.55-1.38-1.33-1.75-1.33-1.75-1.09-.74.08-.73.08-.73 1.2.09 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.49 1 .1-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6.02 0c2.28-1.55 3.28-1.23 3.28-1.23.66 1.66.25 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .31.22.7.83.57C20.57 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z"/></svg></a><a href="https://www.facebook.com/sunhyoup.lee" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="Facebook" style="--hover-color: #3d5b99; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M24 12.07C24 5.41 18.63 0 12 0S0 5.41 0 12.07c0 6.02 4.39 11.02 10.13 11.93v-8.44H7.08v-3.49h3.04V9.41c0-3.02 1.79-4.68 4.53-4.68 1.31 0 2.68.24 2.68.24v2.97h-1.51c-1.49 0-1.95.93-1.95 1.88v2.26h3.33l-.53 3.49h-2.8v8.44C19.61 23.09 24 18.09 24 12.07z"/></svg></a><a href="https://www.linkedin.com/in/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="LinkedIn" style="--hover-color: #0073a4; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M20.45 20.45h-3.55v-5.57c0-1.33-.02-3.04-1.85-3.04-1.85 0-2.14 1.45-2.14 2.94v5.67H9.36V9h3.41v1.56h.05c.48-.9 1.64-1.85 3.37-1.85 3.6 0 4.27 2.37 4.27 5.46v6.28zM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12zM7.12 20.45H3.56V9h3.56v11.45zM22.22 0H1.77C.79 0 0 .77 0 1.72v20.56C0 23.23.79 24 1.77 24h20.45C23.2 24 24 23.23 24 22.28V1.72C24 .77 23.2 0 22.22 0z"/></svg></a><a href="https://twitter.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="X (Twitter)" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href="/feed.xml" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="RSS Feed" style="--hover-color: #ff6600; transition: color .5s;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M6.18 15.64a2.18 2.18 0 1 1 0 4.36 2.18 2.18 0 0 1 0-4.36zM4 4.44v3.57A12.01 12.01 0 0 1 15.99 20h3.57A15.57 15.57 0 0 0 4 4.44zM4 10.1v3.57c3.5 0 6.33 2.84 6.33 6.33h3.57c0-5.47-4.43-9.9-9.9-9.9z"/></svg></a> </div> </div> </div>   <div id="comments"> <script>(()=>{var a=(s,i,o)=>{let r=async()=>{await(await s())()},t=typeof i.value=="object"?i.value:void 0,c={rootMargin:t==null?void 0:t.rootMargin},n=new IntersectionObserver(e=>{for(let l of e)if(l.isIntersecting){n.disconnect(),r();break}},c);for(let e of o.children)n.observe(e)};(self.Astro||(self.Astro={})).visible=a;window.dispatchEvent(new Event("astro:visible"));})();</script><astro-island uid="Z1MhqMT" prefix="r5" component-url="/_astro/Giscus.BCCeZi7E.js" component-export="default" renderer-url="/_astro/client.C9fCgUO1.js" props="{&quot;repo&quot;:[0,&quot;kciter/kciter.github.io&quot;],&quot;theme&quot;:[0,&quot;light&quot;]}" ssr client="visible" opts="{&quot;name&quot;:&quot;Giscus&quot;,&quot;value&quot;:true}" await-children><div></div><!--astro:end--></astro-island> </div> </div> <div class="pt-8 pb-8" data-astro-cid-llggujpl> <div class="grid grid-cols-3 gap-5 max-[30rem]:grid-cols-1" data-astro-cid-llggujpl> <a href="/posts/mcp-from-ux-perspective/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2025-04-10-mcp-from-ux-perspective/thumbnail.jpg" alt="UX 관점에서 바라보는 MCP" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>UX 관점에서 바라보는 MCP</div> <small data-astro-cid-llggujpl>2025-04-10</small> </a><a href="/posts/using-kotlin-script/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2025-01-19-using-kotlin-script/thumbnail.png" alt="Kotlin Script 활용하기" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>Kotlin Script 활용하기</div> <small data-astro-cid-llggujpl>2025-01-19</small> </a><a href="/posts/railway-oriented-programming/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2023-07-17-railway-oriented-programming/thumbnail.png" alt="Railway-Oriented Programming" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>Railway-Oriented Programming</div> <small data-astro-cid-llggujpl>2023-07-17</small> </a><a href="/posts/principles-of-debugging/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2024-03-16-principles-of-debugging/thumbnail.png" alt="디버깅 원칙" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>디버깅 원칙</div> <small data-astro-cid-llggujpl>2024-03-16</small> </a><a href="/posts/modeling-series-foreword/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2025-04-16-modeling-series-foreword/thumbnail.png" alt="모델링 시리즈: 서문" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>모델링 시리즈: 서문</div> <small data-astro-cid-llggujpl>2025-04-16</small> </a><a href="/posts/the-shortcut/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2024-05-10-the-shortcut/thumbnail.png" alt="기계의 반칙" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>기계의 반칙</div> <small data-astro-cid-llggujpl>2024-05-10</small> </a> </div> </div>  </div> <footer class="m-8 text-center text-[#999]"> <div> <a href="https://github.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="GitHub" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.2 11.38.6.12.83-.26.83-.57v-2.2c-3.34.73-4.04-1.44-4.04-1.44-.55-1.38-1.33-1.75-1.33-1.75-1.09-.74.08-.73.08-.73 1.2.09 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.49 1 .1-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6.02 0c2.28-1.55 3.28-1.23 3.28-1.23.66 1.66.25 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .31.22.7.83.57C20.57 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z"/></svg></a><a href="https://www.facebook.com/sunhyoup.lee" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="Facebook" style="--hover-color: #3d5b99; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M24 12.07C24 5.41 18.63 0 12 0S0 5.41 0 12.07c0 6.02 4.39 11.02 10.13 11.93v-8.44H7.08v-3.49h3.04V9.41c0-3.02 1.79-4.68 4.53-4.68 1.31 0 2.68.24 2.68.24v2.97h-1.51c-1.49 0-1.95.93-1.95 1.88v2.26h3.33l-.53 3.49h-2.8v8.44C19.61 23.09 24 18.09 24 12.07z"/></svg></a><a href="https://www.linkedin.com/in/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="LinkedIn" style="--hover-color: #0073a4; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M20.45 20.45h-3.55v-5.57c0-1.33-.02-3.04-1.85-3.04-1.85 0-2.14 1.45-2.14 2.94v5.67H9.36V9h3.41v1.56h.05c.48-.9 1.64-1.85 3.37-1.85 3.6 0 4.27 2.37 4.27 5.46v6.28zM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12zM7.12 20.45H3.56V9h3.56v11.45zM22.22 0H1.77C.79 0 0 .77 0 1.72v20.56C0 23.23.79 24 1.77 24h20.45C23.2 24 24 23.23 24 22.28V1.72C24 .77 23.2 0 22.22 0z"/></svg></a><a href="https://twitter.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="X (Twitter)" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href="/feed.xml" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="RSS Feed" style="--hover-color: #ff6600; transition: color .5s;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M6.18 15.64a2.18 2.18 0 1 1 0 4.36 2.18 2.18 0 0 1 0-4.36zM4 4.44v3.57A12.01 12.01 0 0 1 15.99 20h3.57A15.57 15.57 0 0 0 4 4.44zM4 10.1v3.57c3.5 0 6.33 2.84 6.33 6.33h3.57c0-5.47-4.43-9.9-9.9-9.9z"/></svg></a> </div> <div class="mt-4 mb-4 font-['Quattrocento_Sans',sans-serif] text-[0.8rem] text-[#9a9a9a]"> <a href="/about/" class="p-2.5 text-[#999] hover:text-[#333]" style="text-decoration: none;">
kciter.so | devlog by Sunhyoup Lee
</a> </div> </footer> </div> </body></html> <script type="module">document.querySelectorAll(".post-container a[data-footnote-ref]").forEach(o=>{const e=o.getAttribute("href")?.slice(1);if(!e)return;const r=document.getElementById(e);if(!r)return;const t=r.textContent?.replace("↩","").trim()||"";o.setAttribute("data-tooltip",t)});document.querySelectorAll(".code-tabs").forEach(o=>{const e=Array.from(o.querySelectorAll(":scope > pre"));if(e.length<2)return;const r=o.getAttribute("data-labels")?.split(",").map(a=>a.trim()),t=document.createElement("div");t.className="code-tabs-bar",e.forEach((a,s)=>{const n=r?.[s]||a.getAttribute("data-language")||"code",c=document.createElement("button");c.textContent=n,r?.[s]&&c.classList.add("has-filename"),s===0&&c.classList.add("active"),c.addEventListener("click",()=>{t.querySelectorAll("button").forEach(l=>l.classList.remove("active")),e.forEach(l=>l.classList.remove("active")),c.classList.add("active"),e[s].classList.add("active")}),t.appendChild(c)}),e[0].classList.add("active"),o.prepend(t)});const i=document.querySelectorAll(".toc .toc-list a");if(i.length>0){const e=Array.from(i).map(t=>t.getAttribute("href")?.slice(1)).filter(Boolean).map(t=>document.getElementById(t)).filter(Boolean),r=new IntersectionObserver(t=>{for(const a of t)if(a.isIntersecting){const s=a.target.id;i.forEach(n=>{n.classList.toggle("active",n.getAttribute("href")===`#${s}`)})}},{rootMargin:"0px 0px -70% 0px",threshold:0});e.forEach(t=>r.observe(t))}</script>