import{j as Z}from"./jsx-runtime.s5l94Kta.js";import{r as A,R as P}from"./index.Dkaqzkgy.js";const S=60,I=22;let d=0,M=0,x=0,f=20,Y=new Array(S*I).fill(0),j=new Array(S*I).fill(" ");const H=100,V=40;let X,q,C,b,D,O,F;function J(n,t,i){return t*Math.sin(d)*Math.sin(M)*Math.cos(x)-i*Math.cos(d)*Math.sin(M)*Math.cos(x)+t*Math.cos(d)*Math.sin(x)+i*Math.sin(d)*Math.sin(x)+n*Math.cos(M)*Math.cos(x)}function L(n,t,i){return t*Math.cos(d)*Math.cos(x)+i*Math.sin(d)*Math.cos(x)-t*Math.sin(d)*Math.sin(M)*Math.sin(x)+i*Math.cos(d)*Math.sin(M)*Math.sin(x)-n*Math.cos(M)*Math.sin(x)}function $(n,t,i){return i*Math.cos(d)*Math.cos(M)-t*Math.sin(d)*Math.cos(M)+n*Math.sin(M)}function B(n,t,i,s){X=J(n,t,i),q=L(n,t,i),C=$(n,t,i)+H,b=1/C,D=Math.floor(S/2+V*b*X*2),O=Math.floor(I/2+V*b*q),F=D+O*S,F>=0&&F<S*I&&b>Y[F]&&(Y[F]=b,j[F]=s)}const it=()=>{const n=A.useRef(null),[t,i]=P.useState("");return P.useEffect(()=>{let s=24,h=Date.now(),e;function m(){const o=Date.now(),w=o-h;if(w>s){h=o-w%s,j.fill("."),Y.fill(0),f=12;for(let l=-f;l<f;l+=.6)for(let u=-f;u<f;u+=.6)B(l,u,-f,"@"),B(f,u,l,"$"),B(-f,u,-l,"%"),B(-l,u,f,"#"),B(l,-f,-u,";"),B(l,f,u,"+");i(j.join("").replace(/.{60}/g,"$&<br />").replace(/\./g,"&nbsp;")),d+=.05,M+=.05,x+=.01}e=requestAnimationFrame(m)}return m(),()=>{cancelAnimationFrame(e)}},[]),Z.jsx("div",{ref:n,style:{fontFamily:"monospace",fontSize:(n.current?.clientWidth||0)/700*14,lineHeight:(n.current?.clientWidth||0)<500?1.8:1.4,textAlign:"center"},dangerouslySetInnerHTML:{__html:t}})};var k=Object.defineProperty,K=(n,t,i)=>t in n?k(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,r=(n,t,i)=>(K(n,typeof t!="symbol"?t+"":t,i),i);class g{constructor(t,i){r(this,"x"),r(this,"y"),this.x=t,this.y=i}add(t){return new g(this.x+t.x,this.y+t.y)}subtract(t){return new g(this.x-t.x,this.y-t.y)}multiply(t){return new g(this.x*t,this.y*t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();return new g(this.x/t,this.y/t)}}class a{constructor(t,i,s){r(this,"x"),r(this,"y"),r(this,"z"),this.x=t,this.y=i,this.z=s}static zero(){return new a(0,0,0)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return new a(this.x*t,this.y*t,this.z*t)}rotateX(t){return new a(this.x,this.y*Math.cos(t)-this.z*Math.sin(t),this.y*Math.sin(t)+this.z*Math.cos(t))}rotateY(t){return new a(this.x*Math.cos(t)+this.z*-Math.sin(t),this.y,this.x*Math.sin(t)+this.z*Math.cos(t))}rotateZ(t){return new a(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t),this.z)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}cross(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}normalize(){const t=this.length();return new a(this.x/t,this.y/t,this.z/t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}}class y{constructor(t,i,s,h){r(this,"x"),r(this,"y"),r(this,"z"),r(this,"w"),this.x=t,this.y=i,this.z=s,this.w=h}add(t){return new y(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}subtract(t){return new y(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}multiply(t){return new y(this.x*t,this.y*t,this.z*t,this.w*t)}transform(t){const i=this.x,s=this.y,h=this.z,e=this.w;return new y(t.m00*i+t.m10*s+t.m20*h+t.m30*e,t.m01*i+t.m11*s+t.m21*h+t.m31*e,t.m02*i+t.m12*s+t.m22*h+t.m32*e,t.m03*i+t.m13*s+t.m23*h+t.m33*e)}}class c{constructor(t,i,s,h,e,m,o,w,l,u,v,E,T,p,z,R){r(this,"m00"),r(this,"m01"),r(this,"m02"),r(this,"m03"),r(this,"m10"),r(this,"m11"),r(this,"m12"),r(this,"m13"),r(this,"m20"),r(this,"m21"),r(this,"m22"),r(this,"m23"),r(this,"m30"),r(this,"m31"),r(this,"m32"),r(this,"m33"),this.m00=t,this.m01=i,this.m02=s,this.m03=h,this.m10=e,this.m11=m,this.m12=o,this.m13=w,this.m20=l,this.m21=u,this.m22=v,this.m23=E,this.m30=T,this.m31=p,this.m32=z,this.m33=R}static zero(){return new c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}static identity(){return new c(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}add(t){return new c(this.m00+t.m00,this.m01+t.m01,this.m02+t.m02,this.m03+t.m03,this.m10+t.m10,this.m11+t.m11,this.m12+t.m12,this.m13+t.m13,this.m20+t.m20,this.m21+t.m21,this.m22+t.m22,this.m23+t.m23,this.m30+t.m30,this.m31+t.m31,this.m32+t.m32,this.m33+t.m33)}subtract(t){return new c(this.m00-t.m00,this.m01-t.m01,this.m02-t.m02,this.m03-t.m03,this.m10-t.m10,this.m11-t.m11,this.m12-t.m12,this.m13-t.m13,this.m20-t.m20,this.m21-t.m21,this.m22-t.m22,this.m23-t.m23,this.m30-t.m30,this.m31-t.m31,this.m32-t.m32,this.m33-t.m33)}multiply(t){return new c(this.m00*t.m00+this.m01*t.m10+this.m02*t.m20+this.m03*t.m30,this.m00*t.m01+this.m01*t.m11+this.m02*t.m21+this.m03*t.m31,this.m00*t.m02+this.m01*t.m12+this.m02*t.m22+this.m03*t.m32,this.m00*t.m03+this.m01*t.m13+this.m02*t.m23+this.m03*t.m33,this.m10*t.m00+this.m11*t.m10+this.m12*t.m20+this.m13*t.m30,this.m10*t.m01+this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,this.m10*t.m02+this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,this.m10*t.m03+this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,this.m20*t.m00+this.m21*t.m10+this.m22*t.m20+this.m23*t.m30,this.m20*t.m01+this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,this.m20*t.m02+this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,this.m20*t.m03+this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,this.m30*t.m00+this.m31*t.m10+this.m32*t.m20+this.m33*t.m30,this.m30*t.m01+this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,this.m30*t.m02+this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,this.m30*t.m03+this.m31*t.m13+this.m32*t.m23+this.m33*t.m33)}static scale(t){return new c(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1)}static translate(t){return new c(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1)}static rotateX(t){const i=Math.cos(t),s=Math.sin(t);return new c(1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1)}static rotateY(t){const i=Math.cos(t),s=Math.sin(t);return new c(i,0,-s,0,0,1,0,0,s,0,i,0,0,0,0,1)}static rotateZ(t){const i=Math.cos(t),s=Math.sin(t);return new c(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1)}setIdentity(){this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m10=0,this.m11=1,this.m12=0,this.m13=0,this.m20=0,this.m21=0,this.m22=1,this.m23=0,this.m30=0,this.m31=0,this.m32=0,this.m33=1}}class G{constructor(t){r(this,"vertices"),this.vertices=t}}class N{constructor(){r(this,"eye"),r(this,"look"),r(this,"up"),r(this,"rotation"),r(this,"viewMatrix"),this.eye=new a(0,0,0),this.look=new a(0,0,1),this.up=new a(0,1,0),this.rotation=new a(0,0,0),this.viewMatrix=c.identity()}transform(t){return t.transform(this.viewMatrix)}calculateViewMatrix(){const t=this.look.rotateX(this.rotation.x).rotateY(this.rotation.y).rotateZ(this.rotation.z).add(this.eye).subtract(this.eye).normalize(),i=t.multiply(this.up.dot(t)),s=this.up.subtract(i).normalize(),h=s.cross(t);this.viewMatrix=new c(h.x,h.y,h.z,0,s.x,s.y,s.z,0,t.x,t.y,t.z,0,this.eye.x,this.eye.y,this.eye.z,1)}calculatePerspectiveMatrix(t,i,s,h){const e=c.identity(),m=Math.tan(t/2*(3.141592/180));return e.m00=1/m/i,e.m11=1/m,e.m22=-2*s/(h-s)-1,e.m23=-1,e.m32=-(h*-s)/(h-s),e}}class W{static loadFromFile(t){return new Promise((i,s)=>{const h=new FileReader;h.onload=e=>{var m;const o=(m=e.target)==null?void 0:m.result;o?i(this.parseOBJ(o)):s(new Error("Failed to load file"))},h.readAsText(t)})}static loadFromString(t){return this.parseOBJ(t)}static parseOBJ(t){const i=t.split(`
`),s=[],h=[];for(const e of i){const m=e.trim().split(" ").filter(o=>o!=="");m[0]==="v"?s.push(new a(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]))):m[0]==="f"&&h.push(new G([s[parseInt(m[1])-1],s[parseInt(m[2])-1],s[parseInt(m[3])-1]]))}return h}}class Q{constructor(){r(this,"position"),r(this,"rotate"),r(this,"scale"),this.position=new a(0,0,0),this.rotate=new a(0,0,0),this.scale=new a(1,1,1)}transform(t){const i=c.identity().multiply(c.rotateX(this.rotate.x)).multiply(c.rotateY(this.rotate.y)).multiply(c.rotateZ(this.rotate.z)).multiply(c.scale(this.scale)).multiply(c.translate(this.position));return t.transform(i)}setTranslate(t){this.position=t}setScale(t){this.scale=t}setRotateX(t){this.rotate.x=t}setRotateY(t){this.rotate.y=t}setRotateZ(t){this.rotate.z=t}}class U{constructor(t,i,s){r(this,"el"),r(this,"width"),r(this,"height"),r(this,"frameBuffer"),r(this,"depthBuffer"),r(this,"mesh",[]),r(this,"camera"),r(this,"world"),r(this,"angle"),r(this,"Shade","·┼╬░▒▓█"),this.el=t,this.width=i,this.height=s,this.frameBuffer=new Array(s+1).fill(null).map(()=>new Array(i+1).fill(" ")),this.depthBuffer=new Array(s+1).fill(null).map(()=>new Array(i+1).fill(255)),this.camera=new N,this.world=new Q,this.angle=0}async loadFromFile(t){this.mesh=await W.loadFromFile(t)}async loadFromString(t){this.mesh=await W.loadFromString(t)}run(){const t=16.666666666666668;let i=Date.now(),s,h;const e=()=>{s=Date.now(),h=s-i,h>t&&(i=s-h%t,this.render(),this.angle+=.007,this.angle>=2*3.14&&(this.angle-=2*3.14)),requestAnimationFrame(e)};requestAnimationFrame(e)}render(){this.clearFrameBuffer(),this.process(),this.drawFrameBuffer()}process(){this.camera.eye=new a(0,0,-5),this.camera.calculateViewMatrix();const t=this.camera.calculatePerspectiveMatrix(70,this.width/2/this.height,.1,1e3);this.world.setRotateX(this.angle),this.world.setRotateY(this.angle),this.world.setRotateZ(this.angle),this.world.setTranslate(new a(0,0,0)),this.mesh.forEach(i=>{let s=new y(i.vertices[0].x,i.vertices[0].y,i.vertices[0].z,1),h=new y(i.vertices[1].x,i.vertices[1].y,i.vertices[1].z,1),e=new y(i.vertices[2].x,i.vertices[2].y,i.vertices[2].z,1);s=this.world.transform(s),h=this.world.transform(h),e=this.world.transform(e),s=this.camera.transform(s),h=this.camera.transform(h),e=this.camera.transform(e);const m=new a(s.x,s.y,s.z).subtract(new a(h.x,h.y,h.z)),o=new a(s.x,s.y,s.z).subtract(new a(e.x,e.y,e.z)),w=m.cross(o).normalize(),l=new a(s.x,s.y,s.z).add(this.camera.eye);if(w.dot(l)>=0)return;s=this.transformVertex(s,t),h=this.transformVertex(h,t),e=this.transformVertex(e,t);const u=new a(0,0,1).normalize(),v=Math.max(0,w.dot(u));this.rasterize(new y(s.x,s.y,s.z,s.w),new y(h.x,h.y,h.z,h.w),new y(e.x,e.y,e.z,e.w),v)})}transformVertex(t,i){const s=t.transform(i);return s.x/=s.w,s.y/=s.w,s.z/=s.w,s}rasterize(t,i,s,h){const e=this.width/2,m=this.height/2,o=new g(t.x*e+e,-t.y*m+m),w=new g(i.x*e+e,-i.y*m+m),l=new g(s.x*e+e,-s.y*m+m),u=Math.floor(Math.max(0,Math.min(o.x,Math.min(w.x,l.x)))),v=Math.floor(Math.max(0,Math.min(o.y,Math.min(w.y,l.y)))),E=Math.floor(Math.min(this.width,Math.max(o.x,Math.max(w.x,l.x))+1)),T=Math.floor(Math.min(this.height,Math.max(o.y,Math.max(w.y,l.y))+1));for(let p=v;p<T;p++)for(let z=u;z<E;z++)if(this.isPointInTriangle(z,p,o,w,l)){const R=p*this.width+z;if(R>this.height*this.width||R<0)continue;(t.w+i.w+s.w)/3<=this.depthBuffer[p][z]&&(this.frameBuffer[p][z]=this.Shade[Math.round((this.Shade.length-1)*h)],this.depthBuffer[p][z]=(t.w+i.w+s.w)/3)}}isPointInTriangle(t,i,s,h,e){const m=((h.y-e.y)*(t-e.x)+(e.x-h.x)*(i-e.y))/((h.y-e.y)*(s.x-e.x)+(e.x-h.x)*(s.y-e.y)),o=((e.y-s.y)*(t-e.x)+(s.x-e.x)*(i-e.y))/((h.y-e.y)*(s.x-e.x)+(e.x-h.x)*(s.y-e.y)),w=1-m-o,l=m<-.001,u=o<-.001,v=w<-.001;return l==u&&u==v}drawFrameBuffer(){const t=this.frameBuffer.map(i=>i.join("").replace(/\ /g,"&nbsp;")).join("<br />");this.el.innerHTML=t}clearFrameBuffer(){this.frameBuffer=new Array(this.height+1).fill(null).map(()=>new Array(this.width+1).fill(" ")),this.depthBuffer=new Array(this.height+1).fill(null).map(()=>new Array(this.width+1).fill(255))}}const et=()=>{const n=A.useRef(null);A.useEffect(()=>{const h=new U(n.current,80,40);h.loadFromString(_),h.run()},[n.current]);const[t,i]=A.useState(0),s=()=>{i(n.current?.clientWidth||0)};return A.useEffect(()=>(window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)),[]),Z.jsx("div",{ref:n,style:{fontSize:t/700*14,lineHeight:1,width:"100%",fontFamily:"monospace"}})},_=`
# Blender v2.90.1 OBJ File: ''
# www.blender.org
o Cube
v -1.000000 1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 1.000000 -1.000000
v -1.000000 -1.000000 -1.000000
v 1.000000 1.000000 1.000000
v 1.000000 -1.000000 1.000000
v 1.000000 1.000000 -1.000000
v 1.000000 -1.000000 -1.000000
s off
f 5 3 1
f 3 8 4
f 7 6 8
f 2 8 6
f 1 4 2
f 5 2 6
f 5 7 3
f 3 7 8
f 7 5 6
f 2 4 8
f 1 3 4
f 5 1 2
`;export{et as ASCII3DRenderer,it as SpinningCube};
