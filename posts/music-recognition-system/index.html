<!DOCTYPE html><html lang="ko"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="color-scheme" content="light"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="alternate" type="application/rss+xml" title="kciter.so" href="/feed.xml"><title>음악 검색 시스템 만들기 | kciter.so</title><meta name="description" content="미래 학자이자 SF 소설의 거장 아서 C. 클라크는 충분히 발달한 과학 기술은 마법과 구별할 수 없다라는 유명한 말을 남겼다. 이 말이 사실임을 증명하듯 현대 사회의 기술은 다양한 놀라움을 선사한다. 그 중에서도 Shazam이나 Soundhound와…"><meta name="author" content="Lee Sun-Hyoup"><!-- Open Graph --><meta property="og:title" content="음악 검색 시스템 만들기 | kciter.so"><meta property="og:description" content="미래 학자이자 SF 소설의 거장 아서 C. 클라크는 충분히 발달한 과학 기술은 마법과 구별할 수 없다라는 유명한 말을 남겼다. 이 말이 사실임을 증명하듯 현대 사회의 기술은 다양한 놀라움을 선사한다. 그 중에서도 Shazam이나 Soundhound와…"><meta property="og:type" content="website"><meta property="og:site_name" content="kciter.so"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://kciter.so/images/2024-10-27-music-recognition-system/thumbnail.png"><meta property="og:url" content="https://kciter.so/posts/music-recognition-system/"><link rel="canonical" href="https://kciter.so/posts/music-recognition-system/"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="Sunhyoup Lee"><meta name="twitter:title" content="음악 검색 시스템 만들기 | kciter.so"><meta name="twitter:description" content="미래 학자이자 SF 소설의 거장 아서 C. 클라크는 충분히 발달한 과학 기술은 마법과 구별할 수 없다라는 유명한 말을 남겼다. 이 말이 사실임을 증명하듯 현대 사회의 기술은 다양한 놀라움을 선사한다. 그 중에서도 Shazam이나 Soundhound와…"><meta name="twitter:image" content="https://kciter.so/images/2024-10-27-music-recognition-system/thumbnail.png"><!-- Additional meta from props --><meta name="article:published_time" content="2024-10-27T00:00:00+09:00"><meta name="image" content="https://kciter.so/images/2024-10-27-music-recognition-system/thumbnail.png"><meta property="og:image" content="https://kciter.so/images/2024-10-27-music-recognition-system/thumbnail.png"><meta property="og:image:secure_url" content="https://kciter.so/images/2024-10-27-music-recognition-system/thumbnail.png"><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400&family=PT+Sans:wght@400&family=Source+Code+Pro&family=Quattrocento+Sans&display=swap"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-7M8K7EBEDX"></script><script>
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-7M8K7EBEDX');
        </script> <script type="application/ld+json">{"headline":"음악 검색 시스템 만들기","dateModified":"2024-10-27T00:00:00+09:00","datePublished":"2024-10-27T00:00:00+09:00","image":"https://kciter.so/images/2024-10-27-music-recognition-system/thumbnail.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://kciter.so/posts/music-recognition-system/"},"author":{"@type":"Person","name":"Lee Sun-Hyoup"},"description":"미래 학자이자 SF 소설의 거장 아서 C. 클라크는 충분히 발달한 과학 기술은 마법과 구별할 수 없다라는 유명한 말을 남겼다. 이 말이 사실임을 증명하듯 현대 사회의 기술은 다양한 놀라움을 선사한다. 그 중에서도 Shazam이나 Soundhound와…","url":"https://kciter.so/posts/music-recognition-system/","@type":"BlogPosting","@context":"https://schema.org"}</script> <link rel="stylesheet" href="/_astro/_slug_.D5IQWdfx.css">
<style>.name-gradient[data-astro-cid-k7qsseos]{background:linear-gradient(to right,#191335,#191335 33.33333%,#00ab6c 66.66666%,#00cb8c);background-clip:text;-webkit-text-fill-color:transparent;transition:all .3s ease;background-size:300% 100%;background-position:top left}.name-gradient[data-astro-cid-k7qsseos]:hover{background-position:top left 100%}@media(max-width:30rem){.sponsors[data-astro-cid-4kgnabjz] a:not(:first-of-type){margin-left:-16px}}.related-post[data-astro-cid-llggujpl]{position:relative;transform:scaleZ(1)}.related-post[data-astro-cid-llggujpl]:after{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:8px;transform:scale(1.06);transition:opacity 2s cubic-bezier(.165,.84,.44,1);box-shadow:0 8px 17px #0003,0 6px 20px #00000026;content:"";opacity:0;z-index:-1}.related-post[data-astro-cid-llggujpl]:hover{transform:scale3d(1.006,1.006,1)}.related-post[data-astro-cid-llggujpl]:hover:after{opacity:1}
</style></head> <body> <div class="mx-auto w-[715px] pt-4 max-md:w-[90vw]"> <div class="relative z-10 mb-10 -mx-4 rounded-xl bg-white/40 px-4 py-2.5 font-['Quattrocento_Sans',sans-serif] backdrop-blur-[44px] max-md:-mx-4 max-md:-mt-4 max-md:mb-8 max-md:rounded-none max-md:bg-transparent max-md:backdrop-blur-none" data-astro-cid-3ef6ksr2> <div class="mt-2 w-full" data-astro-cid-3ef6ksr2> <a href="/" class="site-title text-[32px] font-black" style="line-height: 1.15; text-decoration: none; margin-right: 5px;" data-astro-cid-3ef6ksr2>kciter.so</a> <small class="text-[#999]" data-astro-cid-3ef6ksr2>devlog</small> </div> <nav class="flex w-full justify-between pt-2" data-astro-cid-3ef6ksr2> <div class="flex items-center" data-astro-cid-3ef6ksr2> <a href="/timeline/" class="menu-item updated" data-astro-cid-3ef6ksr2>
Timeline
</a> <div class="dropdown" data-astro-cid-3ef6ksr2> <span class="menu-item dropdown-trigger" id="posts-trigger" data-astro-cid-3ef6ksr2>
Posts <span class="chevron" data-astro-cid-3ef6ksr2>&#9662;</span> </span> <div class="dropdown-menu" data-astro-cid-3ef6ksr2> <a href="/articles/" class="dropdown-item" data-astro-cid-3ef6ksr2>Articles</a> <a href="/bookshelf/" class="dropdown-item" data-astro-cid-3ef6ksr2>Bookshelf</a> <a href="/thought/" class="dropdown-item" data-astro-cid-3ef6ksr2>Thoughts</a> </div> </div> <a href="https://kciter.so/talks/" class="menu-item" data-astro-cid-3ef6ksr2>Talks</a> <a href="/about/" class="menu-item" data-astro-cid-3ef6ksr2>About</a> </div> <div class="flex items-center gap-3" data-astro-cid-3ef6ksr2> <button id="search-btn" class="search-btn" aria-label="Search" data-astro-cid-3ef6ksr2> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-3ef6ksr2> <circle cx="11" cy="11" r="8" data-astro-cid-3ef6ksr2></circle> <line x1="21" y1="21" x2="16.65" y2="16.65" data-astro-cid-3ef6ksr2></line> </svg> </button> <div class="max-md:hidden" data-astro-cid-3ef6ksr2> <a href="https://github.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="GitHub" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.2 11.38.6.12.83-.26.83-.57v-2.2c-3.34.73-4.04-1.44-4.04-1.44-.55-1.38-1.33-1.75-1.33-1.75-1.09-.74.08-.73.08-.73 1.2.09 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.49 1 .1-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6.02 0c2.28-1.55 3.28-1.23 3.28-1.23.66 1.66.25 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .31.22.7.83.57C20.57 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z"/></svg></a><a href="https://www.facebook.com/sunhyoup.lee" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="Facebook" style="--hover-color: #3d5b99; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M24 12.07C24 5.41 18.63 0 12 0S0 5.41 0 12.07c0 6.02 4.39 11.02 10.13 11.93v-8.44H7.08v-3.49h3.04V9.41c0-3.02 1.79-4.68 4.53-4.68 1.31 0 2.68.24 2.68.24v2.97h-1.51c-1.49 0-1.95.93-1.95 1.88v2.26h3.33l-.53 3.49h-2.8v8.44C19.61 23.09 24 18.09 24 12.07z"/></svg></a><a href="https://www.linkedin.com/in/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="LinkedIn" style="--hover-color: #0073a4; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M20.45 20.45h-3.55v-5.57c0-1.33-.02-3.04-1.85-3.04-1.85 0-2.14 1.45-2.14 2.94v5.67H9.36V9h3.41v1.56h.05c.48-.9 1.64-1.85 3.37-1.85 3.6 0 4.27 2.37 4.27 5.46v6.28zM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12zM7.12 20.45H3.56V9h3.56v11.45zM22.22 0H1.77C.79 0 0 .77 0 1.72v20.56C0 23.23.79 24 1.77 24h20.45C23.2 24 24 23.23 24 22.28V1.72C24 .77 23.2 0 22.22 0z"/></svg></a><a href="https://twitter.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="X (Twitter)" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href="/feed.xml" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="RSS Feed" style="--hover-color: #ff6600; transition: color .5s;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M6.18 15.64a2.18 2.18 0 1 1 0 4.36 2.18 2.18 0 0 1 0-4.36zM4 4.44v3.57A12.01 12.01 0 0 1 15.99 20h3.57A15.57 15.57 0 0 0 4 4.44zM4 10.1v3.57c3.5 0 6.33 2.84 6.33 6.33h3.57c0-5.47-4.43-9.9-9.9-9.9z"/></svg></a> </div> </div> </nav> <!-- Mobile sub-tab (hidden by default) --> <div class="mobile-tabs" id="mobile-tabs" data-astro-cid-3ef6ksr2> <a href="/articles/" class="mobile-tab" data-astro-cid-3ef6ksr2>Articles</a> <a href="/bookshelf/" class="mobile-tab" data-astro-cid-3ef6ksr2>Bookshelf</a> <a href="/thought/" class="mobile-tab" data-astro-cid-3ef6ksr2>Thoughts</a> </div> </div> <!-- Search Modal --> <div id="search-modal" class="search-modal" data-astro-cid-3ef6ksr2> <div class="search-backdrop" data-astro-cid-3ef6ksr2></div> <div class="search-container" data-astro-cid-3ef6ksr2> <div class="search-input-wrap" data-astro-cid-3ef6ksr2> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-3ef6ksr2> <circle cx="11" cy="11" r="8" data-astro-cid-3ef6ksr2></circle> <line x1="21" y1="21" x2="16.65" y2="16.65" data-astro-cid-3ef6ksr2></line> </svg> <input id="search-input" type="text" placeholder="Search posts..." autocomplete="off" data-astro-cid-3ef6ksr2> <kbd class="search-kbd" data-astro-cid-3ef6ksr2>ESC</kbd> </div> <div id="search-results" class="search-results" data-astro-cid-3ef6ksr2></div> </div> </div>  <script type="module">const o=document.getElementById("posts-trigger"),l=document.getElementById("mobile-tabs");if(o&&l){const e=o.querySelector(".chevron");o.addEventListener("click",t=>{window.innerWidth<=768&&(t.preventDefault(),l.classList.toggle("open"),e?.classList.toggle("open"))});const i=window.location.pathname;l.querySelectorAll(".mobile-tab").forEach(t=>{i.startsWith(t.getAttribute("href")||"")&&t.classList.add("active")})}let s=null;async function m(){if(s)return s;try{s=await import(new URL("/pagefind/pagefind.js",window.location.origin).href),await s.init()}catch{console.warn("Pagefind not available (run build first)")}return s}const c=document.getElementById("search-modal"),r=document.getElementById("search-input"),a=document.getElementById("search-results"),p=document.getElementById("search-btn"),v=c.querySelector(".search-backdrop");function f(){c.classList.add("open"),r.value="",a.innerHTML="",setTimeout(()=>r.focus(),50),m()}function d(){c.classList.remove("open")}p.addEventListener("click",f);v.addEventListener("click",d);document.addEventListener("keydown",e=>{(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),c.classList.contains("open")?d():f()),e.key==="Escape"&&d()});let u;r.addEventListener("input",()=>{clearTimeout(u),u=setTimeout(()=>g(r.value),200)});async function g(e){if(!e.trim()){a.innerHTML="";return}const i=await m();if(!i){a.innerHTML='<div class="search-no-results">Search is not available in dev mode.</div>';return}const t=await i.search(e);if(t.results.length===0){a.innerHTML='<div class="search-no-results">No results found.</div>';return}const h=await Promise.all(t.results.slice(0,10).map(n=>n.data()));a.innerHTML=h.map(n=>`
        <a href="${n.url}" class="search-result-item">
          <div class="search-result-title">${n.meta?.title||n.url}</div>
          <div class="search-result-excerpt">${n.excerpt}</div>
        </a>
      `).join("")}</script> <div class="post-container">   <h1 class="post-title">음악 검색 시스템 만들기</h1> <span class="post-date">Written on October 27, 2024</span> <img src="/images/2024-10-27-music-recognition-system/thumbnail.png" alt="음악 검색 시스템 만들기" style="width: 100%;"><div class="toc" data-margin-top="50"><ul class="toc-list"><li><a href="#시스템-살펴보기">시스템 살펴보기</a></li><li><a href="#배경-지식">배경 지식</a><ul class="toc-list"><li><a href="#왜-wav-파일인가">왜 WAV 파일인가?</a></li><li><a href="#샘플링sampling">샘플링(Sampling)</a></li><li><a href="#스펙트로그램spectrogram">스펙트로그램(Spectrogram)</a></li><li><a href="#푸리에-변환fourier-transform">푸리에 변환(Fourier Transform)</a></li><li><a href="#피크peak">피크(Peak)</a></li><li><a href="#소리-지문audio-fingerprint">소리 지문(Audio Fingerprint)</a></li></ul></li><li><a href="#구현">구현</a><ul class="toc-list"><li><a href="#알고리즘-절차">알고리즘 절차</a></li><li><a href="#샘플링-데이터-만들기">샘플링 데이터 만들기</a></li><li><a href="#스펙트로그램-만들기">스펙트로그램 만들기</a></li><li><a href="#피크-추출하기">피크 추출하기</a></li><li><a href="#소리-지문-만들기">소리 지문 만들기</a></li><li><a href="#음악-검색-함수-만들기">음악 검색 함수 만들기</a></li><li><a href="#녹음해서-검색하기">녹음해서 검색하기</a></li></ul></li><li><a href="#마치며">마치며</a><ul class="toc-list"><li><a href="#footnote-label">Footnotes</a></li></ul></li></ul></div><div class="mt-2 box-border w-full rounded-lg bg-[#f8f9fa] p-4"> <div class="mb-2 text-xl font-bold">바퀴의 재발명 시리즈</div> <ul style="margin: 0; padding: 0; padding-left: 24px;"> <li style> <a href="/posts/crafting-esolang/" style="text-decoration: none; color: #333;"> 난해한 프로그래밍 언어 만들어보기 </a> </li><li style> <a href="/posts/ascii-3d-renderer/" style="text-decoration: none; color: #333;"> ASCII 3D 렌더러 만들기 </a> </li><li style> <a href="/posts/encrypted-vault-system/" style="text-decoration: none; color: #333;"> 비밀 관리를 위한 금고 시스템 만들기 </a> </li><li style="color: #00a962;"> <a href="/posts/music-recognition-system/" style="text-decoration: none; color: #333; font-weight: bold;"> 음악 검색 시스템 만들기 </a> </li> </ul> </div><div class="post-content" data-pagefind-body>  <p>미래 학자이자 SF 소설의 거장 아서 C. 클라크는 <code>충분히 발달한 과학 기술은 마법과 구별할 수 없다</code>라는 유명한 말을 남겼다. 이 말이 사실임을 증명하듯 현대 사회의 기술은 다양한 놀라움을 선사한다. 그 중에서도 <a href="https://www.shazam.com/ko" rel="noopener noreferrer" target="_blank">Shazam</a>이나 <a href="https://www.soundhound.com/" rel="noopener noreferrer" target="_blank">Soundhound</a>와 같은 음악 검색 앱을 사용할 때 필자는 항상 마법을 쓰는 것 같은 기분을 느낀다.</p>
<figure><img src="/images/2024-10-27-music-recognition-system/shazam.jpg" alt="마치 마법처럼 터치 한 번이면 들리는 음악 정보를 알려준다" loading="lazy" width="500px" style="cursor:default;max-width:90%;margin:0 auto;display:block"/><figcaption>마치 마법처럼 터치 한 번이면 들리는 음악 정보를 알려준다</figcaption></figure>
<p>음악 검색 앱은 대체 어떤 원리로 우리에게 놀라움을 선사할까? 이런 궁금증이 멈추지 않아 이번 기회에 음악 검색 알고리즘에 대해 알아보았고 생각보다 복잡하지 않아 이를 구현해보기로 결정했다. 이번 글에서는 음악 검색 시스템을 만들기 위한 알고리즘과 구현 방법에 대해 알아보겠다.</p>
<h1 id="시스템-살펴보기"><a href="#시스템-살펴보기">시스템 살펴보기</a></h1>
<p>우선 음악 검색 시스템을 구현하기 위해선 몇 가지 신호 처리에 대한 지식과 알고리즘을 알아야 한다. 그러나 일단 배경 지식을 자세히 알아보기 전에 어떤 방식으로 음악 검색 시스템이 동작하는지 간단하게 알아보자.</p>
<figure><img src="/images/2024-10-27-music-recognition-system/music-recognition-flow.png" alt="음악 검색의 두 흐름" loading="lazy" width="100%" style="cursor:default;margin:0 auto;display:block"/><figcaption>음악 검색의 두 흐름</figcaption></figure>
<p>음악 검색 시스템은 크게 두 가지로 나눌 수 있다. 하나는 <strong>등록 절차</strong>로 이미 존재하는 음원을 소리 지문(Audio Fingerprint)이라는 것으로 만들어 데이터베이스에 저장하는 것이다. 여기서 말하는 소리 지문이란 음원에 대한 소리 정보를 해싱한 것으로 음원에서 추출한 스펙트로그램(Spectrogram)을 통해 만들 수 있다.</p>
<p>나머지 하나는 <strong>검색 절차</strong>로 입력받은 음원을 소리 지문으로 만들어 데이터베이스에 저장된 소리 지문과 대조하여 가장 유사한 음원을 찾아내는 것이다. 이 절차에서 대조하는 부분을 제외하면 등록 절차와 동일한 알고리즘을 사용한다. 따라서 음원에서 소리 지문 생성 알고리즘만 구현하면 음악 검색 시스템 90%는 완성했다고 볼 수 있다.</p>
<p>그럼 다음으로 소리 지문 생성 알고리즘이 어떻게 동작하는지 조금 더 자세히 알아보자. 다음 도식은 알고리즘을 조금 더 구체적으로 나타낸 것이다.</p>
<figure><img src="/images/2024-10-27-music-recognition-system/audio-fingerprinting-algorithm.png" alt="소리 지문 생성 알고리즘" loading="lazy" width="100%" style="cursor:default;margin:0 auto;display:block"/><figcaption>소리 지문 생성 알고리즘</figcaption></figure>
<p>신호 처리 알고리즘에 대해 익숙하지 않다면 위 도식에서 사용된 용어가 생소할 수 있다. 지금 기억할 것은 위에 나온 용어를 이해하고 실제로 구현할 수 있다면 음악 검색 시스템을 만들 수 있다는 것이다.</p>
<h1 id="배경-지식"><a href="#배경-지식">배경 지식</a></h1>
<p>이제 필요한 배경 지식을 하나씩 알아보자. 지금부터 앞서 언급한 샘플링(Sampling), 스펙트로그램(Spectrogram), 피크(Peak), 소리 지문(Audio Fingerprint)를 포함하여 관련된 지식을 익혀볼 것이다.</p>
<h2 id="왜-wav-파일인가"><a href="#왜-wav-파일인가">왜 WAV 파일인가?</a></h2>
<p>음악 검색 시스템을 구현하기 위해선 변형되지 않은 음원을 사용해야 한다. 따라서 MP3, AAC, OGG 등의 손실 압축된 음원은 사용할 수 없다. 반면 WAV 파일은 비압축 PCM<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref aria-describedby="footnote-label">1</a></sup> 형식이기 때문에 변형되지 않은 원본 음원을 사용할 수 있다.</p>
<p>그래서 알고리즘 중 생략된 부분이 있다면 음원을 WAV로 변환하는 부분이다. 이 부분은 간단하게 FFmpeg를 사용하면 WAV로 변환할 수 있다.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1">ffmpeg</span><span style="color:#005CC5"> -i</span><span style="color:#032F62"> input.mp3</span><span style="color:#005CC5"> -acodec</span><span style="color:#032F62"> pcm_s16le</span><span style="color:#005CC5"> -ac</span><span style="color:#005CC5"> 1</span><span style="color:#005CC5"> -ar</span><span style="color:#005CC5"> 44100</span><span style="color:#032F62"> output.wav</span></span></code></pre>
<p>한 가지 중요한 것은 채널 수와 샘플링 주파수를 맞추는 것이다. 채널(-ac)을 1로 설정하면 모노<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref aria-describedby="footnote-label">2</a></sup>로 변환하고 샘플링 주파수(-ar)를 44100으로 설정하면 1초당 44100개의 샘플링을 하게 된다.</p>
<p>여기서는 간단히 쉘에서 명령어를 실행하여 변환했지만 프로그램에서 사용할 때는 FFmpeg 라이브러리를 사용하여 처리하면 된다.</p>
<h2 id="샘플링sampling"><a href="#샘플링sampling">샘플링(Sampling)</a></h2>
<p>앞서 샘플링 주파수를 언급했는데 샘플링이란 아날로그 신호를 디지털 신호로 변환하는 과정을 말한다. 아날로그 신호는 연속적인 값이지만 디지털 신호는 이산적인 값이다. 따라서 아날로그 신호를 디지털 신호로 변환하기 위해 일정한 시간 간격으로 샘플링하여 디지털 신호로 변환한다. 샘플링 주파수란 1초 동안 샘플링하는 횟수를 말한다. 이 횟수가 높을수록 원본 신호를 정확하게 표현할 수 있다.</p>
<figure><img src="/images/2024-10-27-music-recognition-system/sampling.jpg" alt="촘촘할 수록 오리지널에 가깝다" loading="lazy" width="100%" style="cursor:default;max-width:400px;margin:0 auto;display:block"/><figcaption>촘촘할 수록 오리지널에 가깝다</figcaption></figure>
<p>소리 지문을 만들기 위해서는 후술할 스펙트로그램이 필요하다. 이 스펙트로그램을 만들기 위해서는 샘플링된 데이터가 필요하고 이 데이터는 WAV 파일 바이트로부터 얻을 수 있다. 이 때문에 비압축 PCM 형식인 WAV 파일을 사용하는 것이다.</p>
<h2 id="스펙트로그램spectrogram"><a href="#스펙트로그램spectrogram">스펙트로그램(Spectrogram)</a></h2>
<p>스펙트로그램은 시간에 따른 진폭과 주파수 변화를 시각화한 그래프이다. 이 말이 조금 어렵게 느껴질 수 있는데 오디오 프로그램에서 간혹 볼 수 있는 그래프같은 그림이 이 스펙트로그램을 기반으로 파형만을 이용해 만들어진 것이다.</p>
<figure><img src="/images/2024-10-27-music-recognition-system/audio-wave.jpg" alt="오디오 웨이브" loading="lazy" width="500px" style="cursor:default;max-width:90%;margin:0 auto;display:block"/><figcaption>오디오 웨이브</figcaption></figure>
<p>파형은 시간과 진폭으로 이루어져 있다. 위 그림으로 치면 가로 축이 시간, 세로 축이 진폭이다. 이를 통해 시간에 따른 소리의 세기 변화를 알 수 있다. 여기서 스펙트로그램은 파형 뿐만 아니라 스펙트럼도 함께 표현한다.</p>
<p>스펙트럼은 주파수 영역에서의 세기를 나타내는 그래프로 가로 축이 주파수, 세로 축이 진폭에 해당한다. 다음 그림은 실제 스펙트로그램이다.</p>
<figure><img src="/images/2024-10-27-music-recognition-system/spectrogram.png" alt="스펙트로그램" loading="lazy" width="100%" style="cursor:default;margin:0 auto;display:block"/><figcaption>스펙트로그램</figcaption></figure>
<p>스펙트로그램은 가로 축(x축)이 시간, 세로 축(y축)이 주파수, 색상(z축)이 진폭을 나타낸다. 이를 통해 시간에 따른 진폭과 주파수의 세기 변화를 알 수 있다. 스펙트로그램은 소리 지문을 만들기 위한 중요한 데이터이다. 스펙트로그램은 FFT(Fast Fourier Transform) 알고리즘을 사용하여 만들 수 있다. 참고로 음악 검색을 위해서는 데이터만 필요하기 때문에 실제 시각화를 할 필요는 없다.</p>
<h2 id="푸리에-변환fourier-transform"><a href="#푸리에-변환fourier-transform">푸리에 변환(Fourier Transform)</a></h2>
<p>앞서 스펙트로그램을 만들기 위해서는 FFT 알고리즘이 필요하다고 했다. 우선 맨 앞 Fast를 때고 푸리에 변환(Fourier Transform)이 무엇인지 알아보자.</p>
<p>푸리에 변환은 소리를 주파수 영역으로 변환하는 방법이다. 조금 더 쉽게 설명하자면 소리에서 어떤 주파수가 있는지 알아내는 것이 가능하다. 예를 들어, 20Hz 사인파 소리를 푸리에 변환하면 20Hz의 세기가 1이고 나머지는 0이 된다. 만약 20Hz와 40Hz 사인파 소리가 섞여 있다면 20Hz와 40Hz의 세기가 1이고 나머지는 0이 된다. 좀 더 복잡한 소리도 마찬가지로 주파수 영역으로 변환할 수 있다. 앞서 샘플링된 데이터를 만들었다면 이 데이터를 푸리에 변환하여 주파수 영역으로 변환할 수 있다.</p>
<figure><img src="/images/2024-10-27-music-recognition-system/fourier-transform.png" alt="샘플링 데이터를 푸리에 변환하여 만들어진 스펙트로그램" loading="lazy" width="100%" style="cursor:default;margin:0 auto;display:block"/><figcaption>샘플링 데이터를 푸리에 변환하여 만들어진 스펙트로그램</figcaption></figure>
<p>앞서 만든 시간을 구간으로 나눠서 만든 샘플링 데이터를 푸리에 변환하면 시간의 흐름에 따른 주파수 진폭을 알 수 있다. 그리고 이를 통해 스펙트로그램을 만들 수 있다.</p>
<p>음악은 여러 주파수의 합으로 이루어져 있기 때문에 이 주파수가 노래를 고유하게 만들며 식별할 수 있게 한다. 따라서 푸리에 변환을 통해 만들어낸 스펙트로그램이 음악 검색 시스템에서 가장 중요하다고 볼 수 있다.</p>
<h2 id="피크peak"><a href="#피크peak">피크(Peak)</a></h2>
<p>피크는 스펙트로그램에서 주파수 영역에서의 세기가 높은 부분을 말한다. 스펙트로그램 그림에서 보자면 피크는 색상이 짙은 부분을 말한다. 피크는 (시간, 주파수) 쌍으로 이루어져 있으며 정확도를 위해 각종 노이즈를 필터링하고 성능을 위해 적절한 시간 간격을 두어야 한다. 피크를 추출하는 이유는 두 가지다.</p>
<ol>
<li>피크를 찾아 추출하면 효과적으로 스펙트로그램을 압축할 수 있기 때문이다.</li>
<li>추출한 피크를 통해 소리 지문을 만들기 위함이다.</li>
</ol>
<p>사실 스펙트로그램 데이터 자체를 소리 지문으로 사용할 수도 있지만 이는 너무 데이터가 많아 비효율적이다. 피크를 추출하면 더 효율적으로 적은 데이터로 소리 지문을 만들 수 있다. 그래서 피크를 추출하는 것은 성능을 위해 필요한 작업이다.</p>
<h2 id="소리-지문audio-fingerprint"><a href="#소리-지문audio-fingerprint">소리 지문(Audio Fingerprint)</a></h2>
<p>추출한 피크를 해싱하면 소리 지문이 된다. 해싱을 어떻게 할지는 구현 방법에 따라 다르지만 피크 수가 적지 않으므로 해싱 성능을 고려해야 한다. 이렇게 만들어진 소리 지문은 데이터베이스에 저장하여 음악을 식별할 때 사용한다.</p>

<h1 id="구현"><a href="#구현">구현</a></h1>
<p>앞서 알아본 배경 지식을 바탕으로 실제 음악 검색 시스템을 구현해보자. 음악 검색 시스템을 만들기 위한 과정은 다음과 같다.</p>
<ol>
<li>WAV 파일을 읽어 샘플링 데이터를 만든다.</li>
<li>샘플링 데이터를 푸리에 변환하여 스펙트로그램을 만든다.</li>
<li>스펙트로그램에서 시간대 별로 피크를 추출한다.</li>
<li>추출한 여러 피크를 해싱하여 소리 지문을 만든다.</li>
<li>소리 지문을 데이터베이스에 저장하거나 검색하여 가장 유사한 음원을 찾는다.</li>
</ol>
<p>실제 구현할 때는 위 과정에서 최적화와 정확도를 위해 여러 방법을 사용해야 한다. 이 부분이 각 음악 검색 서비스의 핵심이라고 볼 수 있다.</p>
<p>그럼 이제 동작하는 코드를 작성해보자. 여기서 WAV로 변환하는 것은 생략할 것이며 간단하게 구현하기 위해 데이터베이스도 이용하지 않을 것이다. 그리고 언어는 Rust를 사용할 것이다. 성능 같은 이유는 아니고 이후 WASM으로 빌드하여 웹에서 동작시키기 위함이다.</p>
<h2 id="알고리즘-절차"><a href="#알고리즘-절차">알고리즘 절차</a></h2>
<p>먼저 앞서 설명한 알고리즘 절차를 코드로 작성해보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#6A737D">// 소리 지문을 저장할 전역 변수</span></span>
<span class="line"><span style="color:#6A737D">// DB를 사용하지 않을 것이다</span></span>
<span class="line"><span style="color:#D73A49">static</span><span style="color:#D73A49"> mut</span><span style="color:#005CC5"> MUSIC_FINGERPRINTS</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;(</span><span style="color:#6F42C1">String</span><span style="color:#24292E">, </span><span style="color:#6F42C1">Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">u64</span><span style="color:#24292E">&gt;)&gt; </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">pub</span><span style="color:#D73A49"> fn</span><span style="color:#6F42C1"> register</span><span style="color:#24292E">(name</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> String</span><span style="color:#24292E">, data</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">u8</span><span style="color:#24292E">&gt;) {</span></span>
<span class="line"><span style="color:#6A737D">    // 1. WAV 데이터에서 샘플링 데이터를 만든다</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> samples </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> bytes_to_samples</span><span style="color:#24292E">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 2. 샘플링 데이터로 스펙트로그램을 만든다</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> spectrogram </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> create_spectrogram</span><span style="color:#24292E">(samples);</span></span>
<span class="line"><span style="color:#24292E">    </span></span>
<span class="line"><span style="color:#6A737D">    // 3. 스펙트로그램에서 피크를 추출한다</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> peaks </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> extract_peaks</span><span style="color:#24292E">(spectrogram);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 4. 피크로 소리 지문을 만든다</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> fingerprints </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> create_fingerprints</span><span style="color:#24292E">(peaks);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 5. 소리 지문을 메모리에 저장한다</span></span>
<span class="line"><span style="color:#D73A49">    unsafe</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#005CC5">        MUSIC_FINGERPRINTS</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">((name, fingerprints));</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">pub</span><span style="color:#D73A49"> fn</span><span style="color:#6F42C1"> search</span><span style="color:#24292E">(data</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">u8</span><span style="color:#24292E">&gt;) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> String</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">    // 1. WAV 데이터에서 샘플링 데이터를 만든다</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> samples </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> bytes_to_samples</span><span style="color:#24292E">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 2. 샘플링 데이터로 스펙트로그램을 만든다</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> spectrogram </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> create_spectrogram</span><span style="color:#24292E">(samples);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 3. 스펙트로그램에서 피크를 추출한다</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> peaks </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> extract_peaks</span><span style="color:#24292E">(spectrogram);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 4. 피크로 소리 지문을 만든다</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> fingerprints </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> create_fingerprints</span><span style="color:#24292E">(peaks);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 5. 소리 지문을 검색하여 가장 유사한 음원을 찾아 반환한다</span></span>
<span class="line"><span style="color:#D73A49">    unsafe</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">        search_fingerprints</span><span style="color:#24292E">(</span><span style="color:#005CC5">MUSIC_FINGERPRINTS</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">clone</span><span style="color:#24292E">(), fingerprints)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>위 코드는 앞서 설명한 알고리즘 절차를 그대로 코드로 옮긴 것이다. 실제로 동작시키기 위해선 각 함수를 구현해야 한다.</p>
<h2 id="샘플링-데이터-만들기"><a href="#샘플링-데이터-만들기">샘플링 데이터 만들기</a></h2>
<p>먼저 WAV 파일 데이터를 읽어 샘플링 데이터를 만들어보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#D73A49">pub</span><span style="color:#D73A49"> fn</span><span style="color:#6F42C1"> bytes_to_samples</span><span style="color:#24292E">(data</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">u8</span><span style="color:#24292E">&gt;) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt; {</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> data</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() </span><span style="color:#D73A49">%</span><span style="color:#005CC5"> 2</span><span style="color:#D73A49"> !=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">        panic!</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Invalid WAV data&quot;</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> samples </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> i </span><span style="color:#D73A49">in</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49">..</span><span style="color:#24292E">data</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() </span><span style="color:#D73A49">/</span><span style="color:#005CC5"> 2</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> sample </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> i16</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">from_le_bytes</span><span style="color:#24292E">([data[i </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">], data[i </span><span style="color:#D73A49">*</span><span style="color:#005CC5"> 2</span><span style="color:#D73A49"> +</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">]]);</span></span>
<span class="line"><span style="color:#24292E">        samples</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(sample </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#D73A49"> /</span><span style="color:#6F42C1"> i16</span><span style="color:#D73A49">::</span><span style="color:#005CC5">MAX</span><span style="color:#D73A49"> as</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">); </span><span style="color:#6A737D">// sample / 32768.0</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    samples</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>위 코드는 WAV 파일 데이터를 읽어 샘플링 데이터로 변환하는 함수이다. 우선 규칙 상 WAV 파일 바이트의 길이는 2의 배수여야 하므로 이를 체크하여 올바른 데이터인지 확인 할 수 있다.</p>
<p>그리고 WAV는 16비트로 인코딩되어 있기 때문에 2바이트씩 읽어 i16로 변환한 후 f32로 변환하여 -1.0 ~ 1.0 사이의 값으로 정규화한다. 즉, 2바이트 단위로 샘플링 데이터를 만들었다는 뜻이다.</p>
<h2 id="스펙트로그램-만들기"><a href="#스펙트로그램-만들기">스펙트로그램 만들기</a></h2>
<p>다음으로 추출한 샘플링 데이터로 스펙트로그램을 만들어보자. 여기서는 FFT 알고리즘을 사용하기 위해 RustFFT 라이브러리를 사용할 것이다.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#D73A49">use</span><span style="color:#6F42C1"> rustfft</span><span style="color:#D73A49">::</span><span style="color:#24292E">{</span><span style="color:#6F42C1">FftPlanner</span><span style="color:#24292E">, </span><span style="color:#6F42C1">num_complex</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">Complex</span><span style="color:#24292E">};</span></span>
<span class="line"><span style="color:#D73A49">use</span><span style="color:#6F42C1"> std</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">f32</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">consts</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">PI</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/// 해밍 윈도우를 적용해 각 프레임을 생성</span></span>
<span class="line"><span style="color:#D73A49">fn</span><span style="color:#6F42C1"> hamming_window</span><span style="color:#24292E">(size</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> usize</span><span style="color:#24292E">) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt; {</span></span>
<span class="line"><span style="color:#24292E">    (</span><span style="color:#005CC5">0</span><span style="color:#D73A49">..</span><span style="color:#24292E">size)</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">map</span><span style="color:#24292E">(</span><span style="color:#D73A49">|</span><span style="color:#24292E">i</span><span style="color:#D73A49">|</span><span style="color:#005CC5"> 0.54</span><span style="color:#D73A49"> -</span><span style="color:#005CC5"> 0.46</span><span style="color:#D73A49"> *</span><span style="color:#24292E"> ((</span><span style="color:#005CC5">2.0</span><span style="color:#D73A49"> *</span><span style="color:#005CC5"> PI</span><span style="color:#D73A49"> *</span><span style="color:#24292E"> i </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">) </span><span style="color:#D73A49">/</span><span style="color:#24292E"> (size </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#D73A49"> -</span><span style="color:#005CC5"> 1.0</span><span style="color:#24292E">))</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">cos</span><span style="color:#24292E">())</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">collect</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/// 간단한 저역 통과 필터 적용</span></span>
<span class="line"><span style="color:#D73A49">fn</span><span style="color:#6F42C1"> low_pass_filter</span><span style="color:#24292E">(samples</span><span style="color:#D73A49">:</span><span style="color:#D73A49"> &amp;</span><span style="color:#24292E">[</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">], max_freq</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">, sample_rate</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt; {</span></span>
<span class="line"><span style="color:#24292E">    samples</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">iter</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">map</span><span style="color:#24292E">(</span><span style="color:#D73A49">|&amp;</span><span style="color:#24292E">s</span><span style="color:#D73A49">|</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> s </span><span style="color:#D73A49">&lt;</span><span style="color:#24292E"> max_freq </span><span style="color:#D73A49">/</span><span style="color:#24292E"> sample_rate { s } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> { </span><span style="color:#005CC5">0.0</span><span style="color:#24292E"> })</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">collect</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/// 다운샘플링을 수행하여 샘플 수 줄임</span></span>
<span class="line"><span style="color:#D73A49">fn</span><span style="color:#6F42C1"> downsample</span><span style="color:#24292E">(input</span><span style="color:#D73A49">:</span><span style="color:#D73A49"> &amp;</span><span style="color:#24292E">[</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">], original_sample_rate</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> usize</span><span style="color:#24292E">, target_sample_rate</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> usize</span><span style="color:#24292E">) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt; {</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> ratio </span><span style="color:#D73A49">=</span><span style="color:#24292E"> original_sample_rate </span><span style="color:#D73A49">/</span><span style="color:#24292E"> target_sample_rate;</span></span>
<span class="line"><span style="color:#24292E">    input</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">iter</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">step_by</span><span style="color:#24292E">(ratio)</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">copied</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">collect</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">/// 스펙트로그램 생성 함수</span></span>
<span class="line"><span style="color:#D73A49">pub</span><span style="color:#D73A49"> fn</span><span style="color:#6F42C1"> create_spectrogram</span><span style="color:#24292E">(samples</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt;) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt;&gt; {</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> sample_rate</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> usize</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 44100</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> max_freq</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> f32</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 5000.0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> freq_bin_size</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> usize</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 1024</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> hop_size</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> usize</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 512</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> dsp_ratio</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> usize</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 4</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    </span></span>
<span class="line"><span style="color:#6A737D">    // 저역 통과 필터 적용 및 다운샘플링</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> filtered_samples </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> low_pass_filter</span><span style="color:#24292E">(</span><span style="color:#D73A49">&amp;</span><span style="color:#24292E">samples, max_freq, sample_rate </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> downsampled_samples </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> downsample</span><span style="color:#24292E">(</span><span style="color:#D73A49">&amp;</span><span style="color:#24292E">filtered_samples, sample_rate, sample_rate </span><span style="color:#D73A49">/</span><span style="color:#24292E"> dsp_ratio);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> num_windows </span><span style="color:#D73A49">=</span><span style="color:#24292E"> downsampled_samples</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() </span><span style="color:#D73A49">/</span><span style="color:#24292E"> (freq_bin_size </span><span style="color:#D73A49">-</span><span style="color:#24292E"> hop_size);</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> spectrogram </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">with_capacity</span><span style="color:#24292E">(num_windows);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 해밍 윈도우 생성</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> window </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> hamming_window</span><span style="color:#24292E">(freq_bin_size);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // FFT 설정</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> planner </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> FftPlanner</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> fft </span><span style="color:#D73A49">=</span><span style="color:#24292E"> planner</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">plan_fft_forward</span><span style="color:#24292E">(freq_bin_size);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> i </span><span style="color:#D73A49">in</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49">..</span><span style="color:#24292E">num_windows {</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> start </span><span style="color:#D73A49">=</span><span style="color:#24292E"> i </span><span style="color:#D73A49">*</span><span style="color:#24292E"> hop_size;</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> end </span><span style="color:#D73A49">=</span><span style="color:#24292E"> start </span><span style="color:#D73A49">+</span><span style="color:#24292E"> freq_bin_size;</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> bin </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> vec!</span><span style="color:#24292E">[</span><span style="color:#6F42C1">Complex</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">(</span><span style="color:#005CC5">0.0</span><span style="color:#24292E">, </span><span style="color:#005CC5">0.0</span><span style="color:#24292E">); freq_bin_size];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // 윈도우링 적용</span></span>
<span class="line"><span style="color:#D73A49">        for</span><span style="color:#24292E"> j </span><span style="color:#D73A49">in</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49">..</span><span style="color:#24292E">freq_bin_size {</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> start </span><span style="color:#D73A49">+</span><span style="color:#24292E"> j </span><span style="color:#D73A49">&lt;</span><span style="color:#24292E"> downsampled_samples</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#24292E">                bin[j] </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Complex</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">(downsampled_samples[start </span><span style="color:#D73A49">+</span><span style="color:#24292E"> j] </span><span style="color:#D73A49">*</span><span style="color:#24292E"> window[j], </span><span style="color:#005CC5">0.0</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // FFT 수행</span></span>
<span class="line"><span style="color:#24292E">        fft</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">process</span><span style="color:#24292E">(</span><span style="color:#D73A49">&amp;mut</span><span style="color:#24292E"> bin);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // 스펙트럼 강도 계산 후 저장</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> spectrum_magnitudes</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt; </span><span style="color:#D73A49">=</span><span style="color:#24292E"> bin</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">iter</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">map</span><span style="color:#24292E">(</span><span style="color:#D73A49">|</span><span style="color:#24292E">c</span><span style="color:#D73A49">|</span><span style="color:#24292E"> c</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">norm</span><span style="color:#24292E">())</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">collect</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">        spectrogram</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(spectrum_magnitudes);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    spectrogram</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>위 코드는 샘플링 데이터를 받아 스펙트로그램을 만드는 함수이다. 먼저 노이즈와 사람에게 의미없는 고주파 주파수를 제거하기 위해 저역 통과 필터(Low-pass filter)를 적용하여 원하는 주파수 이상의 데이터를 제거한다. 이를 통해 스펙트로그램을 만드는 소요 시간을 줄일 수 있다.</p>
<p>그리고 이어서 FFT를 수행하기 위해 다운샘플링을 수행하여 샘플 수를 줄인다. 여기서는 44100 단위로 샘플링된 데이터를 11025 단위로 다운샘플링한다.</p>
<p>이어서 해밍 윈도우를 적용하여 각 프레임을 생성하고 FFT를 수행하여 스펙트럼을 계산한다. 해밍 윈도우는 FFT를 수행하기 전에 적용하여 주파수 영역에서의 세기를 계산할 수 있게 한다.</p>
<p>이 절차를 진행하고 나면 스펙트로그램이 생성된다.</p>
<h2 id="피크-추출하기"><a href="#피크-추출하기">피크 추출하기</a></h2>
<p>이제 앞서 생성된 스펙트로그램에서 피크를 추출해보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#6A737D">/// 스펙트로그램을 분석하여 주파수 대역에서 주요 피크를 추출하는 함수</span></span>
<span class="line"><span style="color:#D73A49">pub</span><span style="color:#D73A49"> fn</span><span style="color:#6F42C1"> extract_peaks</span><span style="color:#24292E">(spectrogram</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt;&gt;, audio_duration</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;(</span><span style="color:#6F42C1">usize</span><span style="color:#24292E">, </span><span style="color:#6F42C1">usize</span><span style="color:#24292E">)&gt; {</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> spectrogram</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">is_empty</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> bands </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> vec!</span><span style="color:#24292E">[(</span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">10</span><span style="color:#24292E">), (</span><span style="color:#005CC5">10</span><span style="color:#24292E">, </span><span style="color:#005CC5">20</span><span style="color:#24292E">), (</span><span style="color:#005CC5">20</span><span style="color:#24292E">, </span><span style="color:#005CC5">40</span><span style="color:#24292E">), (</span><span style="color:#005CC5">40</span><span style="color:#24292E">, </span><span style="color:#005CC5">80</span><span style="color:#24292E">), (</span><span style="color:#005CC5">80</span><span style="color:#24292E">, </span><span style="color:#005CC5">160</span><span style="color:#24292E">), (</span><span style="color:#005CC5">160</span><span style="color:#24292E">, </span><span style="color:#005CC5">512</span><span style="color:#24292E">)];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> bin_duration </span><span style="color:#D73A49">=</span><span style="color:#24292E"> audio_duration </span><span style="color:#D73A49">/</span><span style="color:#24292E"> spectrogram</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> peaks </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> (bin_idx, bin) </span><span style="color:#D73A49">in</span><span style="color:#24292E"> spectrogram</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">iter</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">enumerate</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> max_mags </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> max_freqs </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> freq_indices </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">        for</span><span style="color:#24292E"> (min, max) </span><span style="color:#D73A49">in</span><span style="color:#D73A49"> &amp;</span><span style="color:#24292E">bands {</span></span>
<span class="line"><span style="color:#D73A49">            let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> max_mag </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0.0</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">            let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> max_freq_idx </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> *</span><span style="color:#24292E">min;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">            for</span><span style="color:#24292E"> freq_idx </span><span style="color:#D73A49">in</span><span style="color:#D73A49"> *</span><span style="color:#24292E">min</span><span style="color:#D73A49">..*</span><span style="color:#24292E">max {</span></span>
<span class="line"><span style="color:#D73A49">                if</span><span style="color:#24292E"> freq_idx </span><span style="color:#D73A49">&lt;</span><span style="color:#24292E"> bin</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">                    let</span><span style="color:#24292E"> magnitude </span><span style="color:#D73A49">=</span><span style="color:#24292E"> bin[freq_idx];</span></span>
<span class="line"><span style="color:#D73A49">                    if</span><span style="color:#24292E"> magnitude </span><span style="color:#D73A49">&gt;</span><span style="color:#24292E"> max_mag {</span></span>
<span class="line"><span style="color:#24292E">                        max_mag </span><span style="color:#D73A49">=</span><span style="color:#24292E"> magnitude;</span></span>
<span class="line"><span style="color:#24292E">                        max_freq_idx </span><span style="color:#D73A49">=</span><span style="color:#24292E"> freq_idx;</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> max_mag </span><span style="color:#D73A49">&gt;</span><span style="color:#005CC5"> 0.0</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">                max_mags</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(max_mag);</span></span>
<span class="line"><span style="color:#24292E">                max_freqs</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Complex</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">(bin[max_freq_idx], </span><span style="color:#005CC5">0.0</span><span style="color:#24292E">));</span></span>
<span class="line"><span style="color:#24292E">                freq_indices</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(max_freq_idx </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // 평균 진폭 계산</span></span>
<span class="line"><span style="color:#D73A49">        let</span><span style="color:#24292E"> avg_magnitude </span><span style="color:#D73A49">=</span><span style="color:#24292E"> max_mags</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">iter</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">sum</span><span style="color:#D73A49">::</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">f32</span><span style="color:#24292E">&gt;() </span><span style="color:#D73A49">/</span><span style="color:#24292E"> max_mags</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // 평균보다 큰 피크만 추출하여 추가</span></span>
<span class="line"><span style="color:#D73A49">        for</span><span style="color:#24292E"> (i, </span><span style="color:#D73A49">&amp;</span><span style="color:#24292E">value) </span><span style="color:#D73A49">in</span><span style="color:#24292E"> max_mags</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">iter</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">enumerate</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> value </span><span style="color:#D73A49">&gt;</span><span style="color:#24292E"> avg_magnitude {</span></span>
<span class="line"><span style="color:#D73A49">                let</span><span style="color:#24292E"> peak_time_in_bin </span><span style="color:#D73A49">=</span><span style="color:#24292E"> freq_indices[i] </span><span style="color:#D73A49">*</span><span style="color:#24292E"> bin_duration </span><span style="color:#D73A49">/</span><span style="color:#24292E"> bin</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">                let</span><span style="color:#24292E"> peak_time_index </span><span style="color:#D73A49">=</span><span style="color:#24292E"> (bin_idx </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#D73A49"> *</span><span style="color:#24292E"> bin_duration </span><span style="color:#D73A49">+</span><span style="color:#24292E"> peak_time_in_bin) </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> usize</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                // (시간 인덱스, 주파수 인덱스) 튜플을 추가</span></span>
<span class="line"><span style="color:#24292E">                peaks</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">((peak_time_index, freq_indices[i] </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> usize</span><span style="color:#24292E">));</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    peaks</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>먼저 효율을 위해 주파수 대역을 나눌 것이다. 여기서는 0 ~ 10, 10 ~ 20, 20 ~ 40, 40 ~ 80, 80 ~ 160, 160 ~ 512로 나눌 것이다. 이렇게 나누는 이유는 주파수 대역을 나누어 피크를 추출하면 더 정확하게 추출할 수 있기 때문이다.</p>
<p>그리고나서 각 주파수 대역에서 가장 큰 피크를 추출하여 평균 진폭을 계산한다. 이 평균 진폭보다 큰 피크만 추출하여 반환한다.</p>
<h2 id="소리-지문-만들기"><a href="#소리-지문-만들기">소리 지문 만들기</a></h2>
<p>마지막으로 추출한 피크를 해싱하여 소리 지문을 만들어보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#D73A49">pub</span><span style="color:#D73A49"> fn</span><span style="color:#6F42C1"> create_fingerprints</span><span style="color:#24292E">(peaks</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;(</span><span style="color:#6F42C1">usize</span><span style="color:#24292E">, </span><span style="color:#6F42C1">usize</span><span style="color:#24292E">)&gt;) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">u64</span><span style="color:#24292E">&gt; {</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> fingerprints </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> Vec</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> target_zone_size </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 3</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> i </span><span style="color:#D73A49">in</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49">..</span><span style="color:#24292E">peaks</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">        for</span><span style="color:#24292E"> j </span><span style="color:#D73A49">in</span><span style="color:#24292E"> i </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> 1</span><span style="color:#D73A49">..</span><span style="color:#24292E">peaks</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">len</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> j </span><span style="color:#D73A49">&lt;=</span><span style="color:#24292E"> i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> target_zone_size {</span></span>
<span class="line"><span style="color:#D73A49">                let</span><span style="color:#24292E"> anchor </span><span style="color:#D73A49">=</span><span style="color:#24292E"> peaks[i];</span></span>
<span class="line"><span style="color:#D73A49">                let</span><span style="color:#24292E"> target </span><span style="color:#D73A49">=</span><span style="color:#24292E"> peaks[j];</span></span>
<span class="line"><span style="color:#D73A49">                let</span><span style="color:#24292E"> address </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> create_address</span><span style="color:#24292E">(anchor, target);</span></span>
<span class="line"><span style="color:#D73A49">                let</span><span style="color:#24292E"> anchor_time_ms </span><span style="color:#D73A49">=</span><span style="color:#24292E"> (anchor</span><span style="color:#D73A49">.</span><span style="color:#005CC5">0</span><span style="color:#D73A49"> as</span><span style="color:#6F42C1"> f32</span><span style="color:#D73A49"> *</span><span style="color:#005CC5"> 1000.0</span><span style="color:#24292E">) </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> u32</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">                fingerprints</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">((address </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> u64</span><span style="color:#24292E">) </span><span style="color:#D73A49">&lt;&lt;</span><span style="color:#005CC5"> 32</span><span style="color:#D73A49"> |</span><span style="color:#24292E"> anchor_time_ms </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> u64</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    fingerprints</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">pub</span><span style="color:#D73A49"> fn</span><span style="color:#6F42C1"> create_address</span><span style="color:#24292E">(anchor</span><span style="color:#D73A49">:</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">usize</span><span style="color:#24292E">, </span><span style="color:#6F42C1">usize</span><span style="color:#24292E">), target</span><span style="color:#D73A49">:</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">usize</span><span style="color:#24292E">, </span><span style="color:#6F42C1">usize</span><span style="color:#24292E">)) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> u32</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> anchor_freq </span><span style="color:#D73A49">=</span><span style="color:#24292E"> anchor</span><span style="color:#D73A49">.</span><span style="color:#005CC5">1</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> target_freq </span><span style="color:#D73A49">=</span><span style="color:#24292E"> target</span><span style="color:#D73A49">.</span><span style="color:#005CC5">1</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> delta_ms </span><span style="color:#D73A49">=</span><span style="color:#24292E"> ((target</span><span style="color:#D73A49">.</span><span style="color:#005CC5">0</span><span style="color:#D73A49"> -</span><span style="color:#24292E"> anchor</span><span style="color:#D73A49">.</span><span style="color:#005CC5">0</span><span style="color:#24292E">) </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> f32</span><span style="color:#D73A49"> *</span><span style="color:#005CC5"> 1000.0</span><span style="color:#24292E">) </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> u32</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    (anchor_freq </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> u32</span><span style="color:#24292E">) </span><span style="color:#D73A49">&lt;&lt;</span><span style="color:#005CC5"> 23</span><span style="color:#D73A49"> |</span><span style="color:#24292E"> (target_freq </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> u32</span><span style="color:#24292E">) </span><span style="color:#D73A49">&lt;&lt;</span><span style="color:#005CC5"> 14</span><span style="color:#D73A49"> |</span><span style="color:#24292E"> delta_ms</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>위 코드는 추출한 피크를 해싱하여 소리 지문을 만드는 함수이다. 여기서는 피크를 3개씩 묶어 해싱하여 소리 지문을 만들었다. 이렇게 해싱하면 소리 지문을 더 효율적으로 만들 수 있다.</p>
<h2 id="음악-검색-함수-만들기"><a href="#음악-검색-함수-만들기">음악 검색 함수 만들기</a></h2>
<p>이제 구현한 함수를 이용하여 음원을 검색해보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#D73A49">pub</span><span style="color:#D73A49"> fn</span><span style="color:#6F42C1"> search_fingerprints</span><span style="color:#24292E">(registered</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;(</span><span style="color:#6F42C1">String</span><span style="color:#24292E">, </span><span style="color:#6F42C1">Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">u64</span><span style="color:#24292E">&gt;)&gt;, fingerprints</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Vec</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">u64</span><span style="color:#24292E">&gt;) </span><span style="color:#D73A49">-&gt;</span><span style="color:#6F42C1"> String</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#D73A49"> mut</span><span style="color:#24292E"> score_map</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> HashMap</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">usize</span><span style="color:#24292E">, </span><span style="color:#6F42C1">usize</span><span style="color:#24292E">&gt; </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> HashMap</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">new</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 저장된 각 노래와 비교하여 일치도 계산</span></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> (i, (_, existing_fingerprints)) </span><span style="color:#D73A49">in</span><span style="color:#24292E"> registered</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">iter</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">enumerate</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">        for</span><span style="color:#24292E"> fingerprint </span><span style="color:#D73A49">in</span><span style="color:#D73A49"> &amp;</span><span style="color:#24292E">fingerprints {</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> existing_fingerprints</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">contains</span><span style="color:#24292E">(fingerprint) {</span></span>
<span class="line"><span style="color:#D73A49">                *</span><span style="color:#24292E">score_map</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">entry</span><span style="color:#24292E">(i)</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">or_insert</span><span style="color:#24292E">(</span><span style="color:#005CC5">0</span><span style="color:#24292E">) </span><span style="color:#D73A49">+=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 최고 점수를 가진 항목 찾기</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> (best_index, best_score) </span><span style="color:#D73A49">=</span><span style="color:#24292E"> score_map</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">iter</span><span style="color:#24292E">()</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">max_by_key</span><span style="color:#24292E">(</span><span style="color:#D73A49">|&amp;</span><span style="color:#24292E">(_, count)</span><span style="color:#D73A49">|</span><span style="color:#24292E"> count)</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">map</span><span style="color:#24292E">(</span><span style="color:#D73A49">|</span><span style="color:#24292E">(</span><span style="color:#D73A49">&amp;</span><span style="color:#24292E">i, </span><span style="color:#D73A49">&amp;</span><span style="color:#24292E">count)</span><span style="color:#D73A49">|</span><span style="color:#24292E"> (i, count))</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">unwrap_or</span><span style="color:#24292E">((</span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">0</span><span style="color:#24292E">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 일정 임계값 이상일 때만 결과 반환, 그렇지 않으면 &quot;Not found&quot; 반환</span></span>
<span class="line"><span style="color:#D73A49">    const</span><span style="color:#005CC5"> MIN_SCORE_THRESHOLD</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> usize</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 5</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> best_score </span><span style="color:#D73A49">&gt;=</span><span style="color:#005CC5"> MIN_SCORE_THRESHOLD</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">        json!</span><span style="color:#24292E">({</span></span>
<span class="line"><span style="color:#032F62">            &quot;songName&quot;</span><span style="color:#D73A49">:</span><span style="color:#24292E"> registered[best_index]</span><span style="color:#D73A49">.</span><span style="color:#005CC5">0.</span><span style="color:#6F42C1">clone</span><span style="color:#24292E">(),</span></span>
<span class="line"><span style="color:#032F62">            &quot;score&quot;</span><span style="color:#D73A49">:</span><span style="color:#24292E"> best_score</span></span>
<span class="line"><span style="color:#24292E">        })</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">to_string</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">        json!</span><span style="color:#24292E">({</span></span>
<span class="line"><span style="color:#032F62">            &quot;songName&quot;</span><span style="color:#D73A49">:</span><span style="color:#032F62"> &quot;Not found&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">            &quot;score&quot;</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> 0</span></span>
<span class="line"><span style="color:#24292E">        })</span><span style="color:#D73A49">.</span><span style="color:#6F42C1">to_string</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>위 코드는 저장된 소리 지문과 입력받은 소리 지문을 비교하여 가장 유사한 음원을 찾는 함수이다. 이 함수는 저장된 소리 지문과 입력받은 소리 지문을 비교하여 일치하는 소리 지문이 있을 때마다 점수를 증가시킨다. 그리고 가장 높은 점수를 가진 음원을 찾아 반환한다.</p>
<h2 id="녹음해서-검색하기"><a href="#녹음해서-검색하기">녹음해서 검색하기</a></h2>
<p>마지막으로 실제로 녹음해서 검색할 수 있게 예제 코드를 작성해보자. 이 부분은 HTML과 JS를 사용하여 크롬 브라우저에서 실행 가능하도록 구현할 것이다.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E">&lt;!</span><span style="color:#22863A">DOCTYPE</span><span style="color:#6F42C1"> html</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">html</span><span style="color:#6F42C1"> lang</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;en&quot;</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">head</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">meta</span><span style="color:#6F42C1"> charset</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;UTF-8&quot;</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">meta</span><span style="color:#6F42C1"> name</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;viewport&quot;</span><span style="color:#6F42C1"> content</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;width=device-width, initial-scale=1.0&quot;</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">title</span><span style="color:#24292E">&gt;Music Search&lt;/</span><span style="color:#22863A">title</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;/</span><span style="color:#22863A">head</span><span style="color:#24292E">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">body</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">h1</span><span style="color:#24292E">&gt;Music Search&lt;/</span><span style="color:#22863A">h1</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">button</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;recordButton&quot;</span><span style="color:#24292E">&gt;Record and Search&lt;/</span><span style="color:#22863A">button</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;output&quot;</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    </span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">script</span><span style="color:#6F42C1"> type</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;module&quot;</span><span style="color:#6F42C1"> src</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;index.js&quot;</span><span style="color:#6F42C1"> defer</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">script</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;/</span><span style="color:#22863A">body</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">html</span><span style="color:#24292E">&gt;</span></span></code></pre>
<p>우선 간단하게 HTML을 만들었다. 이제 JS 코드를 작성해보자.</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e;overflow-x:auto" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> init, { register, search } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> &quot;./ringabell.js&quot;</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { FFmpeg } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> &quot;./ffmpeg/ffmpeg/index.js&quot;</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { toBlobURL } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> &quot;./ffmpeg/util/index.js&quot;</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// FFmpeg WASM 라이브러리 로드</span></span>
<span class="line"><span style="color:#D73A49">async</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> loadFFmpeg</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> baseURL</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd&quot;</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> ffmpeg</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> FFmpeg</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  await</span><span style="color:#24292E"> ffmpeg.</span><span style="color:#6F42C1">load</span><span style="color:#24292E">({</span></span>
<span class="line"><span style="color:#24292E">    coreURL: </span><span style="color:#D73A49">await</span><span style="color:#6F42C1"> toBlobURL</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;/ffmpeg/core/ffmpeg-core.js&quot;</span><span style="color:#24292E">, </span><span style="color:#032F62">&quot;text/javascript&quot;</span><span style="color:#24292E">),</span></span>
<span class="line"><span style="color:#24292E">    wasmURL: </span><span style="color:#D73A49">await</span><span style="color:#6F42C1"> toBlobURL</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#032F62">      &quot;/ffmpeg/core/ffmpeg-core.wasm&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">      &quot;application/wasm&quot;</span></span>
<span class="line"><span style="color:#24292E">    ),</span></span>
<span class="line"><span style="color:#24292E">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  return</span><span style="color:#24292E"> ffmpeg;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">async</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> main</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#D73A49">  await</span><span style="color:#6F42C1"> init</span><span style="color:#24292E">(); </span><span style="color:#6A737D">// Wasm 모듈 초기화</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> recordButton</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> document.</span><span style="color:#6F42C1">getElementById</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;recordButton&quot;</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> output</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> document.</span><span style="color:#6F42C1">getElementById</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;output&quot;</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  recordButton.</span><span style="color:#6F42C1">addEventListener</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;click&quot;</span><span style="color:#24292E">, </span><span style="color:#D73A49">async</span><span style="color:#24292E"> () </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    output.textContent </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Listening...&quot;</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    const</span><span style="color:#005CC5"> stream</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#24292E"> navigator.mediaDevices.</span><span style="color:#6F42C1">getUserMedia</span><span style="color:#24292E">({ audio: </span><span style="color:#005CC5">true</span><span style="color:#24292E"> });</span></span>
<span class="line"><span style="color:#D73A49">    const</span><span style="color:#005CC5"> audioContext</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> AudioContext</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#D73A49">    const</span><span style="color:#005CC5"> mediaRecorder</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> MediaRecorder</span><span style="color:#24292E">(stream);</span></span>
<span class="line"><span style="color:#D73A49">    const</span><span style="color:#005CC5"> audioChunks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 녹음 데이터 수집</span></span>
<span class="line"><span style="color:#24292E">    mediaRecorder.</span><span style="color:#6F42C1">ondataavailable</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> (</span><span style="color:#E36209">event</span><span style="color:#24292E">) </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">      audioChunks.</span><span style="color:#6F42C1">push</span><span style="color:#24292E">(event.data);</span></span>
<span class="line"><span style="color:#24292E">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 녹음 종료 후 처리</span></span>
<span class="line"><span style="color:#24292E">    mediaRecorder.</span><span style="color:#6F42C1">onstop</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> async</span><span style="color:#24292E"> () </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">      const</span><span style="color:#005CC5"> audioBlob</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Blob</span><span style="color:#24292E">(audioChunks, { type: </span><span style="color:#032F62">&quot;audio/webm&quot;</span><span style="color:#24292E"> });</span></span>
<span class="line"><span style="color:#D73A49">      const</span><span style="color:#005CC5"> audioBytes</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Uint8Array</span><span style="color:#24292E">(</span><span style="color:#D73A49">await</span><span style="color:#24292E"> audioBlob.</span><span style="color:#6F42C1">arrayBuffer</span><span style="color:#24292E">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">      // 크로미움은 녹음된 오디오를 webm으로 저장하기 때문에 wav로 변환</span></span>
<span class="line"><span style="color:#D73A49">      await</span><span style="color:#24292E"> ffmpeg.</span><span style="color:#6F42C1">writeFile</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;input.webm&quot;</span><span style="color:#24292E">, audioBytes);</span></span>
<span class="line"><span style="color:#D73A49">      await</span><span style="color:#24292E"> ffmpeg.</span><span style="color:#6F42C1">exec</span><span style="color:#24292E">([</span></span>
<span class="line"><span style="color:#032F62">        &quot;-i&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">        &quot;input.webm&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">        &quot;-acodec&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">        &quot;pcm_s16le&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">        &quot;-ac&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">        &quot;1&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">        &quot;-ar&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">        &quot;44100&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">        &quot;output.wav&quot;</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">      ]);</span></span>
<span class="line"><span style="color:#D73A49">      const</span><span style="color:#005CC5"> data</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#24292E"> ffmpeg.</span><span style="color:#6F42C1">readFile</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;output.wav&quot;</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">      // 결과 데이터 파싱</span></span>
<span class="line"><span style="color:#D73A49">      const</span><span style="color:#005CC5"> result</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> JSON</span><span style="color:#24292E">.</span><span style="color:#6F42C1">parse</span><span style="color:#24292E">(</span><span style="color:#D73A49">await</span><span style="color:#6F42C1"> search</span><span style="color:#24292E">(data));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">      // 스코어가 0이라면 &quot;Not found&quot; 출력</span></span>
<span class="line"><span style="color:#D73A49">      if</span><span style="color:#24292E"> (result.score </span><span style="color:#D73A49">===</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        output.textContent </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Not found&quot;</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">      } </span></span>
<span class="line"><span style="color:#6A737D">      // 그렇지 않으면 검색 결과 출력</span></span>
<span class="line"><span style="color:#D73A49">      else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        output.textContent </span><span style="color:#D73A49">=</span><span style="color:#032F62"> `Search result: ${</span><span style="color:#24292E">result</span><span style="color:#032F62">.</span><span style="color:#24292E">songName</span><span style="color:#032F62">}`</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">      }</span></span>
<span class="line"><span style="color:#24292E">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 녹음 시작</span></span>
<span class="line"><span style="color:#24292E">    mediaRecorder.</span><span style="color:#6F42C1">start</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // 10초 후 녹음 종료</span></span>
<span class="line"><span style="color:#6F42C1">    setTimeout</span><span style="color:#24292E">(() </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">      mediaRecorder.</span><span style="color:#6F42C1">stop</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">      output.textContent </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Processing...&quot;</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }, </span><span style="color:#005CC5">10000</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  });</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">main</span><span style="color:#24292E">();</span></span></code></pre>
<p>위 코드에선 앞서 작성한 Rust 코드를 WASM으로 빌드하는 것과 <a href="https://github.com/ffmpegwasm/ffmpeg.wasm" rel="noopener noreferrer" target="_blank">ffmpeg.wasm</a>을 이용하여 녹음된 오디오를 WAV로 변환하는 것을 어느정도 생략했다. 또한 음원을 등록하는 부분도 생략했다.</p>
<p>핵심 코드만 살펴보면 녹음 버튼을 누르면 10초간 녹음한 후 녹음된 오디오를 WAV로 변환하여 검색하는 것이다. 검색 결과가 있으면 결과를 출력하고 없으면 “Not found”를 출력한다.</p>
<p>실제 테스트는 <a href="https://kciter.github.io/ringabell" rel="noopener noreferrer" target="_blank">링크</a>에서 가능하다. 접속하면 곡을 등록하는 것도 가능하다. <code>Record and Search</code> 버튼을 클릭하면 녹음이 시작되며 10초간 녹음한 후 검색 결과를 확인할 수 있다. 만약 사용할 만한 곡이 없다면 <a href="https://www.youtube.com/audiolibrary" rel="noopener noreferrer" target="_blank">유튜브 오디오 라이브러리</a>에서 다운로드 받아 테스트할 수 있다.</p>
<h1 id="마치며"><a href="#마치며">마치며</a></h1>
<p>이번 글에서는 음악 검색 시스템을 만들기 위한 알고리즘과 구현 방법에 대해 알아보았다. 이미 잘 작동하는 서비스도 많고 관련 API도 많지만 직접 구현해보는 것도 재미있는 경험이 될 것이다. 그리고 꼭 <strong>음악 검색이 아니더라도 노래방 점수 계산이나 저작권 침해 검출 등 다양한 분야에 적용</strong>할 수 있을 것이라 생각한다. 앞으로 이러한 개발을 안할 것이라는 보장은 없으니 알아둬서 나쁠건 없다고 생각한다.</p>
<p>이 글에서 만든 음악 검색 시스템은 기본적인 기능만을 제공할 뿐이며 실제 서비스에 적용하기 위해서는 더 치밀한 알고리즘 개발이 필요하다. 다른 소리가 섞이거나 음악의 톤이 달라지는 경우, 리믹스 등의 경우에는 정확도가 떨어지고 이를 잘 처리하는 것이 기술력이라고 볼 수 있다.</p>
<section data-footnotes class="footnotes"><h2 class="sr-only" id="footnote-label"><a href="#footnote-label">Footnotes</a></h2>
<ol>
<li id="user-content-fn-1">
<p>Pulse Code Modulation의 약자로 아날로그 신호를 디지털 신호로 변환하는 방식 중 하나이다. <a href="#user-content-fnref-1" data-footnote-backref aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>모노(Mono)는 단일 채널을 의미하며 스테레오(Stereo)는 왼쪽(L)과 오른쪽(R) 채널을 사용하는 것을 의미한다. <a href="#user-content-fnref-2" data-footnote-backref aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>  </div> <div> <div class="mt-1 w-full"> <div class="mr-1 mb-1 inline-flex items-center rounded-[50px] border border-[#dfe3e8] px-2 text-[10px] text-[#888]" style="height: 20px;"> music-recognition </div><div class="mr-1 mb-1 inline-flex items-center rounded-[50px] border border-[#dfe3e8] px-2 text-[10px] text-[#888]" style="height: 20px;"> audio-fingerprint </div><div class="mr-1 mb-1 inline-flex items-center rounded-[50px] border border-[#dfe3e8] px-2 text-[10px] text-[#888]" style="height: 20px;"> signal-processing </div><div class="mr-1 mb-1 inline-flex items-center rounded-[50px] border border-[#dfe3e8] px-2 text-[10px] text-[#888]" style="height: 20px;"> algorithm </div> </div> <div class="flex items-center py-6" data-astro-cid-k7qsseos> <div class="shrink-0 basis-[80px]" data-astro-cid-k7qsseos> <img class="h-[80px] w-[80px] object-cover" style="border-radius: 50%;" src="/images/about/avatar.jpg" data-astro-cid-k7qsseos> </div> <div class="ml-8 flex-1 text-base" data-astro-cid-k7qsseos> <div data-astro-cid-k7qsseos>
Written by <a href="/about/" class="name-gradient font-bold no-underline" data-astro-cid-k7qsseos>
@kciter
</a> </div> <div class="text-sm font-light leading-snug" data-astro-cid-k7qsseos>가치있는 지식이 되기를 바랍니다</div> <div class="-ml-1 [&_a]:text-sm [&_a]:text-[#888]" data-astro-cid-k7qsseos> <a href="https://github.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="GitHub" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.2 11.38.6.12.83-.26.83-.57v-2.2c-3.34.73-4.04-1.44-4.04-1.44-.55-1.38-1.33-1.75-1.33-1.75-1.09-.74.08-.73.08-.73 1.2.09 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.49 1 .1-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6.02 0c2.28-1.55 3.28-1.23 3.28-1.23.66 1.66.25 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .31.22.7.83.57C20.57 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z"/></svg></a><a href="https://www.facebook.com/sunhyoup.lee" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="Facebook" style="--hover-color: #3d5b99; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M24 12.07C24 5.41 18.63 0 12 0S0 5.41 0 12.07c0 6.02 4.39 11.02 10.13 11.93v-8.44H7.08v-3.49h3.04V9.41c0-3.02 1.79-4.68 4.53-4.68 1.31 0 2.68.24 2.68.24v2.97h-1.51c-1.49 0-1.95.93-1.95 1.88v2.26h3.33l-.53 3.49h-2.8v8.44C19.61 23.09 24 18.09 24 12.07z"/></svg></a><a href="https://www.linkedin.com/in/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="LinkedIn" style="--hover-color: #0073a4; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M20.45 20.45h-3.55v-5.57c0-1.33-.02-3.04-1.85-3.04-1.85 0-2.14 1.45-2.14 2.94v5.67H9.36V9h3.41v1.56h.05c.48-.9 1.64-1.85 3.37-1.85 3.6 0 4.27 2.37 4.27 5.46v6.28zM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12zM7.12 20.45H3.56V9h3.56v11.45zM22.22 0H1.77C.79 0 0 .77 0 1.72v20.56C0 23.23.79 24 1.77 24h20.45C23.2 24 24 23.23 24 22.28V1.72C24 .77 23.2 0 22.22 0z"/></svg></a><a href="https://twitter.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="X (Twitter)" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href="/feed.xml" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="RSS Feed" style="--hover-color: #ff6600; transition: color .5s;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M6.18 15.64a2.18 2.18 0 1 1 0 4.36 2.18 2.18 0 0 1 0-4.36zM4 4.44v3.57A12.01 12.01 0 0 1 15.99 20h3.57A15.57 15.57 0 0 0 4 4.44zM4 10.1v3.57c3.5 0 6.33 2.84 6.33 6.33h3.57c0-5.47-4.43-9.9-9.9-9.9z"/></svg></a> </div> </div> </div>   <div id="comments"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var a=(s,i,o)=>{let r=async()=>{await(await s())()},t=typeof i.value=="object"?i.value:void 0,c={rootMargin:t==null?void 0:t.rootMargin},n=new IntersectionObserver(e=>{for(let l of e)if(l.isIntersecting){n.disconnect(),r();break}},c);for(let e of o.children)n.observe(e)};(self.Astro||(self.Astro={})).visible=a;window.dispatchEvent(new Event("astro:visible"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z1MhqMT" prefix="r15" component-url="/_astro/Giscus.BCCeZi7E.js" component-export="default" renderer-url="/_astro/client.C9fCgUO1.js" props="{&quot;repo&quot;:[0,&quot;kciter/kciter.github.io&quot;],&quot;theme&quot;:[0,&quot;light&quot;]}" ssr client="visible" opts="{&quot;name&quot;:&quot;Giscus&quot;,&quot;value&quot;:true}" await-children><div></div><!--astro:end--></astro-island> </div> </div> <div class="pt-8 pb-8" data-astro-cid-llggujpl> <div class="grid grid-cols-3 gap-5 max-[30rem]:grid-cols-1" data-astro-cid-llggujpl> <a href="/posts/modeling-series-measure/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2025-05-02-modeling-series-measure/thumbnail.png" alt="모델링 시리즈: 측도" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>모델링 시리즈: 측도</div> <small data-astro-cid-llggujpl>2025-05-02</small> </a><a href="/posts/effective-work/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2023-07-10-effective-work/thumbnail.png" alt="갓생사는 방법론" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>갓생사는 방법론</div> <small data-astro-cid-llggujpl>2023-07-10</small> </a><a href="/posts/ascii-3d-renderer/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2024-03-03-ascii-3d-renderer/thumbnail.png" alt="ASCII 3D 렌더러 만들기" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>ASCII 3D 렌더러 만들기</div> <small data-astro-cid-llggujpl>2024-03-03</small> </a><a href="/posts/codex-perfect-guide-book/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2026-02-26-codex-perfect-guide-book/thumbnail.png" alt="요즘 바이브 코딩 코덱스 완벽 가이드" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>요즘 바이브 코딩 코덱스 완벽 가이드</div> <small data-astro-cid-llggujpl>2026-02-26</small> </a><a href="/posts/build-large-scale-react-web-apps/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2025-03-12-build-large-scale-react-web-apps/thumbnail.png" alt="대규모 리액트 웹 앱 개발" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>대규모 리액트 웹 앱 개발</div> <small data-astro-cid-llggujpl>2025-03-12</small> </a><a href="/posts/spring-multi-module-architecture/" class="related-post block scale-100 no-underline transition-all duration-[333ms] ease-[ease]" style="text-decoration: none;" data-astro-cid-llggujpl> <img src="/images/2023-05-03-spring-multi-module-architecture/thumbnail.png" alt="IoC와 DI를 이용한 Spring 멀티 모듈 아키텍처" loading="lazy" class="block w-full object-cover shadow-[0_0_10px_2px_rgba(0,0,0,0.05)]" style="aspect-ratio: 16/9;" data-astro-cid-llggujpl> <div class="mt-3 text-xl leading-6 font-thin" data-astro-cid-llggujpl>IoC와 DI를 이용한 Spring 멀티 모듈 아키텍처</div> <small data-astro-cid-llggujpl>2023-05-03</small> </a> </div> </div>  </div> <footer class="m-8 text-center text-[#999]"> <div> <a href="https://github.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="GitHub" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.2 11.38.6.12.83-.26.83-.57v-2.2c-3.34.73-4.04-1.44-4.04-1.44-.55-1.38-1.33-1.75-1.33-1.75-1.09-.74.08-.73.08-.73 1.2.09 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.49 1 .1-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6.02 0c2.28-1.55 3.28-1.23 3.28-1.23.66 1.66.25 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .31.22.7.83.57C20.57 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z"/></svg></a><a href="https://www.facebook.com/sunhyoup.lee" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="Facebook" style="--hover-color: #3d5b99; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M24 12.07C24 5.41 18.63 0 12 0S0 5.41 0 12.07c0 6.02 4.39 11.02 10.13 11.93v-8.44H7.08v-3.49h3.04V9.41c0-3.02 1.79-4.68 4.53-4.68 1.31 0 2.68.24 2.68.24v2.97h-1.51c-1.49 0-1.95.93-1.95 1.88v2.26h3.33l-.53 3.49h-2.8v8.44C19.61 23.09 24 18.09 24 12.07z"/></svg></a><a href="https://www.linkedin.com/in/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="LinkedIn" style="--hover-color: #0073a4; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M20.45 20.45h-3.55v-5.57c0-1.33-.02-3.04-1.85-3.04-1.85 0-2.14 1.45-2.14 2.94v5.67H9.36V9h3.41v1.56h.05c.48-.9 1.64-1.85 3.37-1.85 3.6 0 4.27 2.37 4.27 5.46v6.28zM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12zM7.12 20.45H3.56V9h3.56v11.45zM22.22 0H1.77C.79 0 0 .77 0 1.72v20.56C0 23.23.79 24 1.77 24h20.45C23.2 24 24 23.23 24 22.28V1.72C24 .77 23.2 0 22.22 0z"/></svg></a><a href="https://twitter.com/kciter" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="X (Twitter)" style="--hover-color: #343434; transition: color .5s; margin-right: 5px;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href="/feed.xml" target="_blank" rel="noopener noreferrer" class="social-icon inline-block p-[5px] no-underline" aria-label="RSS Feed" style="--hover-color: #ff6600; transition: color .5s;" data-astro-cid-yxtifmrq><svg class="inline-block h-4 w-4" viewBox="0 0 24 24" fill="currentColor" data-astro-cid-yxtifmrq><path d="M6.18 15.64a2.18 2.18 0 1 1 0 4.36 2.18 2.18 0 0 1 0-4.36zM4 4.44v3.57A12.01 12.01 0 0 1 15.99 20h3.57A15.57 15.57 0 0 0 4 4.44zM4 10.1v3.57c3.5 0 6.33 2.84 6.33 6.33h3.57c0-5.47-4.43-9.9-9.9-9.9z"/></svg></a> </div> <div class="mt-4 mb-4 font-['Quattrocento_Sans',sans-serif] text-[0.8rem] text-[#9a9a9a]"> <a href="/about/" class="p-2.5 text-[#999] hover:text-[#333]" style="text-decoration: none;">
kciter.so | devlog by Sunhyoup Lee
</a> </div> </footer> </div> </body></html> <script type="module">document.querySelectorAll(".post-container a[data-footnote-ref]").forEach(o=>{const e=o.getAttribute("href")?.slice(1);if(!e)return;const r=document.getElementById(e);if(!r)return;const t=r.textContent?.replace("↩","").trim()||"";o.setAttribute("data-tooltip",t)});document.querySelectorAll(".code-tabs").forEach(o=>{const e=Array.from(o.querySelectorAll(":scope > pre"));if(e.length<2)return;const r=o.getAttribute("data-labels")?.split(",").map(a=>a.trim()),t=document.createElement("div");t.className="code-tabs-bar",e.forEach((a,s)=>{const n=r?.[s]||a.getAttribute("data-language")||"code",c=document.createElement("button");c.textContent=n,r?.[s]&&c.classList.add("has-filename"),s===0&&c.classList.add("active"),c.addEventListener("click",()=>{t.querySelectorAll("button").forEach(l=>l.classList.remove("active")),e.forEach(l=>l.classList.remove("active")),c.classList.add("active"),e[s].classList.add("active")}),t.appendChild(c)}),e[0].classList.add("active"),o.prepend(t)});const i=document.querySelectorAll(".toc .toc-list a");if(i.length>0){const e=Array.from(i).map(t=>t.getAttribute("href")?.slice(1)).filter(Boolean).map(t=>document.getElementById(t)).filter(Boolean),r=new IntersectionObserver(t=>{for(const a of t)if(a.isIntersecting){const s=a.target.id;i.forEach(n=>{n.classList.toggle("active",n.getAttribute("href")===`#${s}`)})}},{rootMargin:"0px 0px -70% 0px",threshold:0});e.forEach(t=>r.observe(t))}</script>